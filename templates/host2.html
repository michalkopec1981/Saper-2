{% extends 'base.html' %}
{% block title %}Panel Hosta 2 - {{ event.name }}{% endblock %}

{% block styles %}
<meta charset="UTF-8">
{{ super() }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<style>
    /* ========================================
       MAILERLITE LAYOUT STYLES
       ======================================== */

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        overflow: hidden;
    }

    #app-wrapper {
        display: flex;
        height: 100vh;
        overflow: hidden;
        position: relative;
    }

    /* SIDEBAR */
    #sidebar {
        width: 260px;
        background-color: #ffffff;
        border-right: 1px solid #e2e5e8;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        position: relative;
        z-index: 1000;
        transition: transform 0.3s ease;
    }

    #sidebar-header {
        padding: 20px;
        border-bottom: 1px solid #e2e5e8;
        background-color: #ffffff;
    }

    #sidebar-header h4 {
        margin: 0;
        font-size: 1.2rem;
        color: #1a1a1a;
        font-weight: 600;
    }

    #sidebar-header .event-name {
        font-size: 0.85rem;
        color: #6b7280;
        margin-top: 5px;
    }

    #sidebar-menu {
        flex: 1;
        padding: 10px 0;
    }

    .menu-item {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        color: #4a5568;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        background: none;
        width: 100%;
        text-align: left;
        font-size: 0.95rem;
    }

    .menu-item i {
        width: 20px;
        margin-right: 12px;
        font-size: 1.1rem;
    }

    .menu-item:hover {
        background-color: #f5f7fa;
        color: #1a1a1a;
    }

    .menu-item.active {
        background-color: #dc3545;
        color: #ffffff;
        font-weight: 600;
    }

    .menu-item.active:hover {
        background-color: #c82333;
    }

    .menu-separator {
        height: 1px;
        background-color: #e2e5e8;
        margin: 10px 0;
    }

    .menu-section-title {
        padding: 10px 20px 5px;
        font-size: 0.75rem;
        font-weight: 600;
        color: #9ca3af;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    #sidebar-footer {
        padding: 15px 20px;
        border-top: 1px solid #e2e5e8;
        background-color: #f9fafb;
    }

    #sidebar-footer small {
        display: block;
        color: #6b7280;
        margin-bottom: 8px;
        font-size: 0.8rem;
    }

    /* MAIN CONTENT */
    #main-content {
        flex: 1;
        background-color: #f5f7fa;
        overflow-y: auto;
        position: relative;
    }

    .content-wrapper {
        padding: 30px;
        max-width: 1400px;
    }

    .content-section {
        display: none;
    }

    .content-section.active {
        display: block;
        animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    /* Mobile Menu Toggle */
    #mobile-menu-toggle {
        display: none;
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background-color: #dc3545;
        color: white;
        border: none;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        z-index: 999;
        font-size: 1.5rem;
        cursor: pointer;
    }

    #sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
    }

    /* Responsywno≈õƒá */
    @media (max-width: 992px) {
        #sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            transform: translateX(-100%);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        #sidebar.open {
            transform: translateX(0);
        }

        #sidebar-overlay.show {
            display: block;
        }

        #mobile-menu-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .content-wrapper {
            padding: 20px;
        }
    }

    /* ========================================
       ZACHOWANE ORYGINALNE STYLE
       ======================================== */

    .btn-group .btn.active-modifier {
        background-color: #0d6efd;
        color: white;
        border-color: #0d6efd;
    }
    #info-time-left {
        font-size: 1.2em;
        font-weight: bold;
        color: #dc3545;
    }
    #info-time-elapsed, #info-time-elapsed-pauses {
        font-weight: 500;
    }
    .question-item {
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        padding: 1rem;
        margin-bottom: 0.5rem;
    }
    .question-stats {
        font-size: 0.875rem;
        color: #6c757d;
    }
    #info-game-status {
        font-weight: 600;
    }
    #info-game-status.status-waiting {
        color: #6c757d;
    }
    #info-game-status.status-active {
        color: #198754;
    }
    #info-game-status.status-paused {
        color: #ffc107;
    }
    #info-game-status.status-stopped {
        color: #dc3545;
    }
    #password-preview-card {
        cursor: pointer;
        transition: background-color 0.2s;
    }
    #password-preview-card:hover {
        background-color: #f8f9fa;
    }

    /* ========================================
       DARK MODE STYLES
       ======================================== */

    body.dark-mode {
        background-color: #0d1117 !important;
        color: #c9d1d9 !important;
    }

    body.dark-mode #app-wrapper {
        background-color: #0d1117;
    }

    body.dark-mode #sidebar {
        background-color: #161b22;
        border-right-color: #30363d;
    }

    body.dark-mode #sidebar-header {
        background-color: #161b22;
        border-bottom-color: #30363d;
    }

    body.dark-mode #sidebar-header h4,
    body.dark-mode #sidebar-header .event-name {
        color: #c9d1d9;
    }

    body.dark-mode .menu-item {
        color: #8b949e;
    }

    body.dark-mode .menu-item:hover {
        background-color: #1c2128;
        color: #c9d1d9;
    }

    body.dark-mode .menu-item.active {
        background-color: #8b1e2b;
        color: #ffffff;
    }

    body.dark-mode .menu-item.active:hover {
        background-color: #6d1822;
    }

    body.dark-mode .menu-separator {
        background-color: #30363d;
    }

    body.dark-mode .menu-section-title {
        color: #6e7681;
    }

    body.dark-mode #sidebar-footer {
        background-color: #0d1117;
        border-top-color: #30363d;
    }

    body.dark-mode #sidebar-footer small {
        color: #8b949e;
    }

    body.dark-mode #main-content {
        background-color: #0d1117;
    }

    body.dark-mode .container {
        background-color: #0d1117 !important;
    }

    body.dark-mode .card {
        background-color: #161b22 !important;
        border-color: #30363d !important;
        color: #c9d1d9 !important;
    }

    body.dark-mode .card-header {
        background-color: #1c2128 !important;
        border-bottom-color: #30363d !important;
        color: #c9d1d9 !important;
    }

    body.dark-mode .card-title {
        color: #c9d1d9 !important;
    }

    body.dark-mode .card-body {
        background-color: #161b22 !important;
    }

    body.dark-mode .card-text {
        color: #8b949e !important;
    }

    body.dark-mode .btn-primary {
        background-color: #238636 !important;
        border-color: #238636 !important;
        color: #ffffff !important;
    }

    body.dark-mode .btn-primary:hover {
        background-color: #2ea043 !important;
        border-color: #2ea043 !important;
    }

    body.dark-mode .btn-outline-primary {
        color: #58a6ff !important;
        border-color: #30363d !important;
        background-color: #0d1117 !important;
    }

    body.dark-mode .btn-outline-primary:hover {
        background-color: #1c2128 !important;
        color: #58a6ff !important;
        border-color: #58a6ff !important;
    }

    body.dark-mode .btn-outline-primary.active-modifier,
    body.dark-mode .btn-group .btn.active-modifier {
        background-color: #1f6feb !important;
        color: #ffffff !important;
        border-color: #1f6feb !important;
    }

    body.dark-mode .btn-secondary {
        background-color: #30363d !important;
        border-color: #30363d !important;
        color: #c9d1d9 !important;
    }

    body.dark-mode .btn-secondary:hover {
        background-color: #3d444d !important;
        border-color: #3d444d !important;
    }

    body.dark-mode .btn-outline-secondary {
        color: #8b949e !important;
        border-color: #30363d !important;
        background-color: #0d1117 !important;
    }

    body.dark-mode .btn-outline-secondary:hover {
        background-color: #1c2128 !important;
        color: #c9d1d9 !important;
        border-color: #3d444d !important;
    }

    body.dark-mode .btn-success {
        background-color: #238636 !important;
        border-color: #238636 !important;
    }

    body.dark-mode .btn-success:hover {
        background-color: #2ea043 !important;
        border-color: #2ea043 !important;
    }

    body.dark-mode .btn-danger {
        background-color: #da3633 !important;
        border-color: #da3633 !important;
    }

    body.dark-mode .btn-danger:hover {
        background-color: #e5534b !important;
        border-color: #e5534b !important;
    }

    body.dark-mode .btn-warning {
        background-color: #9e6a03 !important;
        border-color: #9e6a03 !important;
        color: #ffffff !important;
    }

    body.dark-mode .btn-warning:hover {
        background-color: #bb8009 !important;
        border-color: #bb8009 !important;
    }

    body.dark-mode .btn-info {
        background-color: #0969da !important;
        border-color: #0969da !important;
    }

    body.dark-mode .btn-info:hover {
        background-color: #1177ea !important;
        border-color: #1177ea !important;
    }

    body.dark-mode .form-control,
    body.dark-mode .form-select {
        background-color: #0d1117 !important;
        border-color: #30363d !important;
        color: #c9d1d9 !important;
    }

    body.dark-mode .form-control:focus,
    body.dark-mode .form-select:focus {
        background-color: #0d1117 !important;
        border-color: #58a6ff !important;
        color: #c9d1d9 !important;
        box-shadow: 0 0 0 0.25rem rgba(88, 166, 255, 0.25) !important;
    }

    body.dark-mode .form-control::placeholder {
        color: #6e7681 !important;
    }

    body.dark-mode .form-label,
    body.dark-mode .form-check-label {
        color: #c9d1d9 !important;
    }

    body.dark-mode h1,
    body.dark-mode h2,
    body.dark-mode h3,
    body.dark-mode h4,
    body.dark-mode h5,
    body.dark-mode h6 {
        color: #c9d1d9 !important;
    }

    body.dark-mode .text-muted {
        color: #8b949e !important;
    }

    body.dark-mode .text-secondary {
        color: #8b949e !important;
    }

    body.dark-mode .text-white {
        color: #ffffff !important;
    }

    body.dark-mode .badge.bg-success {
        background-color: #238636 !important;
    }

    body.dark-mode .badge.bg-secondary {
        background-color: #30363d !important;
    }

    body.dark-mode .badge.bg-warning {
        background-color: #9e6a03 !important;
        color: #ffffff !important;
    }

    body.dark-mode .badge.bg-danger {
        background-color: #da3633 !important;
    }

    body.dark-mode .badge.bg-info {
        background-color: #0969da !important;
    }

    body.dark-mode .badge.bg-primary {
        background-color: #1f6feb !important;
    }

    body.dark-mode .alert-warning {
        background-color: #3d2e00 !important;
        border-color: #9e6a03 !important;
        color: #e3b341 !important;
    }

    body.dark-mode .alert-info {
        background-color: #051d4d !important;
        border-color: #0969da !important;
        color: #79c0ff !important;
    }

    body.dark-mode .alert-success {
        background-color: #0d3818 !important;
        border-color: #238636 !important;
        color: #56d364 !important;
    }

    body.dark-mode .alert-danger {
        background-color: #490202 !important;
        border-color: #da3633 !important;
        color: #f85149 !important;
    }

    body.dark-mode .table {
        color: #c9d1d9 !important;
        border-color: #30363d !important;
    }

    body.dark-mode .table thead {
        border-color: #30363d !important;
    }

    body.dark-mode .table tbody {
        border-color: #30363d !important;
    }

    body.dark-mode .table td,
    body.dark-mode .table th {
        border-color: #30363d !important;
    }

    body.dark-mode .table-striped > tbody > tr:nth-of-type(odd) > * {
        background-color: #161b22 !important;
    }

    body.dark-mode .table-hover > tbody > tr:hover > * {
        background-color: #1c2128 !important;
    }

    body.dark-mode .list-group-item {
        background-color: #161b22 !important;
        border-color: #30363d !important;
        color: #c9d1d9 !important;
    }

    body.dark-mode .list-group-item:hover {
        background-color: #1c2128 !important;
    }

    body.dark-mode .list-group-flush .list-group-item {
        background-color: transparent !important;
    }

    body.dark-mode .question-item {
        border-color: #30363d !important;
        background-color: #161b22 !important;
    }

    body.dark-mode .question-stats {
        color: #8b949e !important;
    }

    body.dark-mode #password-preview-card {
        background-color: #161b22 !important;
    }

    body.dark-mode #password-preview-card:hover {
        background-color: #1c2128 !important;
    }

    body.dark-mode .modal-content {
        background-color: #161b22 !important;
        border-color: #30363d !important;
    }

    body.dark-mode .modal-header {
        background-color: #1c2128 !important;
        border-bottom-color: #30363d !important;
    }

    body.dark-mode .modal-footer {
        border-top-color: #30363d !important;
    }

    body.dark-mode .modal-title {
        color: #c9d1d9 !important;
    }

    body.dark-mode .btn-close {
        filter: invert(1) grayscale(100%) brightness(200%);
    }

    body.dark-mode .input-group-text {
        background-color: #1c2128 !important;
        border-color: #30363d !important;
        color: #8b949e !important;
    }

    body.dark-mode .dropdown-menu {
        background-color: #161b22 !important;
        border-color: #30363d !important;
    }

    body.dark-mode .dropdown-item {
        color: #c9d1d9 !important;
    }

    body.dark-mode .dropdown-item:hover {
        background-color: #1c2128 !important;
        color: #c9d1d9 !important;
    }

    body.dark-mode hr {
        border-color: #30363d !important;
        opacity: 1 !important;
    }

    body.dark-mode .progress {
        background-color: #1c2128 !important;
    }

    body.dark-mode .form-check-input {
        background-color: #30363d !important;
        border-color: #30363d !important;
    }

    body.dark-mode .form-check-input:checked {
        background-color: #238636 !important;
        border-color: #238636 !important;
    }

    body.dark-mode .form-check-input:focus {
        box-shadow: 0 0 0 0.25rem rgba(35, 134, 54, 0.25) !important;
    }

    body.dark-mode .btn-group .btn {
        border-color: #30363d !important;
    }

    body.dark-mode fieldset {
        border-color: #30363d !important;
    }

    body.dark-mode legend {
        color: #c9d1d9 !important;
    }
</style>
{% endblock %}

{% block content %}
<div id="app-wrapper">
    <!-- SIDEBAR -->
    <nav id="sidebar">
        <div id="sidebar-header">
            <h4><i class="bi bi-gear-fill"></i> Host Panel 2</h4>
            <div class="event-name">{{ event.name }}</div>
        </div>

        <div id="sidebar-menu">
            <button class="menu-item active" onclick="showSection('game-section', this)">
                <i class="bi bi-house-door-fill"></i> Pulpit
            </button>
            <button class="menu-item" onclick="showSection('settings-section', this)">
                <i class="bi bi-sliders"></i> Ustawienia
            </button>
            <button class="menu-item" onclick="showSection('timing-section', this)">
                <i class="bi bi-clock-fill"></i> Czas i tempo
            </button>
            <button class="menu-item" onclick="showSection('players-section', this)">
                <i class="bi bi-people-fill"></i> Gracze
            </button>
            <button class="menu-item" onclick="showSection('password-section', this)">
                <i class="bi bi-key-fill"></i> Has≈Ço
            </button>
            <button class="menu-item" onclick="showSection('display-section', this)">
                <i class="bi bi-display-fill"></i> Wy≈õwietlacz
            </button>
            {% if is_superhost %}
            <button class="menu-item" onclick="showSection('qrcodes-section', this)">
                <i class="bi bi-qr-code"></i> Kody QR
            </button>
            {% endif %}
            <button class="menu-item" onclick="showSection('ar-section', this)">
                <i class="bi bi-badge-ar-fill"></i> AR
            </button>

            <div class="menu-separator"></div>
            <div class="menu-section-title">Pytania</div>

            <button class="menu-item" onclick="showSection('questions-section', this)">
                <i class="bi bi-question-circle-fill"></i> Pytania runda 1
            </button>
            <button class="menu-item" onclick="showSection('questions-r2-section', this)">
                <i class="bi bi-question-circle-fill"></i> Pytania runda 2
            </button>
            <button class="menu-item" onclick="showSection('questions-r3-section', this)">
                <i class="bi bi-question-circle-fill"></i> Pytania runda 3
            </button>

            <div class="menu-separator"></div>
            <div class="menu-section-title">Dodatki</div>

            <button class="menu-item" onclick="showSection('ai-section', this)">
                <i class="bi bi-robot"></i> AI
            </button>
            <button class="menu-item" onclick="showSection('fortune-section', this)">
                <i class="bi bi-magic"></i> Wr√≥≈ºka AI
            </button>
            <button class="menu-item" onclick="showSection('minigames-section', this)">
                <i class="bi bi-controller"></i> Minigry
            </button>
            <button class="menu-item" onclick="showSection('photo-section', this)">
                <i class="bi bi-camera-fill"></i> Foto
            </button>
            <button class="menu-item" onclick="showSection('voting-section', this)">
                <i class="bi bi-hand-thumbs-up-fill"></i> G≈Çosowanie
            </button>
            <button class="menu-item" onclick="showSection('live-section', this)">
                <i class="bi bi-broadcast"></i> Na ≈ºywo
            </button>
        </div>

        <div id="sidebar-footer">
            <small><strong>Event:</strong> {{ event.name }}</small>
            <a href="{{ url_for('display', event_id=event.id) }}" target="_blank" class="btn btn-sm btn-outline-secondary w-100 mb-2">
                <i class="bi bi-display"></i> Otw√≥rz Ekran Gry
            </a>
            {% if is_impersonated %}
            <a href="{{ url_for('logout_impersonate') }}" class="btn btn-sm btn-info w-100">
                Powr√≥t do panelu Admina
            </a>
            {% endif %}
        </div>
    </nav>

    <div id="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- MAIN CONTENT -->
    <main id="main-content">
        <div class="content-wrapper">

            <!-- GAME SECTION -->
            <div id="game-section" class="content-section active">
<!-- 1. INFORMACJE O GRZE (bez zmian) -->
            <div class="card mb-4">
                <div class="card-header"><h5 class="card-title mb-0" data-translate="game_info">Informacje o grze</h5></div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="player_count">Liczba graczy:</span> 
                                    <span id="info-player-count" class="badge bg-primary rounded-pill">0</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="completion_percentage">Procent uko≈Ñczenia:</span> 
                                    <span id="info-completion-percentage" class="badge bg-success rounded-pill">0%</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="language_host_label">Jƒôzyk prowadzƒÖcego:</span> 
                                    <span id="info-language" class="badge bg-secondary">Polski</span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-4">
                             <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="time_left">Czas do ko≈Ñca:</span> 
                                    <strong id="info-time-left">00:00</strong>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="time_net">Czas gry (netto):</span> 
                                    <span id="info-time-elapsed">00:00</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="time_gross">Czas gry (brutto):</span> 
                                    <span id="info-time-elapsed-pauses">00:00</span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-4">
                             <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="current_bonus">Aktualna premia:</span> 
                                    <span id="info-bonus" class="badge bg-success">Brak</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="current_speed">Aktualne tempo:</span> 
                                    <span id="info-speed" class="badge bg-info">x1</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="game_status_label">Stan gry:</span> 
                                    <span id="info-game-status" class="status-waiting">Oczekiwanie na Start</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        
            <!-- 2. OBS≈ÅUGA GRY (nowa pozycja - pe≈Çna szeroko≈õƒá) -->
            <fieldset id="pre-game-settings">
                <div class="card mb-4">
                    <div class="card-header"><h5 class="card-title mb-0" data-translate="pre_game_settings">Obs≈Çuga gry</h5></div>
                    <div class="card-body">
                        <!-- Pierwszy rzƒÖd: g≈Ç√≥wne przyciski sterowania -->
                        <div class="row g-2 mb-3">
                            <div class="col-3">
                                <button id="start-game" class="btn btn-success w-100" data-translate="start_game">Start Gry</button>
                            </div>
                            <div class="col-3">
                                <button id="pause-btn" data-control="pause" class="btn btn-warning w-100" data-translate="pause">Pauza</button>
                            </div>
                            <div class="col-3">
                                <button id="stop-game" class="btn btn-danger w-100" data-translate="stop_game">Stop Gry</button>
                            </div>
                            <div class="col-3">
                                <button id="reset-game" class="btn btn-dark w-100" data-translate="reset_game">Reset Gry</button>
                            </div>
                        </div>

                        <!-- Drugi rzƒÖd: czas gry -->
                        <div class="row g-2">
                            <div class="col-md-6">
                                <label for="game-duration-input-dashboard" class="form-label" data-translate="game_duration_label">Czas gry (minuty):</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="game-duration-input-dashboard" value="60" min="1">
                                    <button class="btn btn-primary" id="set-time-btn-dashboard" data-translate="set_time_btn">OK</button>
                                </div>
                                <small class="text-muted" data-translate="game_duration_help">Przed grƒÖ: ustaw czas. Podczas gry: zmie≈Ñ czas (wymaga has≈Ça)</small>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>

            <!-- 3. POLE HAS≈ÅO (pe≈Çna szeroko≈õƒá, klikalne) -->
            <div class="card mb-4" id="password-preview-card">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="password_preview">Has≈Ço</h5>
                </div>
                <div class="card-body text-center">
                    <div id="game-password-display" 
                         class="d-flex flex-wrap gap-1 justify-content-center" 
                         style="font-size: 1.2rem; font-family: monospace;">
                        <!-- Litery bƒôdƒÖ generowane dynamicznie -->
                    </div>
                </div>
            </div>

            <!-- 3.5 POLE WY≈öWIETLACZ (pe≈Çna szeroko≈õƒá) -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="display_panel">Wy≈õwietlacz</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3" data-translate="display_panel_description">
                        Otw√≥rz ekrany gry lub przejd≈∫ do ustawie≈Ñ wy≈õwietlacza.
                    </p>
                    <div class="d-flex flex-wrap gap-2">
                        <button class="btn btn-primary" id="open-display-1-btn">
                            <i class="bi bi-display"></i> Otw√≥rz ekran gry 1
                        </button>
                        <button class="btn btn-primary" id="open-display-2-btn">
                            <i class="bi bi-display"></i> Otw√≥rz ekran gry 2
                        </button>
                        <button class="btn btn-primary" id="open-display-3-btn">
                            <i class="bi bi-display"></i> Otw√≥rz ekran gry 3
                        </button>
                        <button class="btn btn-primary" id="open-display-4-btn">
                            <i class="bi bi-display"></i> Otw√≥rz ekran gry 4
                        </button>
                        <button class="btn btn-secondary" id="open-display-settings-btn">
                            <i class="bi bi-gear"></i> <span data-translate="display_settings">Ustawienia</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 4. KOMUNIKATY NA EKRAN GRY (pe≈Çna szeroko≈õƒá) -->
            <div class="card mb-4">
                <div class="card-header"><h5 class="card-title mb-0" data-translate="host_messages">Komunikaty na ekran gry</h5></div>
                <div class="card-body">
                    <p class="text-muted small mb-3" data-translate="messages_description">
                        Wy≈õlij komunikat, kt√≥ry pojawi siƒô na g≈Ç√≥wnym ekranie gry. U≈ºyj tego, aby przekazaƒá wa≈ºne informacje wszystkim uczestnikom.
                    </p>
                    <div class="mb-3">
                        <label for="host-message-input" class="form-label" data-translate="message_label">Tre≈õƒá komunikatu (max 500 znak√≥w):</label>
                        <textarea class="form-control" id="host-message-input" rows="3" maxlength="500" placeholder="Wpisz komunikat..."></textarea>
                        <small class="text-muted">
                            <span id="message-char-count">0</span> / 500 znak√≥w
                        </small>
                    </div>
                    <button class="btn btn-primary" id="send-message-btn" data-translate="send_message">Wy≈õlij komunikat</button>
                    <div id="message-status" class="mt-2"></div>
                </div>
            </div>
                
            <!-- 5. TEMPO GRY ORAZ PUNKTACJA (pe≈Çna szeroko≈õƒá) -->
            <fieldset id="in-game-settings" disabled>
                <div class="card mb-4">
                    <div class="card-header"><h5 class="card-title mb-0" data-translate="in_game_settings">Tempo gry oraz punktacja</h5></div>
                    <div class="card-body" id="game-controls">
                        <label class="form-label" data-translate="time_speed">Tempo czasu:</label>
                        <div class="btn-group w-100 mb-3" role="group">
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="0.5">x0,5</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="1">x1</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="2">x2</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="10">x10</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="30">x30</button>
                        </div>
                        <label class="form-label" data-translate="points_bonus">Premia punktowa:</label>
                        <div class="btn-group w-100 mb-3" role="group">
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="1">x1</button>
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="2">x2</button>
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="3">x3</button>
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="10">x10</button>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>

            <!-- SETTINGS SECTION -->
            <div id="settings-section" class="content-section ">
<!-- Dark Mode Toggle Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="appearance_settings">WyglƒÖd panelu</h5>
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 data-translate="appearance">Tryb wy≈õwietlania</h6>
                            <p class="text-muted small mb-0" data-translate="dark_mode_description">
                                Wybierz jasny lub ciemny tryb dla panelu hosta. Ciemny tryb wykorzystuje przyjemne dla oka barwy czarne i ciemnoszare.
                            </p>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center justify-content-end">
                                <span class="me-3 text-muted">Tryb jasny</span>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" role="switch" id="dark-mode-toggle" style="width: 4em; height: 2em;">
                                    <label class="form-check-label ms-3" for="dark-mode-toggle">
                                        <span id="dark-mode-status" class="badge bg-secondary">Wy≈ÇƒÖczony</span>
                                    </label>
                                </div>
                                <span class="ms-3 text-muted">Tryb ciemny</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Language Settings Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="language_tab">Ustawienia jƒôzyka</h5>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <h6 data-translate="player_language">Jƒôzyk graczy</h6>
                        <div class="btn-group w-100" role="group" id="lang-player-controls">
                            <button type="button" class="btn btn-outline-primary active-modifier" data-control="language_player" data-value="pl" data-translate="lang_polish">Jƒôzyk polski</button>
                            <button type="button" class="btn btn-outline-primary" data-control="language_player" data-value="en" data-translate="lang_english">Jƒôzyk angielski</button>
                            <button type="button" class="btn btn-outline-primary" data-control="language_player" data-value="de" data-translate="lang_german">Jƒôzyk niemiecki</button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <h6 data-translate="host_language">Jƒôzyk prowadzƒÖcego</h6>
                        <div class="btn-group w-100" role="group" id="lang-host-controls">
                            <button type="button" class="btn btn-outline-primary active-modifier" data-control="language_host" data-value="pl" data-translate="lang_polish">Jƒôzyk polski</button>
                            <button type="button" class="btn btn-outline-primary" data-control="language_host" data-value="en" data-translate="lang_english">Jƒôzyk angielski</button>
                            <button type="button" class="btn btn-outline-primary" data-control="language_host" data-value="de" data-translate="lang_german">Jƒôzyk niemiecki</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

            <!-- TIMING SECTION -->
            <div id="timing-section" class="content-section ">
<fieldset id="timing-settings" disabled>
                <div class="card mb-4">
                    <div class="card-header"><h5 class="card-title mb-0" data-translate="timing_settings">Czas i tempo gry</h5></div>
                    <div class="card-body" id="timing-controls">
                        <div class="mb-3">
                            <label for="game-duration-input-2" class="form-label" data-translate="game_duration_label">Czas gry (minuty):</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="game-duration-input-2" value="60" min="1">
                                <button class="btn btn-primary" id="set-time-btn-2" data-translate="set_time_btn">OK</button>
                            </div>
                            <small class="text-muted" data-translate="game_duration_help">Przed grƒÖ: ustaw czas. Podczas gry: zmie≈Ñ czas (wymaga has≈Ça)</small>
                        </div>
        
                        <hr>
        
                        <label class="form-label" data-translate="time_speed">Tempo czasu:</label>
                        <div class="btn-group w-100 mb-3" role="group">
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="0.5">x0,5</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="1">x1</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="2">x2</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="10">x10</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="30">x30</button>
                        </div>
                        <label class="form-label" data-translate="points_bonus">Premia punktowa:</label>
                        <div class="btn-group w-100 mb-3" role="group">
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="1">x1</button>
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="2">x2</button>
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="3">x3</button>
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="10">x10</button>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>

            <!-- PLAYERS SECTION -->
            <div id="players-section" class="content-section ">
<div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="players_management">ZarzƒÖdzanie graczami</h5>
                </div>
                <div class="card-body">
                    <div id="players-list"></div>
                </div>
            </div>

            <!-- Sekcja zabezpiecze≈Ñ rejestracji -->
            <div class="card mb-3 mt-3">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">üîí Zabezpieczenia Rejestracji</h5>
                    <button class="btn btn-sm btn-info" onclick="loadSecurityStats()">üîÑ Od≈õwie≈º</button>
                </div>
                <div class="card-body">
                    <!-- Ustawienia limit√≥w -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label class="form-label">
                                <strong>Limit graczy z jednego IP:</strong>
                                <small class="text-muted">(dla WiFi publicznego)</small>
                            </label>
                            <input type="number" id="limit-ip" class="form-control" min="1" max="20" value="3">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">
                                <strong>Limit graczy z jednego urzƒÖdzenia:</strong>
                                <small class="text-muted">(fingerprint)</small>
                            </label>
                            <input type="number" id="limit-device" class="form-control" min="1" max="5" value="1">
                        </div>
                    </div>

                    <button class="btn btn-primary mb-3" onclick="updateSecurityLimits()">üíæ Zapisz Limity</button>

                    <!-- Statystyki -->
                    <div id="security-stats" class="mt-3">
                        <div class="text-center text-muted">
                            <p>Kliknij "Od≈õwie≈º" aby zobaczyƒá statystyki</p>
                        </div>
                    </div>

                    <!-- Akcje czyszczenia -->
                    <div class="mt-4 border-top pt-3">
                        <h6>üßπ Czyszczenie Duplikat√≥w</h6>
                        <div class="btn-group" role="group">
                            <button class="btn btn-warning" onclick="cleanupDuplicates('fingerprint')">
                                Usu≈Ñ duplikaty urzƒÖdze≈Ñ
                            </button>
                            <button class="btn btn-warning" onclick="cleanupDuplicates('ip')">
                                Usu≈Ñ duplikaty IP
                            </button>
                            <button class="btn btn-danger" onclick="cleanupDuplicates('both')">
                                Usu≈Ñ wszystkie duplikaty
                            </button>
                        </div>
                        <small class="d-block mt-2 text-muted">
                            ‚ö†Ô∏è Pozostawi tylko graczy z najwy≈ºszym wynikiem
                        </small>
                    </div>
                </div>
            </div>
        </div>
            </div>

            <!-- PASSWORD SECTION -->
            <div id="password-section" class="content-section ">
<div class="card mb-3">
                <div class="card-header"><h5 class="card-title mb-0">1. Edycja has≈Ça</h5></div>
                <div class="card-body">
                    <p class="text-muted small">Wpisz has≈Ço, kt√≥re gracze bƒôdƒÖ ods≈Çaniaƒá podczas gry (mo≈ºliwe tylko przed startem gry).</p>
                    <div class="input-group">
                        <input type="text" class="form-control" id="password-edit-input" maxlength="50" placeholder="np. SAPEREVENT" value="SAPEREVENT">
                        <button class="btn btn-primary" id="password-edit-ok-btn">OK</button>
                    </div>
                    <small class="text-muted">Max 50 znak√≥w. Spacje sƒÖ dozwolone.</small>
                    <div id="password-edit-status" class="mt-2"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><h5 class="card-title mb-0">2. Kontrola has≈Ça</h5></div>
                <div class="card-body">
                    <p class="text-muted small">ZarzƒÖdzaj odkrywaniem liter has≈Ça. Odkrywanie rƒôczne jest zawsze dostƒôpne.</p>
                    
                    <!-- Prze≈ÇƒÖcznik automatycznego odkrywania -->
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="form-label fw-bold mb-0">Odkrywanie automatyczne:</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="password-auto-reveal-toggle"
                                       style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="password-auto-reveal-toggle">
                                    <span id="auto-reveal-status" class="badge bg-success">W≈ÇƒÖczone</span>
                                </label>
                            </div>
                        </div>

                        <!-- Ustawienie procentu odkrywania -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">Udzia≈Ç % gry do aktywacji litery:</label>
                            <div class="input-group" style="max-width: 200px;">
                                <input type="number" class="form-control" id="auto-reveal-percentage"
                                       min="1" max="100" value="50" step="1">
                                <span class="input-group-text">%</span>
                            </div>
                            <small class="text-muted d-block mt-1">
                                Gdy gracz zdobƒôdzie ten procent punkt√≥w z puli, odkryje losowƒÖ literƒô.<br>
                                Przyk≈Çad: max punkt√≥w 400, ustawienie 10% = odkrycie litery co 40 punkt√≥w.
                            </small>
                        </div>

                        <small class="text-muted d-block">
                            Gdy w≈ÇƒÖczone: litery odkrywane automatycznie wed≈Çug powy≈ºszego ustawienia (oznaczone na zielono).<br>
                            Odkrywanie rƒôczne jest zawsze dostƒôpne niezale≈ºnie od ustawienia.
                        </small>
                    </div>

                    <hr>

                    <!-- Sekcja odkrywania has≈Ça -->
                    <h6 class="mb-3">Has≈Ço do ods≈Çoniƒôcia:</h6>
                    <p class="text-muted small mb-3">
                        üü¢ Zielone - ods≈Çoniƒôte | üî¥ Czerwone - zakryte<br>
                        Kliknij na czerwonƒÖ literƒô, aby jƒÖ ods≈Çoniƒá rƒôcznie. Ka≈ºda litera jest traktowana indywidualnie.
                    </p>
                    <div id="password-letters-display" class="d-flex flex-wrap gap-2 justify-content-center mb-3" style="font-size: 1.8rem; font-family: monospace;">
                        <!-- Litery bƒôdƒÖ generowane dynamicznie -->
                    </div>
                    <button class="btn btn-success w-100" id="reveal-selected-letters-btn" disabled>
                        Potwierd≈∫ ods≈Çoniƒôcie wybranych liter
                    </button>
                    <div id="password-reveal-status" class="mt-2"></div>
                </div>
            </div>
        </div>
            </div>

            <!-- DISPLAY SECTION -->
            <div id="display-section" class="content-section ">
<div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="display_tab">Ustawienia wy≈õwietlacza</h5>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <h6 data-translate="display_screens">Liczba ekran√≥w zewnƒôtrznych:</h6>
                        <div class="btn-group w-100" role="group" id="display-screens-controls">
                            <button type="button" class="btn btn-outline-primary" data-control="display_screens" data-value="1" data-translate="one_screen">1 Ekran</button>
                            <button type="button" class="btn btn-outline-primary active-modifier" data-control="display_screens" data-value="2" data-translate="two_screens">2 Ekrany</button>
                            <button type="button" class="btn btn-outline-primary" data-control="display_screens" data-value="3" data-translate="three_screens">3 Ekrany</button>
                            <button type="button" class="btn btn-outline-primary" data-control="display_screens" data-value="4" data-translate="four_screens">4 Ekrany</button>
                        </div>
                        <small class="text-muted d-block mt-2">
                            <strong>1 ekran:</strong> Tytu≈Ç eventu, Nazwa firmy Bomba, Has≈Ço<br>
                            <strong>2 ekrany:</strong> Ekran 1 - Tytu≈Ç eventu, Nazwa firmy Bomba, Has≈Ço | Ekran 2 - Ranking i komentarze hosta<br>
                            <strong>3 ekrany:</strong> Ekran 1 - Tytu≈Ç eventu, Nazwa firmy Bomba, Has≈Ço | Ekran 2 - Ranking i komentarze hosta | Ekran 3 - Zabawne Selfie w karuzeli<br>
                            <strong>4 ekrany:</strong> Ekran 1 - Tytu≈Ç eventu, Nazwa firmy Bomba, Has≈Ço | Ekran 2 - Ranking i komentarze hosta | Ekran 3 - Zabawne Selfie w karuzeli | Ekran 4 - Kod gracza i przedmioty AR do znalezienia
                        </small>
                    </div>

                    <div class="mt-4">
                        <h6>Linki do ekran√≥w:</h6>
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('display', event_id=event.id) }}" target="_blank" class="btn btn-secondary" id="display1-link">
                                üñ•Ô∏è Ekran 1 - G≈Ç√≥wny wy≈õwietlacz
                            </a>
                            <div class="alert alert-info mb-2">
                                <small><strong>Link do ekranu 1:</strong></small><br>
                                <small><a href="{{ url_for('display', event_id=event.id, _external=True) }}" target="_blank" class="text-break">{{ url_for('display', event_id=event.id, _external=True) }}</a></small>
                            </div>

                            <a href="{{ url_for('display2', event_id=event.id) }}" target="_blank" class="btn btn-secondary" id="display2-link">
                                üñ•Ô∏è Ekran 2 - Ranking i zdjƒôcia
                            </a>
                            <div class="alert alert-info mb-2">
                                <small><strong>Link do ekranu 2:</strong></small><br>
                                <small><a href="{{ url_for('display2', event_id=event.id, _external=True) }}" target="_blank" class="text-break">{{ url_for('display2', event_id=event.id, _external=True) }}</a></small>
                            </div>

                            <a href="{{ url_for('photo_player', event_id=event.id) }}" target="_blank" class="btn btn-secondary" id="display3-link">
                                üñ•Ô∏è Ekran 3 - Selfie
                            </a>
                            <div class="alert alert-info mb-2">
                                <small><strong>Link do ekranu 3:</strong></small><br>
                                <small><a href="{{ url_for('photo_player', event_id=event.id, _external=True) }}" target="_blank" class="text-break">{{ url_for('photo_player', event_id=event.id, _external=True) }}</a></small>
                            </div>

                            <a href="{{ url_for('display4', event_id=event.id) }}" target="_blank" class="btn btn-secondary" id="display4-link">
                                üñ•Ô∏è Ekran 4 - Przemioty do znalezienia oraz kod gracza
                            </a>
                            <div class="alert alert-info mb-2">
                                <small><strong>Link do ekranu 4:</strong></small><br>
                                <small><a href="{{ url_for('display4', event_id=event.id, _external=True) }}" target="_blank" class="text-break">{{ url_for('display4', event_id=event.id, _external=True) }}</a></small>
                            </div>

                            <a href="{{ url_for('display5', event_id=event.id) }}" target="_blank" class="btn btn-secondary" id="display5-link">
                                üñ•Ô∏è Ekran 5 - G≈Çosowanie lub Pytania na ≈ªywo
                            </a>
                            <div class="alert alert-info mb-0">
                                <small><strong>Link do ekranu 5:</strong></small><br>
                                <small><a href="{{ url_for('display5', event_id=event.id, _external=True) }}" target="_blank" class="text-break">{{ url_for('display5', event_id=event.id, _external=True) }}</a></small>
                            </div>
                        </div>
                    </div>

                    <div id="display-status" class="mt-3 alert alert-info">
                        Aktualnie uruchomione: <strong>2 ekrany</strong>
                    </div>
                </div>
            </div>
        </div>
            </div>

            <!-- QRCODES SECTION -->
            <div id="qrcodes-section" class="content-section ">
<!-- Kod QR Gracza -->
            <div class="card mx-auto mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">üì± Kod QR Gracza</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-success">
                        <strong>‚ÑπÔ∏è Instrukcja:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Ten kod QR pozwala graczom do≈ÇƒÖczyƒá do gry</li>
                            <li>Gracz skanuje kod, wpisuje swoje imiƒô i otrzymuje dostƒôp do panelu</li>
                            <li>Wydrukuj i umie≈õƒá kod w widocznym miejscu</li>
                        </ul>
                    </div>

                    <div class="d-grid gap-2">
                        <a href="/player_qr_preview/{{ event.id }}" target="_blank" class="btn btn-success btn-lg">
                            üîç PodglƒÖd i Druk Kodu QR
                        </a>
                    </div>
                </div>
            </div>

        </div>
            </div>

            <!-- AR SECTION -->
            <div id="ar-section" class="content-section ">
<div class="card">
                <div class="card-header"><h5 class="card-title mb-0" data-translate="ar_tab">Rozszerzona rzeczywisto≈õƒá (AR)</h5></div>
                <div class="card-body">
                    <h6>1. Zdefiniuj obiekty AR</h6>
                    <p class="text-muted">Sfotografuj przedmioty, kt√≥re bƒôdƒÖ wyzwalaƒá gry po rozpoznaniu przez graczy.</p>

                    <div class="row g-3 mb-4" id="ar-objects-container">
                        <!-- Obiekty AR bƒôdƒÖ dodawane tutaj dynamicznie -->
                    </div>

                    <button class="btn btn-success mb-4" onclick="addNewARObject()">
                        + Dodaj nowy obiekt AR
                    </button>

                    <hr>

                    <h6>2. Kod QR dla graczy (AR Scanner)</h6>
                    <p class="text-muted">Wygeneruj kod QR, kt√≥ry gracze bƒôdƒÖ skanowaƒá, aby uruchomiƒá skaner AR.</p>
                    <div class="text-center">
                        <a href="/ar_qr_preview/{{ event.id }}" target="_blank" class="btn btn-success btn-lg">
                            üîç PodglƒÖd i Druk Kodu QR AR
                        </a>
                    </div>
                </div>
            </div>
        </div>
            </div>

            <!-- QUESTIONS SECTION -->
            <div id="questions-section" class="content-section ">
<div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0" data-translate="questions_management">ZarzƒÖdzanie pytaniami</h5>
                    <button class="btn btn-primary" id="add-question-btn" data-translate="add_question">Dodaj pytanie</button>
                </div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="questions-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="questions-enabled">
                                    <span id="questions-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli skanowaƒá bia≈Çych kod√≥w QR do pyta≈Ñ</small>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>

                            <!-- Kody QR dla ≈Çatwych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-success mb-2">≈Åatwe pytania:</h6>
                                <button id="questions-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈Çatwych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="questions-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ</button>
                                    <button id="questions-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈Çatwych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla ≈õrednich pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-warning mb-2">≈örednie pytania:</h6>
                                <button id="questions-medium-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈õrednich pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="questions-medium-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ</button>
                                    <button id="questions-medium-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈õrednich pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla trudnych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-danger mb-2">Trudne pytania:</h6>
                                <button id="questions-hard-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla trudnych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="questions-hard-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ</button>
                                    <button id="questions-hard-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla trudnych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla mieszanych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-info mb-2">Mieszane pytania:</h6>
                                <button id="questions-mixed-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla mieszanych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="questions-mixed-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ</button>
                                    <button id="questions-mixed-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla mieszanych pyta≈Ñ</button>
                                </div>
                            </div>

                            <small class="text-muted d-block mt-2">Zapasowe kody QR mogƒÖ byƒá u≈ºyte jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia gry</h6>

                            <!-- Punkty za ≈Çatwe pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈Çatwe pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="questions-easy-points" value="5" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateQuestionsSetting('easy_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 5 punkt√≥w</small>
                            </div>

                            <!-- Punkty za ≈õrednie pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈õrednie pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="questions-medium-points" value="10" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateQuestionsSetting('medium_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 10 punkt√≥w</small>
                            </div>

                            <!-- Punkty za trudne pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na trudne pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="questions-hard-points" value="15" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateQuestionsSetting('hard_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 15 punkt√≥w</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div id="questions-list"></div>
                </div>
            </div>
        </div>
            </div>

            <!-- QUESTIONS-R2 SECTION -->
            <div id="questions-r2-section" class="content-section ">
<div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">ZarzƒÖdzanie pytaniami - Runda 2</h5>
                    <button class="btn btn-primary" id="r2-add-question-btn">Dodaj pytanie</button>
                </div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="r2-questions-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="r2-questions-enabled">
                                    <span id="r2-questions-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli skanowaƒá bia≈Çych kod√≥w QR do pyta≈Ñ</small>

                            <!-- Timer do automatycznego uruchomienia -->
                            <div class="mt-3">
                                <label class="form-label"><strong>Czas do uruchomienia:</strong></label>
                                <div class="input-group" style="max-width: 400px;">
                                    <input type="number" class="form-control" id="r2-questions-timer-minutes" placeholder="Minuty" min="1" max="1440">
                                    <button class="btn btn-primary" onclick="startR2QuestionsTimer()">OK</button>
                                    <button class="btn btn-danger" onclick="cancelR2QuestionsTimer()" id="r2-questions-timer-cancel" style="display: none;">Anuluj</button>
                                </div>
                                <div id="r2-questions-timer-display" class="mt-2" style="display: none;">
                                    <span class="badge bg-info">Timer aktywny: <span id="r2-questions-timer-countdown"></span></span>
                                </div>
                                <small class="text-muted">Pytania zostanƒÖ automatycznie uruchomione po okre≈õlonym czasie</small>
                            </div>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>

                            <!-- Prze≈ÇƒÖczniki -->
                            <div class="mb-3">
                                <div class="form-check form-switch mb-2">
                                    <input class="form-check-input" type="checkbox" id="r2-use-round1-qr" onchange="toggleR2Round1QR()">
                                    <label class="form-check-label" for="r2-use-round1-qr">
                                        <strong>QR z Pytania runda 1</strong>
                                    </label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="r2-disable-other-rounds" disabled onchange="toggleR2DisableOtherRounds()">
                                    <label class="form-check-label" for="r2-disable-other-rounds">
                                        <strong>Wy≈ÇƒÖcz pytania z innych rund</strong>
                                        <small class="text-muted d-block">Po zczytaniu QR gracz nie ma dostƒôpu do pyta≈Ñ z rundy 1</small>
                                    </label>
                                </div>
                            </div>

                            <!-- Kody QR dla ≈Çatwych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-success mb-2">≈Åatwe pytania:</h6>
                                <button id="r2-questions-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈Çatwych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r2-questions-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ</button>
                                    <button id="r2-questions-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈Çatwych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla ≈õrednich pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-warning mb-2">≈örednie pytania:</h6>
                                <button id="r2-questions-medium-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈õrednich pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r2-questions-medium-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ</button>
                                    <button id="r2-questions-medium-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈õrednich pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla trudnych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-danger mb-2">Trudne pytania:</h6>
                                <button id="r2-questions-hard-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla trudnych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r2-questions-hard-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ</button>
                                    <button id="r2-questions-hard-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla trudnych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla mieszanych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-info mb-2">Mieszane pytania:</h6>
                                <button id="r2-questions-mixed-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla mieszanych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r2-questions-mixed-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ</button>
                                    <button id="r2-questions-mixed-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla mieszanych pyta≈Ñ</button>
                                </div>
                            </div>

                            <small class="text-muted d-block mt-2">Zapasowe kody QR mogƒÖ byƒá u≈ºyte jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia gry</h6>

                            <!-- Punkty za ≈Çatwe pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈Çatwe pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="r2-questions-easy-points" value="5" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateR2QuestionsSetting('easy_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 5 punkt√≥w</small>
                            </div>

                            <!-- Punkty za ≈õrednie pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈õrednie pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="r2-questions-medium-points" value="10" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateR2QuestionsSetting('medium_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 10 punkt√≥w</small>
                            </div>

                            <!-- Punkty za trudne pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na trudne pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="r2-questions-hard-points" value="15" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateR2QuestionsSetting('hard_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 15 punkt√≥w</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div id="r2-questions-list"></div>
                </div>
            </div>
        </div>

        <!-- Pytania Runda 3 -->
            </div>

            <!-- QUESTIONS-R3 SECTION -->
            <div id="questions-r3-section" class="content-section ">
<div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">ZarzƒÖdzanie pytaniami - Runda 3</h5>
                    <button class="btn btn-primary" id="r3-add-question-btn">Dodaj pytanie</button>
                </div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="r3-questions-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="r3-questions-enabled">
                                    <span id="r3-questions-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli skanowaƒá bia≈Çych kod√≥w QR do pyta≈Ñ</small>

                            <!-- Timer do automatycznego uruchomienia -->
                            <div class="mt-3">
                                <label class="form-label"><strong>Czas do uruchomienia:</strong></label>
                                <div class="input-group" style="max-width: 400px;">
                                    <input type="number" class="form-control" id="r3-questions-timer-minutes" placeholder="Minuty" min="1" max="1440">
                                    <button class="btn btn-primary" onclick="startR3QuestionsTimer()">OK</button>
                                    <button class="btn btn-danger" onclick="cancelR3QuestionsTimer()" id="r3-questions-timer-cancel" style="display: none;">Anuluj</button>
                                </div>
                                <div id="r3-questions-timer-display" class="mt-2" style="display: none;">
                                    <span class="badge bg-info">Timer aktywny: <span id="r3-questions-timer-countdown"></span></span>
                                </div>
                                <small class="text-muted">Pytania zostanƒÖ automatycznie uruchomione po okre≈õlonym czasie</small>
                            </div>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>

                            <!-- Prze≈ÇƒÖczniki -->
                            <div class="mb-3">
                                <div class="form-check form-switch mb-2">
                                    <input class="form-check-input" type="checkbox" id="r3-use-round1-qr" onchange="toggleR3Round1QR()">
                                    <label class="form-check-label" for="r3-use-round1-qr">
                                        <strong>QR z Pytania runda 1</strong>
                                    </label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="r3-disable-other-rounds" disabled onchange="toggleR3DisableOtherRounds()">
                                    <label class="form-check-label" for="r3-disable-other-rounds">
                                        <strong>Wy≈ÇƒÖcz pytania z innych rund</strong>
                                        <small class="text-muted d-block">Po zczytaniu QR gracz nie ma dostƒôpu do pyta≈Ñ z rund 1 i 2</small>
                                    </label>
                                </div>
                            </div>

                            <!-- Kody QR dla ≈Çatwych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-success mb-2">≈Åatwe pytania:</h6>
                                <button id="r3-questions-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈Çatwych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r3-questions-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ</button>
                                    <button id="r3-questions-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈Çatwych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla ≈õrednich pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-warning mb-2">≈örednie pytania:</h6>
                                <button id="r3-questions-medium-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈õrednich pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r3-questions-medium-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ</button>
                                    <button id="r3-questions-medium-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈õrednich pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla trudnych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-danger mb-2">Trudne pytania:</h6>
                                <button id="r3-questions-hard-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla trudnych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r3-questions-hard-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ</button>
                                    <button id="r3-questions-hard-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla trudnych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla mieszanych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-info mb-2">Mieszane pytania:</h6>
                                <button id="r3-questions-mixed-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla mieszanych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r3-questions-mixed-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ</button>
                                    <button id="r3-questions-mixed-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla mieszanych pyta≈Ñ</button>
                                </div>
                            </div>

                            <small class="text-muted d-block mt-2">Zapasowe kody QR mogƒÖ byƒá u≈ºyte jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia gry</h6>

                            <!-- Punkty za ≈Çatwe pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈Çatwe pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="r3-questions-easy-points" value="5" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateR3QuestionsSetting('easy_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 5 punkt√≥w</small>
                            </div>

                            <!-- Punkty za ≈õrednie pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈õrednie pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="r3-questions-medium-points" value="10" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateR3QuestionsSetting('medium_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 10 punkt√≥w</small>
                            </div>

                            <!-- Punkty za trudne pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na trudne pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="r3-questions-hard-points" value="15" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateR3QuestionsSetting('hard_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 15 punkt√≥w</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div id="r3-questions-list"></div>
                </div>
            </div>
        </div>
            </div>

            <!-- AI SECTION -->
            <div id="ai-section" class="content-section ">
<div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Kategorie AI - Pytania generowane automatycznie</h5>
                    <p class="text-muted mb-0 mt-2 small">Gracze po zeskanowaniu bia≈Çego kodu QR otrzymujƒÖ pytania z wybranej kategorii. Za poprawnƒÖ odpowied≈∫: 5 punkt√≥w.</p>
                </div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="ai-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="ai-enabled">
                                    <span id="ai-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli skanowaƒá bia≈Çych kod√≥w QR do pyta≈Ñ AI</small>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>

                            <!-- Kody QR dla ≈Çatwych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-success mb-2">≈Åatwe pytania:</h6>
                                <button id="ai-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈Çatwych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="ai-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ</button>
                                    <button id="ai-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈Çatwych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla ≈õrednich pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-warning mb-2">≈örednie pytania:</h6>
                                <button id="ai-medium-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈õrednich pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="ai-medium-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ</button>
                                    <button id="ai-medium-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈õrednich pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla trudnych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-danger mb-2">Trudne pytania:</h6>
                                <button id="ai-hard-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla trudnych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="ai-hard-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ</button>
                                    <button id="ai-hard-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla trudnych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla mieszanych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-info mb-2">Mieszane pytania:</h6>
                                <button id="ai-mixed-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla mieszanych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="ai-mixed-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ</button>
                                    <button id="ai-mixed-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla mieszanych pyta≈Ñ</button>
                                </div>
                            </div>

                            <small class="text-muted d-block mt-2">Zapasowe kody QR mogƒÖ byƒá u≈ºyte jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia gry</h6>

                            <!-- Punkty za ≈Çatwe pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈Çatwe pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="ai-easy-points" value="5" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateAISetting('easy_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 5 punkt√≥w</small>
                            </div>

                            <!-- Punkty za ≈õrednie pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈õrednie pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="ai-medium-points" value="10" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateAISetting('medium_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 10 punkt√≥w</small>
                            </div>

                            <!-- Punkty za trudne pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na trudne pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="ai-hard-points" value="15" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateAISetting('hard_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 15 punkt√≥w</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <h6 class="mb-3">Dodaj kategoriƒô:</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label for="custom-category-name" class="form-label">Nazwa kategorii</label>
                            <input type="text" class="form-control" id="custom-category-name" placeholder="np. Film, Geografia, Medycyna">
                        </div>
                        <div class="col-md-4">
                            <label for="custom-category-difficulty" class="form-label">Poziom trudno≈õci</label>
                            <select class="form-select" id="custom-category-difficulty">
                                <option value="easy">≈Åatwy</option>
                                <option value="medium">≈öredni</option>
                                <option value="advanced">Zaawansowany</option>
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button class="btn btn-success w-100" id="add-custom-category-btn">Dodaj kategoriƒô</button>
                        </div>
                    </div>

                    <hr>

                    <h6 class="mb-3">Twoje kategorie:</h6>
                    <div id="ai-categories-list"></div>
                </div>
            </div>
        </div>

        <!-- Pytania Runda 2 -->
            </div>

            <!-- FORTUNE SECTION -->
            <div id="fortune-section" class="content-section ">
<div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="fortune_title">Wr√≥≈ºka AI - atrakcja wykorzystujƒÖca sztucznƒÖ inteligencjƒô</h5>
                    <p class="text-muted mb-0 mt-2 small" data-translate="fortune_description">Gracze po zeskanowaniu kodu QR otrzymujƒÖ mo≈ºliwo≈õƒá opisania ostatniego snu, by uzyskaƒá przepowiedniƒô.</p>
                </div>
                <div class="card-body">
                    <!-- Stan gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="fortune-enabled" style="width: 3em; height: 1.5em;">
                                <label class="form-check-label ms-2" for="fortune-enabled">
                                    <span id="fortune-status" class="badge bg-secondary">Nieaktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli korzystaƒá z wr√≥≈ºki AI</small>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>
                            <button id="fortune-qr-btn" class="btn btn-primary mb-3 w-100">üì± PodglƒÖd i druk kodu QR</button>

                            <div class="d-flex gap-2 mt-3">
                                <button id="fortune-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR</button>
                                <button id="fortune-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR</button>
                            </div>
                            <small class="text-muted d-block mt-2">Zapasowy kod QR mo≈ºe byƒá u≈ºyty jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia gry</h6>

                            <!-- Liczba s≈Ç√≥w AI -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba s≈Ç√≥w (AI):</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="fortune-word-count" value="300" min="10" max="500">
                                    <button class="btn btn-primary" onclick="updateFortuneSetting('word_count')">OK</button>
                                </div>
                                <small class="text-muted">Zakres: 10-500 (domy≈õlnie: 300)</small>
                            </div>

                            <!-- Punkty za udzia≈Ç -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za udzia≈Ç:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="fortune-points" value="5" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateFortuneSetting('points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 5 punkt√≥w</small>
                            </div>

                            <!-- Liczba s≈Ç√≥w gracza -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba s≈Ç√≥w gracza:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="fortune-player-words" value="2" min="1" max="10">
                                    <button class="btn btn-primary" onclick="updateFortuneSetting('player_words')">OK</button>
                                </div>
                                <small class="text-muted">Zakres: 1-10 (domy≈õlnie: 2). Ile s≈Ç√≥w gracz musi wpisaƒá opisujƒÖc sen</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            </div>

            <!-- MINIGAMES SECTION -->
            <div id="minigames-section" class="content-section ">
<div class="card">
                <div class="card-header"><h5 class="card-title mb-0">ZarzƒÖdzanie minigrami</h5></div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="minigames-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="minigames-enabled">
                                    <span id="minigames-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli skanowaƒá zielonych kod√≥w QR do minigier</small>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>
                            <button id="minigames-qr-btn" class="btn btn-primary mb-3 w-100">üì± PodglƒÖd i druk kodu QR</button>

                            <div class="d-flex gap-2 mt-3">
                                <button id="minigames-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR</button>
                                <button id="minigames-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR</button>
                            </div>
                            <small class="text-muted d-block mt-2">Zapasowy kod QR mo≈ºe byƒá u≈ºyty jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia gry</h6>

                            <!-- Punkty za przej≈õcie gry -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za przej≈õcie gry:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="minigame-completion-points" value="10" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateMinigameSetting('completion_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 10 punkt√≥w</small>
                            </div>

                            <!-- Punkty do zdobycia w grze -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w do zdobycia w grze:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="minigame-target-points" value="20" min="1" max="200">
                                    <button class="btn btn-primary" onclick="updateMinigameSetting('target_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 20 punkt√≥w (pod tƒô warto≈õƒá gry sƒÖ zoptymalizowane)</small>
                            </div>

                            <!-- Prze≈ÇƒÖcznik wyboru gry -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Wyb√≥r gry:</strong></label>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="minigame-player-choice" style="width: 3em; height: 1.5em;">
                                    <label class="form-check-label ms-2" for="minigame-player-choice">
                                        <span id="minigame-choice-status" class="badge bg-secondary">Losowa kolejno≈õƒá</span>
                                    </label>
                                </div>
                                <small class="text-muted">Gdy w≈ÇƒÖczone, gracz po zeskanowaniu kodu QR bƒôdzie m√≥g≈Ç wybraƒá grƒô. Gdy wy≈ÇƒÖczone, gry uruchamiajƒÖ siƒô w losowej kolejno≈õci.</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div class="alert alert-info" id="minigames-info-alert">
                        <strong>Informacja:</strong> Minigry aktywowane przez zielone kody QR.
                        Ka≈ºda minigra wymaga zdobycia <span id="minigame-target-display">20</span> punkt√≥w, aby otrzymaƒá nagrodƒô <span id="minigame-completion-display">10</span> punkt√≥w.
                    </div>
                    
                    <!-- TETRIS -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1">üéÆ Tetris</h5>
                                    <p class="text-muted mb-0">Cel: 20 punkt√≥w (u≈Ç√≥≈º linie)</p>
                                    <small class="text-muted">Sterowanie: strza≈Çki + obr√≥t</small>
                                </div>
                                <div class="d-flex gap-2 align-items-center">
                                    <button class="btn btn-sm btn-info" id="tetris-test-btn">Test</button>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" id="tetris-toggle"
                                               style="width: 3em; height: 1.5em;">
                                        <label class="form-check-label ms-2" for="tetris-toggle">
                                            <span id="tetris-status" class="badge bg-secondary">Nieaktywny</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
        
                    <!-- ARKANOID -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1">üèì Arkanoid</h5>
                                    <p class="text-muted mb-0">Cel: 20 punkt√≥w (zbij ceg≈Çy)</p>
                                    <small class="text-muted">3 ≈ºycia | Sterowanie: przyciski ‚óÑ ‚ñ∫</small>
                                </div>
                                <div class="d-flex gap-2 align-items-center">
                                    <button class="btn btn-sm btn-info" id="arkanoid-test-btn">Test</button>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" id="arkanoid-toggle"
                                               style="width: 3em; height: 1.5em;">
                                        <label class="form-check-label ms-2" for="arkanoid-toggle">
                                            <span id="arkanoid-status" class="badge bg-secondary">Nieaktywny</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SNAKE -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1">üêç Snake</h5>
                                    <p class="text-muted mb-0">Cel: 20 punkt√≥w (zbieraj jedzenie)</p>
                                    <small class="text-muted">Sterowanie: przyciski ‚ñ≤ ‚ñº ‚óÑ ‚ñ∫</small>
                                </div>
                                <div class="d-flex gap-2 align-items-center">
                                    <button class="btn btn-sm btn-info" id="snake-test-btn">Test</button>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" id="snake-toggle"
                                               style="width: 3em; height: 1.5em;">
                                        <label class="form-check-label ms-2" for="snake-toggle">
                                            <span id="snake-status" class="badge bg-secondary">Nieaktywny</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- T-REX -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1">ü¶ñ T-Rex</h5>
                                    <p class="text-muted mb-0">Cel: 20 punkt√≥w (unikaj przeszk√≥d)</p>
                                    <small class="text-muted">Sterowanie: przycisk skoku</small>
                                </div>
                                <div class="d-flex gap-2 align-items-center">
                                    <button class="btn btn-sm btn-info" id="trex-test-btn">Test</button>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" id="trex-toggle"
                                               style="width: 3em; height: 1.5em;">
                                        <label class="form-check-label ms-2" for="trex-toggle">
                                            <span id="trex-status" class="badge bg-secondary">Nieaktywny</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-warning mt-3" id="minigames-info" style="display: none;"></div>
                </div>
            </div>
        </div>
            </div>

            <!-- PHOTO SECTION -->
            <div id="photo-section" class="content-section ">
<div class="card">
                <div class="card-header"><h5 class="card-title mb-0" data-translate="photo_tab">Galeria zdjƒôƒá</h5></div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="photo-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="photo-enabled">
                                    <span id="photo-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli robiƒá i przesy≈Çaƒá zdjƒôƒá</small>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>
                            <button id="photo-qr-btn" class="btn btn-primary mb-3 w-100">üì± PodglƒÖd i druk kodu QR</button>

                            <div class="d-flex gap-2 mt-3">
                                <button id="photo-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR</button>
                                <button id="photo-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR</button>
                            </div>
                            <small class="text-muted d-block mt-2">Zapasowy kod QR mo≈ºe byƒá u≈ºyty jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia gry</h6>

                            <!-- Punkty za wykonane zdjƒôcie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za wykonane zdjƒôcie selfie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="photo-selfie-points" value="30" min="1" max="1000">
                                    <button class="btn btn-primary" onclick="updatePhotoSetting('selfie_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 30 punkt√≥w</small>
                            </div>

                            <!-- Punkty za polubienie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za polubienie czyjego≈õ zdjƒôcia selfie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="photo-like-given-points" value="2" min="0" max="100">
                                    <button class="btn btn-primary" onclick="updatePhotoSetting('like_given_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 2 punkty</small>
                            </div>

                            <!-- Punkty za uzyskanie polubienia -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za uzyskanie polubienia (like) dla zdjƒôcia selfie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="photo-like-received-points" value="5" min="0" max="100">
                                    <button class="btn btn-primary" onclick="updatePhotoSetting('like_received_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 5 punkt√≥w</small>
                            </div>

                            <!-- Maksymalna liczba polubie≈Ñ -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Maksymalna liczba zdjƒôƒá selfie do polubienia:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="photo-max-likes" value="10" min="1" max="1000">
                                    <button class="btn btn-primary" onclick="updatePhotoSetting('max_likes')">OK</button>
                                </div>
                                <small class="text-muted">Ile jeden uczestnik mo≈ºe polubiƒá maksymalnie zdjƒôƒá innych graczy</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <h6>Galeria zdjƒôƒá graczy</h6>
                    <p data-translate="photo_description" class="text-muted">Poni≈ºej zdjƒôcia przes≈Çane przez graczy, posortowane wed≈Çug liczby polubie≈Ñ.</p>

                    <div id="host-photo-gallery" class="row g-3 mt-3">
                        <!-- Zdjƒôcia bƒôdƒÖ tutaj ≈Çadowane dynamicznie -->
                    </div>

                    <div id="no-photos-message" class="alert alert-info text-center mt-3" style="display: none;">
                        <p class="mb-0">Brak zdjƒôƒá. Gracze mogƒÖ przesy≈Çaƒá zdjƒôcia skanujƒÖc kod QR powy≈ºej.</p>
                    </div>
                </div>
            </div>
        </div>
            </div>

            <!-- VOTING SECTION -->
            <div id="voting-section" class="content-section ">
<div class="card">
                <div class="card-header"><h5 class="card-title mb-0" data-translate="voting_tab">G≈Çosowanie</h5></div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="voting-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="voting-enabled">
                                    <span id="voting-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli g≈Çosowaƒá</small>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>

                            <!-- G≈Ç√≥wny kod QR -->
                            <button id="voting-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR</button>

                            <div class="d-flex gap-2 mt-2 mb-3">
                                <button id="voting-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR</button>
                                <button id="voting-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR</button>
                            </div>

                            <!-- Wy≈õlij na ekran 5 -->
                            <button id="voting-send-to-screen5-btn" class="btn btn-info w-100">üì∫ Wy≈õlij kod na ekran numer 5</button>

                            <small class="text-muted d-block mt-2">Zapasowy kod QR mo≈ºe byƒá u≈ºyty jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia</h6>
                            <p class="text-muted">Tutaj bƒôdƒÖ ustawienia g≈Çosowania</p>
                        </div>
                    </div>

                    <!-- Pytania i odpowiedzi -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Pytania i odpowiedzi</h6>

                            <!-- Przycisk dodaj propozycjƒô -->
                            <button class="btn btn-success mb-3" id="voting-add-question-btn">
                                <i class="bi bi-plus-circle"></i> Dodaj propozycjƒô
                            </button>

                            <!-- Formularz dodawania pytania (ukryty domy≈õlnie) -->
                            <div id="voting-question-form" class="border rounded p-3 mb-3" style="display: none; background: white;">
                                <h6 class="mb-3">Nowe pytanie/propozycja</h6>

                                <!-- Pole pytania -->
                                <div class="mb-3">
                                    <label class="form-label"><strong>Pytanie/Propozycja:</strong></label>
                                    <input type="text" class="form-control" id="voting-question-text" placeholder="Wpisz pytanie lub propozycjƒô...">
                                </div>

                                <!-- Pola odpowiedzi -->
                                <div class="mb-3">
                                    <label class="form-label"><strong>Odpowiedzi/Wybory:</strong></label>
                                    <div id="voting-answers-container">
                                        <div class="input-group mb-2 voting-answer-item">
                                            <span class="input-group-text">1</span>
                                            <input type="text" class="form-control voting-answer-input" placeholder="Odpowied≈∫ 1">
                                            <button class="btn btn-danger voting-remove-answer-btn" type="button" style="display: none;">√ó</button>
                                        </div>
                                        <div class="input-group mb-2 voting-answer-item">
                                            <span class="input-group-text">2</span>
                                            <input type="text" class="form-control voting-answer-input" placeholder="Odpowied≈∫ 2">
                                            <button class="btn btn-danger voting-remove-answer-btn" type="button" style="display: none;">√ó</button>
                                        </div>
                                    </div>
                                    <button class="btn btn-sm btn-outline-primary" id="voting-add-answer-btn">
                                        + Dodaj nowe pole
                                    </button>
                                </div>

                                <!-- Typ wyboru -->
                                <div class="mb-3">
                                    <label class="form-label"><strong>Typ wyboru:</strong></label>
                                    <div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="voting-choice-type" id="voting-single-choice" value="single" checked>
                                            <label class="form-check-label" for="voting-single-choice">Tylko jeden wyb√≥r</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="voting-choice-type" id="voting-multiple-choice" value="multiple">
                                            <label class="form-check-label" for="voting-multiple-choice">Wielokrotny wyb√≥r</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Czas -->
                                <div class="mb-3">
                                    <label class="form-label"><strong>Czas na g≈Çosowanie:</strong></label>
                                    <div class="input-group" style="max-width: 300px;">
                                        <input type="number" class="form-control" id="voting-time-value" value="60" min="10" max="3600">
                                        <select class="form-select" id="voting-time-unit" style="max-width: 120px;">
                                            <option value="seconds">Sekundy</option>
                                            <option value="minutes">Minuty</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Wynik -->
                                <div class="mb-3">
                                    <label class="form-label"><strong>Wynik:</strong></label>
                                    <div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="voting-result-type" id="voting-result-auto" value="auto" checked>
                                            <label class="form-check-label" for="voting-result-auto">Od razu (Auto)</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="voting-result-type" id="voting-result-manual" value="manual">
                                            <label class="form-check-label" for="voting-result-manual">Na ≈ºyczenie (Manual)</label>
                                        </div>
                                    </div>
                                    <small class="text-muted">Auto: wyniki widoczne od razu po up≈Çywie czasu. Manual: wyniki widoczne po aktywacji przez hosta.</small>
                                </div>

                                <!-- Przyciski -->
                                <div class="d-flex gap-2">
                                    <button class="btn btn-primary" id="voting-submit-question-btn">
                                        <i class="bi bi-check-circle"></i> Zatwierd≈∫
                                    </button>
                                    <button class="btn btn-secondary" id="voting-cancel-question-btn">
                                        Anuluj
                                    </button>
                                </div>
                            </div>

                            <!-- Lista pyta≈Ñ -->
                            <div id="voting-questions-list">
                                <!-- Tutaj bƒôdƒÖ wy≈õwietlane dodane pytania -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            </div>

            <!-- LIVE SECTION -->
            <div id="live-section" class="content-section ">
<div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="live_tab">Na ≈ºywo</h5>
                    <p class="text-muted mb-0 mt-2 small">Spontaniczna rozgrywka prowadzona przez konferansjera ze sceny. Gracze odpowiadajƒÖ na pytania w czasie rzeczywistym.</p>
                </div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="live-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="live-enabled">
                                    <span id="live-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, funkcja na ≈ºywo bƒôdzie nieaktywna</small>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR dla graczy</h6>
                            <p class="text-muted">Wy≈õwietl ten kod QR na ekranie, aby gracze mogli do≈ÇƒÖczyƒá do trybu live.</p>
                            <div class="text-center mb-3">
                                <div id="live-qr-code"></div>
                            </div>

                            <!-- G≈Ç√≥wny kod QR -->
                            <button class="btn btn-primary w-100 mb-2" onclick="openLiveQRPreview()">
                                üì± PodglƒÖd i druk kodu QR
                            </button>

                            <!-- Zapasowy kod QR -->
                            <div class="d-flex gap-2 mt-2 mb-3">
                                <button id="live-generate-backup-qr-btn" class="btn btn-success flex-grow-1">
                                    üîÑ Generuj zapasowy kod QR dla pyta≈Ñ na ≈ºywo
                                </button>
                                <button id="live-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>
                                    üì± PodglƒÖd i druk zapasowego kodu QR
                                </button>
                            </div>

                            <!-- Przycisk do wy≈õwietlenia ekranu 5 -->
                            <button id="live-show-screen5-btn" class="btn btn-info w-100 mb-2">
                                üì∫ Wy≈õwietl ekran numer 5
                            </button>

                            <!-- Link do ekranu 5 -->
                            <div class="alert alert-info mb-0">
                                <small><strong>Link do ekranu numer 5:</strong></small><br>
                                <small><a id="live-screen5-link" href="#" target="_blank" class="text-break"></a></small>
                            </div>

                            <small class="text-muted d-block mt-2">
                                Zapasowy kod QR jest priorytetowy na ekranie numer 5. Domy≈õlnie ekran pokazuje podstawowy kod QR.
                            </small>
                        </div>
                    </div>

                    <!-- Ustawienia -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia</h6>
                            <p class="text-muted">Liczba przycisk√≥w odpowiedzi jest dostosowywana automatycznie do liczby wype≈Çnionych p√≥l w pytaniu.</p>

                            <hr class="my-3">

                            <!-- Prze≈ÇƒÖcznik puli punkt√≥w -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Pula punkt√≥w:</strong></label>
                                <div class="d-flex align-items-center gap-3">
                                    <span class="text-muted">Obecna pula punkt√≥w</span>
                                    <div class="form-check form-switch" style="transform: scale(1.5); margin: 0 15px;">
                                        <input class="form-check-input" type="checkbox" id="live-separate-score-pool" style="cursor: pointer;">
                                    </div>
                                    <span class="text-primary"><strong>Osobna pula punkt√≥w</strong></span>
                                </div>
                                <small class="text-muted d-block mt-2">
                                    <strong>Obecna pula:</strong> Punkty z trybu Na ≈ºywo trafiajƒÖ do og√≥lnego licznika punkt√≥w gracza.<br>
                                    <strong>Osobna pula:</strong> Punkty z trybu Na ≈ºywo sƒÖ liczone oddzielnie (np. gracz ma 60 pkt. og√≥lnych + 20 pkt. z trybu Na ≈ºywo).
                                </small>
                            </div>

                            <hr class="my-3">

                            <!-- Ustawienie wyniku (Auto/Manual) -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Wynik:</strong></label>
                                <div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="live-result-mode" id="live-result-auto" value="auto" checked>
                                        <label class="form-check-label" for="live-result-auto">
                                            Od razu (Auto)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="live-result-mode" id="live-result-manual" value="manual">
                                        <label class="form-check-label" for="live-result-manual">
                                            Na ≈ºyczenie (Manual)
                                        </label>
                                    </div>
                                </div>
                                <small class="text-muted d-block mt-2">
                                    <strong>Od razu:</strong> Wyniki i punkty pojawiajƒÖ siƒô automatycznie po up≈Çyniƒôciu czasu.<br>
                                    <strong>Na ≈ºyczenie:</strong> Host musi kliknƒÖƒá "Wy≈õwietl wynik" aby gracze zobaczyli odpowied≈∫ i dostali punkty.
                                </small>
                            </div>

                            <hr class="my-3">

                            <!-- Przycisk Statystyki -->
                            <div class="mb-0">
                                <button id="live-show-statistics-btn" class="btn btn-primary w-100" disabled>
                                    üìä Wy≈õwietl statystyki na ekranie 5
                                </button>
                                <small class="text-muted d-block mt-2">
                                    Gracze zobaczƒÖ procentowe wyniki wszystkich odpowiedzi (dostƒôpne po zako≈Ñczeniu pytania)
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Nowe pytanie -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Dodaj nowe pytanie</h6>
                            <div class="mb-3">
                                <label for="live-new-question-text" class="form-label">Tre≈õƒá pytania (opcjonalnie)</label>
                                <textarea class="form-control" id="live-new-question-text" rows="2" placeholder="Mo≈ºesz zostawiƒá puste je≈õli czytasz pytanie ze sceny"></textarea>
                                <small class="text-muted">Je≈õli wype≈Çnisz, gracze zobaczƒÖ pytanie w swoich telefonach</small>
                            </div>

                            <!-- Pola odpowiedzi -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Odpowiedzi:</strong></label>
                                <div id="live-answers-container">
                                    <div class="input-group mb-2 live-answer-item">
                                        <span class="input-group-text">Odpowied≈∫ A</span>
                                        <input type="text" class="form-control live-answer-input" placeholder="Opcjonalnie">
                                        <div class="input-group-text">
                                            <input class="form-check-input live-correct-checkbox mt-0" type="checkbox" title="Poprawna odpowied≈∫">
                                            <span class="ms-2 small">Poprawna</span>
                                        </div>
                                        <button class="btn btn-danger live-remove-answer-btn" type="button" style="display: none;">√ó</button>
                                    </div>
                                    <div class="input-group mb-2 live-answer-item">
                                        <span class="input-group-text">Odpowied≈∫ B</span>
                                        <input type="text" class="form-control live-answer-input" placeholder="Opcjonalnie">
                                        <div class="input-group-text">
                                            <input class="form-check-input live-correct-checkbox mt-0" type="checkbox" title="Poprawna odpowied≈∫">
                                            <span class="ms-2 small">Poprawna</span>
                                        </div>
                                        <button class="btn btn-danger live-remove-answer-btn" type="button" style="display: none;">√ó</button>
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-outline-primary" id="live-add-answer-btn">
                                    + Dodaj nowe pole
                                </button>
                            </div>

                            <div class="mb-3">
                                <label for="live-new-time-limit" class="form-label">Limit czasu (sekundy)</label>
                                <input type="number" class="form-control" id="live-new-time-limit" value="30" min="5" max="180">
                            </div>
                            <button class="btn btn-primary w-100" onclick="createLiveQuestion()">
                                ‚ûï Dodaj pytanie
                            </button>
                        </div>
                    </div>

                    <!-- Lista pyta≈Ñ -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Pytania</h6>
                            <div id="live-questions-list">
                                <p class="text-muted text-center">Brak pyta≈Ñ. Dodaj nowe pytanie powy≈ºej.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Aktywne pytanie -->
                    <div class="card mb-3 bg-warning" id="live-active-question-card" style="display: none;">
                        <div class="card-body">
                            <h6 class="mb-3">‚ö° Aktywne pytanie</h6>
                            <div id="live-active-question-content">
                                <p class="mb-2"><strong id="live-active-q-text"></strong></p>
                                <div id="live-active-options" class="mb-3 small"></div>
                                <div id="live-active-timer" class="mb-3">
                                    <h4 class="text-danger">Czas: <span id="live-timer-display">30</span>s</h4>
                                </div>
                                <div class="mb-3">
                                    <strong>Odpowiedzi graczy: <span id="live-answers-count">0</span></strong>
                                </div>
                                <h6 class="mb-2">Ujawnij poprawnƒÖ odpowied≈∫ (mo≈ºna wybraƒá wiele):</h6>
                                <div id="live-reveal-buttons" class="d-flex flex-wrap gap-2" role="group">
                                    <!-- Przyciski generowane dynamicznie -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            </div>

        </div>
    </main>
</div>

<!-- Mobile Menu Toggle -->
<button id="mobile-menu-toggle" onclick="toggleSidebar()">
    <i class="bi bi-list"></i>
</button>

<!-- Modal for adding/editing question -->
<div class="modal fade" id="questionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" data-translate="question_modal_title">Dodaj pytanie</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label" data-translate="question_text">Tre≈õƒá pytania:</label>
                    <textarea class="form-control" id="modal-question-text" rows="3"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label" data-translate="answers">Odpowiedzi:</label>
                    <div class="input-group mb-2">
                        <span class="input-group-text">A)</span>
                        <input type="text" class="form-control" id="modal-answer-a">
                        <div class="input-group-text">
                            <input class="form-check-input" type="radio" name="correct-answer" value="A" id="correct-a">
                        </div>
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text">B)</span>
                        <input type="text" class="form-control" id="modal-answer-b">
                        <div class="input-group-text">
                            <input class="form-check-input" type="radio" name="correct-answer" value="B" id="correct-b">
                        </div>
                    </div>
                    <div class="input-group">
                        <span class="input-group-text">C)</span>
                        <input type="text" class="form-control" id="modal-answer-c">
                        <div class="input-group-text">
                            <input class="form-check-input" type="radio" name="correct-answer" value="C" id="correct-c">
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label" data-translate="difficulty_level">Poziom trudno≈õci:</label>
                    <div class="btn-group w-100" role="group" id="difficulty-buttons">
                        <button type="button" class="btn btn-outline-success active" data-difficulty="easy" data-translate="easy">≈Åatwy</button>
                        <button type="button" class="btn btn-outline-warning" data-difficulty="medium" data-translate="medium">≈öredni</button>
                        <button type="button" class="btn btn-outline-danger" data-difficulty="hard" data-translate="hard">Trudny</button>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label" data-translate="question_category">Kategoria pytania:</label>
                    <div class="btn-group w-100" role="group" id="category-buttons">
                        <button type="button" class="btn btn-outline-primary active" data-category="company" data-translate="category_company">Firmowe</button>
                        <button type="button" class="btn btn-outline-primary" data-category="world" data-translate="category_world">≈öwiatowe</button>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label" data-translate="letter_reveal">Litera do ods≈Çoniƒôcia:</label>
                    <input type="text" class="form-control" id="modal-letter" maxlength="1" value="X">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-translate="cancel">Anuluj</button>
                <button type="button" class="btn btn-primary" id="save-question-btn" data-translate="save">Zapisz</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Wy≈õlij wiadomo≈õƒá do gracza -->
<div class="modal fade" id="sendMessageModal" tabindex="-1" aria-labelledby="sendMessageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="sendMessageModalLabel">
                    <span id="message-modal-title"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="player-message-input" class="form-label" id="message-content-label"></label>
                    <textarea class="form-control" id="player-message-input" rows="3" maxlength="120"></textarea>
                    <small class="text-muted"><span id="message-char-count">0</span> / 120 znak√≥w</small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-translate="cancel">Anuluj</button>
                <button type="button" class="btn btn-primary" id="send-message-to-player-btn">
                    <span data-translate="send">Wy≈õlij</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Edycja gracza -->
<div class="modal fade" id="editPlayerModal" tabindex="-1" aria-labelledby="editPlayerModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editPlayerModalLabel">Edycja gracza</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="edit-player-name" class="form-label">Nazwa gracza:</label>
                    <input type="text" class="form-control" id="edit-player-name" maxlength="80">
                </div>
                <div class="mb-3">
                    <label for="edit-player-score" class="form-label">Punkty:</label>
                    <input type="number" class="form-control" id="edit-player-score" min="0">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
                <button type="button" class="btn btn-primary" id="save-player-edit-btn">OK</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Edycja pyta≈Ñ AI dla kategorii -->
<div class="modal fade" id="aiQuestionsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edycja pyta≈Ñ AI - <span id="ai-category-name"></span></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="ai-questions-list"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zamknij</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Edycja pojedynczego pytania AI -->
<div class="modal fade" id="editAIQuestionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edytuj pytanie AI</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-question-id">
                <div class="mb-3">
                    <label class="form-label">Tre≈õƒá pytania:</label>
                    <textarea class="form-control" id="edit-question-text" rows="3"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Odpowiedzi:</label>
                    <div class="input-group mb-2">
                        <span class="input-group-text">A)</span>
                        <input type="text" class="form-control" id="edit-answer-a">
                        <div class="input-group-text">
                            <input class="form-check-input" type="radio" name="edit-correct-answer" value="A" id="edit-correct-a">
                        </div>
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text">B)</span>
                        <input type="text" class="form-control" id="edit-answer-b">
                        <div class="input-group-text">
                            <input class="form-check-input" type="radio" name="edit-correct-answer" value="B" id="edit-correct-b">
                        </div>
                    </div>
                    <div class="input-group">
                        <span class="input-group-text">C)</span>
                        <input type="text" class="form-control" id="edit-answer-c">
                        <div class="input-group-text">
                            <input class="form-check-input" type="radio" name="edit-correct-answer" value="C" id="edit-correct-c">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
                <button type="button" class="btn btn-primary" id="save-ai-question-btn">Zapisz</button>
            </div>
        </div>
    </div>
</div>

<!-- üéÆ WIDOKI TESTOWE MINIGIER -->

<!-- Tetris Test View -->
<div id="tetris-test-view" style="display:none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #607D8B; z-index: 2000;">
    <div class="d-flex flex-column" style="height: 100vh;">
        <div class="text-center py-1 bg-dark text-white" style="flex: 0 0 8%; min-height: 60px; display: flex; flex-direction: column; justify-content: center;">
            <h5 class="mb-0" style="font-size: 1.1rem;">üéÆ TETRIS - Tryb Testowy</h5>
            <div class="d-flex justify-content-between align-items-center px-3">
                <span style="font-size: 0.85rem;">Tester: Host</span>
                <strong style="font-size: 0.9rem;">Punkty: <span id="tetris-test-score">0</span> / 20</strong>
            </div>
        </div>

        <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 2px; position: relative;">
            <div id="tetris-test-start-section" class="text-center" style="position: absolute; z-index: 10; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <h4 class="mb-3" style="color: #333;">üéÆ Test Tetris</h4>
                <p class="mb-4" style="color: #666;">Przetestuj grƒô przed udostƒôpnieniem graczom</p>
                <button id="tetris-test-start-btn" class="btn btn-success btn-lg mb-3" style="width: 200px; font-weight: bold;">START TESTU</button>
                <br>
                <button id="tetris-test-close-btn" class="btn btn-outline-secondary">‚Üê Wr√≥ƒá do panelu</button>
            </div>

            <div id="tetris-test-left-controls" style="display: none; position: absolute; left: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                <div class="d-flex flex-column gap-2">
                    <button id="tetris-test-left-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚óÑ</button>
                    <button id="tetris-test-rotate-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 28px; touch-action: manipulation; border: 3px solid #333; background: white;">üîÑ</button>
                </div>
            </div>

            <canvas id="tetris-test-canvas" style="border: 3px solid #333; background-color: #000; border-radius: 10px; max-width: calc(100% - 140px); max-height: calc(100% - 4px); z-index: 1;"></canvas>

            <div id="tetris-test-right-controls" style="display: none; position: absolute; right: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                <div class="d-flex flex-column gap-2">
                    <button id="tetris-test-right-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñ∫</button>
                    <button id="tetris-test-down-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñº</button>
                </div>
            </div>
        </div>

        <div style="flex: 0 0 8%; display: flex; align-items: center; justify-content: center; padding: 5px;">
            <button id="tetris-test-exit-btn" class="btn btn-danger" style="width: 90%; max-width: 300px; height: 45px; font-weight: bold; display: none;">ZAKO≈ÉCZ TEST</button>
        </div>
    </div>
</div>

<!-- Arkanoid Test View -->
<div id="arkanoid-test-view" style="display:none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #16213e; z-index: 2000;">
    <div class="d-flex flex-column" style="height: 100vh;">
        <div class="text-center py-1 bg-dark text-white" style="flex: 0 0 8%; min-height: 60px; display: flex; flex-direction: column; justify-content: center;">
            <h5 class="mb-0" style="font-size: 1.1rem;">üèì ARKANOID - Tryb Testowy</h5>
            <div class="d-flex justify-content-between align-items-center px-3">
                <span style="font-size: 0.85rem;">Tester: Host</span>
                <div>
                    <strong style="font-size: 0.9rem;">Punkty: <span id="arkanoid-test-score">0</span> / 20</strong>
                    <span style="margin-left: 15px; font-size: 1rem;" id="arkanoid-test-lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                </div>
            </div>
        </div>

        <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 2px; position: relative;">
            <div id="arkanoid-test-start-section" class="text-center" style="position: absolute; z-index: 10; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <h4 class="mb-3" style="color: #333;">üèì Test Arkanoid</h4>
                <p class="mb-4" style="color: #666;">Przetestuj grƒô przed udostƒôpnieniem graczom</p>
                <button id="arkanoid-test-start-btn" class="btn btn-success btn-lg mb-3" style="width: 200px; font-weight: bold;">START TESTU</button>
                <br>
                <button id="arkanoid-test-close-btn" class="btn btn-outline-secondary">‚Üê Wr√≥ƒá do panelu</button>
            </div>

            <div id="arkanoid-test-left-controls" style="display: none; position: absolute; left: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                <div class="d-flex flex-column gap-2">
                    <button id="arkanoid-test-left-btn" class="btn btn-light" style="width: 65px; height: 130px; font-size: 48px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚óÑ</button>
                </div>
            </div>

            <canvas id="arkanoid-test-canvas" style="border: 3px solid #333; background-color: #1a1a2e; border-radius: 10px; max-width: calc(100% - 140px); max-height: calc(100% - 4px); z-index: 1;"></canvas>

            <div id="arkanoid-test-right-controls" style="display: none; position: absolute; right: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                <div class="d-flex flex-column gap-2">
                    <button id="arkanoid-test-right-btn" class="btn btn-light" style="width: 65px; height: 130px; font-size: 48px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñ∫</button>
                </div>
            </div>
        </div>

        <div style="flex: 0 0 8%; display: flex; align-items: center; justify-content: center; padding: 5px;">
            <button id="arkanoid-test-exit-btn" class="btn btn-danger" style="width: 90%; max-width: 300px; height: 45px; font-weight: bold; display: none;">ZAKO≈ÉCZ TEST</button>
        </div>
    </div>
</div>

<!-- Snake Test View -->
<div id="snake-test-view" style="display:none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #2d4a2b; z-index: 2000;">
    <div class="d-flex flex-column" style="height: 100vh;">
        <div class="text-center py-1 bg-dark text-white" style="flex: 0 0 8%; min-height: 60px; display: flex; flex-direction: column; justify-content: center;">
            <h5 class="mb-0" style="font-size: 1.1rem;">üêç SNAKE - Tryb Testowy</h5>
            <div class="d-flex justify-content-between align-items-center px-3">
                <span style="font-size: 0.85rem;">Tester: Host</span>
                <strong style="font-size: 0.9rem;">Punkty: <span id="snake-test-score">0</span> / 20</strong>
            </div>
        </div>

        <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 2px; position: relative;">
            <div id="snake-test-start-section" class="text-center" style="position: absolute; z-index: 10; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <h4 class="mb-3" style="color: #333;">üêç Test Snake</h4>
                <p class="mb-4" style="color: #666;">Przetestuj grƒô przed udostƒôpnieniem graczom</p>
                <button id="snake-test-start-btn" class="btn btn-success btn-lg mb-3" style="width: 200px; font-weight: bold;">START TESTU</button>
                <br>
                <button id="snake-test-close-btn" class="btn btn-outline-secondary">‚Üê Wr√≥ƒá do panelu</button>
            </div>

            <div id="snake-test-left-controls" style="display: none; position: absolute; left: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                <div class="d-flex flex-column gap-2">
                    <button id="snake-test-up-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñ≤</button>
                    <button id="snake-test-left-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚óÑ</button>
                </div>
            </div>

            <canvas id="snake-test-canvas" style="border: 3px solid #333; background: #000; box-shadow: 0 0 15px rgba(0,0,0,0.5);"></canvas>

            <div id="snake-test-right-controls" style="display: none; position: absolute; right: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                <div class="d-flex flex-column gap-2">
                    <button id="snake-test-down-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñº</button>
                    <button id="snake-test-right-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñ∫</button>
                </div>
            </div>
        </div>

        <div style="flex: 0 0 8%; display: flex; align-items: center; justify-content: center; padding: 5px;">
            <button id="snake-test-exit-btn" class="btn btn-danger" style="width: 90%; max-width: 300px; height: 45px; font-weight: bold; display: none;">ZAKO≈ÉCZ TEST</button>
        </div>
    </div>
</div>

<!-- T-Rex Test View -->
<div id="trex-test-view" style="display:none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #f7f7f7; z-index: 2000;">
    <div class="d-flex flex-column" style="height: 100vh;">
        <div class="text-center py-1 bg-dark text-white" style="flex: 0 0 8%; min-height: 60px; display: flex; flex-direction: column; justify-content: center;">
            <h5 class="mb-0" style="font-size: 1.1rem;">ü¶ñ T-REX - Tryb Testowy</h5>
            <div class="d-flex justify-content-between align-items-center px-3">
                <span style="font-size: 0.85rem;">Tester: Host</span>
                <strong style="font-size: 0.9rem;">Punkty: <span id="trex-test-score">0</span> / 20</strong>
            </div>
        </div>

        <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 2px; position: relative;">
            <div id="trex-test-start-section" class="text-center" style="position: absolute; z-index: 10; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <h4 class="mb-3" style="color: #333;">ü¶ñ Test T-Rex</h4>
                <p class="mb-4" style="color: #666;">Przetestuj grƒô przed udostƒôpnieniem graczom</p>
                <button id="trex-test-start-btn" class="btn btn-success btn-lg mb-3" style="width: 200px; font-weight: bold;">START TESTU</button>
                <br>
                <button id="trex-test-close-btn" class="btn btn-outline-secondary">‚Üê Wr√≥ƒá do panelu</button>
            </div>

            <canvas id="trex-test-canvas" style="border: 3px solid #535353; background: #f7f7f7; box-shadow: 0 0 15px rgba(0,0,0,0.2); max-width: calc(100% - 20px); max-height: calc(100% - 4px);"></canvas>

            <div id="trex-test-jump-control" style="display: none; position: absolute; bottom: 20px; z-index: 5;">
                <button id="trex-test-jump-btn" class="btn btn-warning" style="width: 120px; height: 80px; font-size: 28px; touch-action: manipulation; border: 4px solid #333; background: #ffc107; line-height: 1; font-weight: bold;">SKOK ‚ñ≤</button>
            </div>
        </div>

        <div style="flex: 0 0 8%; display: flex; align-items: center; justify-content: center; padding: 5px;">
            <button id="trex-test-exit-btn" class="btn btn-danger" style="width: 90%; max-width: 300px; height: 45px; font-weight: bold; display: none;">ZAKO≈ÉCZ TEST</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
// Funkcja prze≈ÇƒÖczania sekcji
function showSection(sectionId, element) {
    // Ukryj wszystkie sekcje
    document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
    });

    // Usu≈Ñ active ze wszystkich menu items
    document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
    });

    // Poka≈º wybranƒÖ sekcjƒô
    document.getElementById(sectionId).classList.add('active');

    // Zaznacz aktywne menu item
    if (element) {
        element.classList.add('active');
    }

    // Zamknij sidebar na mobile
    if (window.innerWidth <= 992) {
        toggleSidebar();
    }
}

// Funkcja toggle sidebar (mobile)
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');

    sidebar.classList.toggle('open');
    overlay.classList.toggle('show');
}
</script>

{{ super() }}
<script src="https://cdn.socket.io/4.5.2/socket.io.min.js"></script>
<script src="{{ url_for('static', filename='tetris.js') }}"></script>
<script src="{{ url_for('static', filename='arkanoid.js') }}"></script>
<script src="{{ url_for('static', filename='snake.js') }}"></script>
<script src="{{ url_for('static', filename='trex.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script>
// Translations
    const translations = {
    pl: {
        host_title: 'ORGANIZACJA GRY',
        open_display: 'Otw√≥rz Ekran Gry',
        tab_game: 'Gra',
        tab_players: 'Gracze',
        tab_questions: 'Pytania runda 1',
        tab_minigames: 'Minigry',
        tab_qrcodes: 'Kody QR',
        tab_password: 'Has≈Ço',
        tab_photo: 'Foto',
        tab_ar: 'AR',
        tab_fortune: 'Wr√≥≈ºka AI',
        fortune_title: 'Wr√≥≈ºka AI - atrakcja wykorzystujƒÖca sztucznƒÖ inteligencjƒô',
        fortune_description: 'Gracze po zeskanowaniu kodu QR otrzymujƒÖ mo≈ºliwo≈õƒá opisania ostatniego snu, by uzyskaƒá przepowiedniƒô.',
        tab_display: 'Wy≈õwietlacz',
        tab_language: 'Jƒôzyk',
        password_tab: 'Has≈Ço do ods≈Çoniƒôcia',
        password_description: 'Tutaj bƒôdzie widoczne has≈Ço, kt√≥re gracze muszƒÖ ods≈Çoniƒá podczas gry.',
        photo_tab: 'Galeria zdjƒôƒá',
        photo_description: 'Tutaj bƒôdƒÖ widoczne zdjƒôcia przes≈Çane przez graczy.',
        ar_tab: 'Rozszerzona rzeczywisto≈õƒá (AR)',
        ar_description: 'Tutaj bƒôdƒÖ dostƒôpne funkcje AR.',
        display_tab: 'Ustawienia wy≈õwietlacza',
        display_screens: 'Liczba ekran√≥w zewnƒôtrznych:',
        one_screen: '1 Ekran',
        two_screens: '2 Ekrany',
        three_screens: '3 Ekrany',
        four_screens: '4 Ekrany',
        language_tab: 'Ustawienia jƒôzyka',
        game_info: 'Informacje o grze',
        player_count: 'Liczba graczy:',
        completion_percentage: 'Procent uko≈Ñczenia:',
        language_host_label: 'Jƒôzyk prowadzƒÖcego:',
        time_left: 'Czas do ko≈Ñca:',
        time_net: 'Czas gry (netto):',
        time_gross: 'Czas gry (brutto):',
        current_bonus: 'Aktualna premia:',
        current_speed: 'Aktualne tempo:',
        game_status_label: 'Stan gry:',
        game_status_waiting: 'Oczekiwanie na Start',
        game_status_active: 'Start. Gra aktywna',
        game_status_paused: 'Pauza',
        game_status_stopped: 'Stop. Zako≈Ñczenie gry',
        pre_game_settings: 'Obs≈Çuga gry',
        game_duration_label: 'Czas gry (minuty):',
        game_duration_help: 'Przed grƒÖ: ustaw czas. Podczas gry: zmie≈Ñ czas (wymaga has≈Ça)',
        set_time_btn: 'OK',
        player_language: 'Jƒôzyk graczy',
        host_language: 'Jƒôzyk prowadzƒÖcego',
        lang_polish: 'Jƒôzyk polski',
        lang_english: 'Jƒôzyk angielski',
        lang_german: 'Jƒôzyk niemiecki',
        start_game: 'Start Gry',
        in_game_settings: 'Tempo gry oraz punktacja',
        points_bonus: 'Premia punktowa:',
        time_speed: 'Tempo czasu:',
        pause: 'Pauza',
        resume: 'Wzn√≥w',
        force_win: 'Przedwczesna wygrana',
        stop_game: 'Stop Gry',
        reset_game: 'Reset Gry',
        quick_access: 'Szybki dostƒôp do zak≈Çadek:',
        questions_management: 'ZarzƒÖdzanie pytaniami',
        players_management: 'ZarzƒÖdzanie graczami',
        add_question: 'Dodaj pytanie',
        question_modal_title: 'Dodaj pytanie',
        question_text: 'Tre≈õƒá pytania:',
        answers: 'Odpowiedzi:',
        difficulty_level: 'Poziom trudno≈õci:',
        easy: '≈Åatwy',
        medium: '≈öredni',
        hard: 'Trudny',
        letter_reveal: 'Litera do ods≈Çoniƒôcia:',
        cancel: 'Anuluj',
        save: 'Zapisz',
        edit: 'Edytuj',
        delete: 'Usu≈Ñ',
        shown: 'Wy≈õwietlono',
        correct: 'Poprawne',
        times: 'razy',
        admin_impersonate: 'Jeste≈õ zalogowany jako Admin w panelu Hosta.',
        back_to_admin: 'Powr√≥t do panelu Admina',
        warn: 'Ostrze≈º',
        warnings: 'Ostrze≈ºenia',
        send_player_message: 'Wy≈õlij wiadomo≈õƒá',
        message_to_player: 'Wiadomo≈õƒá do gracza',
        message_content: 'Tre≈õƒá wiadomo≈õci (max 120 znak√≥w):',
        send: 'Wy≈õlij',
        question_category: 'Kategoria pytania:',
        category_company: 'Firmowe',
        category_world: '≈öwiatowe',
        host_messages: 'Komunikaty na ekran gry',
        messages_description: 'Wy≈õlij komunikat, kt√≥ry pojawi siƒô na g≈Ç√≥wnym ekranie gry. U≈ºyj tego, aby przekazaƒá wa≈ºne informacje wszystkim uczestnikom.',
        message_label: 'Tre≈õƒá komunikatu (max 500 znak√≥w):',
        send_message: 'Wy≈õlij komunikat',
        password_preview: 'Has≈Ço',  // ‚¨ÖÔ∏è DODAJ Tƒò LINIƒò
        tab_timing: 'Czas i tempo',
        timing_settings: 'Czas i tempo gry',
        display_panel: 'Wy≈õwietlacz',
        display_panel_description: 'Otw√≥rz ekrany gry lub przejd≈∫ do ustawie≈Ñ wy≈õwietlacza.',
        display_settings: 'Ustawienia',
    },
    en: {
        host_title: 'GAME ORGANIZATION',
        open_display: 'Open Game Display',
        tab_game: 'Game',
        tab_players: 'Players',
        tab_questions: 'Questions',
        tab_minigames: 'Minigames',
        tab_qrcodes: 'QR Codes',
        tab_password: 'Password',
        tab_photo: 'Photo',
        tab_ar: 'AR',
        tab_fortune: 'Fortune Teller AI',
        fortune_title: 'Fortune Teller AI - attraction using artificial intelligence',
        fortune_description: 'Players after scanning the QR code get the opportunity to describe their last dream to get a prediction.',
        tab_display: 'Display',
        tab_language: 'Language',
        password_tab: 'Password to reveal',
        password_description: 'Here you will see the password that players must reveal during the game.',
        photo_tab: 'Photo gallery',
        photo_description: 'Here you will see photos uploaded by players.',
        ar_tab: 'Augmented Reality (AR)',
        ar_description: 'AR features will be available here.',
        display_tab: 'Display settings',
        display_screens: 'Number of external screens:',
        one_screen: '1 Screen',
        two_screens: '2 Screens',
        three_screens: '3 Screens',
        four_screens: '4 Screens',
        language_tab: 'Language settings',
        game_info: 'Game information',
        player_count: 'Number of players:',
        completion_percentage: 'Completion percentage:',
        language_host_label: 'Host language:',
        time_left: 'Time left:',
        time_net: 'Game time (net):',
        time_gross: 'Game time (gross):',
        current_bonus: 'Current bonus:',
        current_speed: 'Current speed:',
        game_status_label: 'Game status:',
        game_status_waiting: 'Waiting for Start',
        game_status_active: 'Start. Game active',
        game_status_paused: 'Pause',
        game_status_stopped: 'Stop. Game ended',
        pre_game_settings: 'Game Control',
        game_duration_label: 'Game time (minutes):',
        game_duration_help: 'Before game: set time. During game: change time (requires password)',
        set_time_btn: 'OK',
        player_language: 'Players language',
        host_language: 'Host language',
        lang_polish: 'Polish language',
        lang_english: 'English language',
        lang_german: 'German language',
        start_game: 'Start Game',
        in_game_settings: 'Game Speed and Scoring',
        points_bonus: 'Points bonus:',
        time_speed: 'Time speed:',
        pause: 'Pause',
        resume: 'Resume',
        force_win: 'Force Win',
        stop_game: 'Stop Game',
        reset_game: 'Reset Game',
        quick_access: 'Quick access to tabs:',
        questions_management: 'Questions management',
        players_management: 'Players management',
        add_question: 'Add question',
        question_modal_title: 'Add question',
        question_text: 'Question text:',
        answers: 'Answers:',
        difficulty_level: 'Difficulty level:',
        easy: 'Easy',
        medium: 'Medium',
        hard: 'Hard',
        letter_reveal: 'Letter to reveal:',
        cancel: 'Cancel',
        save: 'Save',
        edit: 'Edit',
        delete: 'Delete',
        shown: 'Shown',
        correct: 'Correct',
        times: 'times',
        admin_impersonate: 'You are logged in as Admin in Host panel.',
        back_to_admin: 'Back to Admin panel',
        warn: 'Warn',
        warnings: 'Warnings',
        send_player_message: 'Send message',
        message_to_player: 'Message to player',
        message_content: 'Message content (max 120 characters):',
        send: 'Send',
        question_category: 'Question category:',
        category_company: 'Company',
        category_world: 'World',
        host_messages: 'Messages on game screen',
        messages_description: 'Send a message that will appear on the main game screen. Use this to share important information with all participants.',
        message_label: 'Message content (max 500 characters):',
        send_message: 'Send message',
        password_preview: 'Password',
        tab_timing: 'Time & Speed',
        timing_settings: 'Game Time and Speed',
        display_panel: 'Display',
        display_panel_description: 'Open game screens or go to display settings.',
        display_settings: 'Settings',
    },
    de: {
        host_title: 'SPIELORGANISATION',
        open_display: 'Spielbildschirm √∂ffnen',
        tab_game: 'Spiel',
        tab_players: 'Spieler',
        tab_questions: 'Fragen',
        tab_minigames: 'Minispiele',
        tab_qrcodes: 'QR-Codes',
        tab_password: 'Passwort',
        tab_photo: 'Foto',
        tab_ar: 'AR',
        tab_fortune: 'Wahrsagerin AI',
        fortune_title: 'Wahrsagerin AI - Attraktion mit k√ºnstlicher Intelligenz',
        fortune_description: 'Spieler erhalten nach dem Scannen des QR-Codes die M√∂glichkeit, ihren letzten Traum zu beschreiben, um eine Vorhersage zu erhalten.',
        tab_display: 'Anzeige',
        tab_language: 'Sprache',
        password_tab: 'Zu enth√ºllendes Passwort',
        password_description: 'Hier sehen Sie das Passwort, das die Spieler w√§hrend des Spiels aufdecken m√ºssen.',
        photo_tab: 'Fotogalerie',
        photo_description: 'Hier sehen Sie von Spielern hochgeladene Fotos.',
        ar_tab: 'Erweiterte Realit√§t (AR)',
        ar_description: 'AR-Funktionen werden hier verf√ºgbar sein.',
        display_tab: 'Anzeigeeinstellungen',
        display_screens: 'Anzahl externer Bildschirme:',
        one_screen: '1 Bildschirm',
        two_screens: '2 Bildschirme',
        three_screens: '3 Bildschirme',
        four_screens: '4 Bildschirme',
        language_tab: 'Spracheinstellungen',
        game_info: 'Spielinformationen',
        player_count: 'Anzahl der Spieler:',
        completion_percentage: 'Abschlussrate:',
        language_host_label: 'Moderatorsprache:',
        time_left: 'Verbleibende Zeit:',
        time_net: 'Spielzeit (netto):',
        time_gross: 'Spielzeit (brutto):',
        current_bonus: 'Aktueller Bonus:',
        current_speed: 'Aktuelle Geschwindigkeit:',
        game_status_label: 'Spielstatus:',
        game_status_waiting: 'Warten auf Start',
        game_status_active: 'Start. Spiel aktiv',
        game_status_paused: 'Pause',
        game_status_stopped: 'Stopp. Spiel beendet',
        pre_game_settings: 'Spielsteuerung',
        game_duration_label: 'Spielzeit (Minuten):',
        game_duration_help: 'Vor dem Spiel: Zeit einstellen. W√§hrend des Spiels: Zeit √§ndern (erfordert Passwort)',
        set_time_btn: 'OK',
        player_language: 'Spielersprache',
        host_language: 'Moderatorsprache',
        lang_polish: 'Polnische Sprache',
        lang_english: 'Englische Sprache',
        lang_german: 'Deutsche Sprache',
        start_game: 'Spiel starten',
        in_game_settings: 'Spielgeschwindigkeit und Punktzahl',
        points_bonus: 'Punktebonus:',
        time_speed: 'Zeitgeschwindigkeit:',
        pause: 'Pause',
        resume: 'Fortsetzen',
        force_win: 'Erzwungener Sieg',
        stop_game: 'Spiel stoppen',
        reset_game: 'Spiel zur√ºcksetzen',
        quick_access: 'Schnellzugriff auf Registerkarten:',
        questions_management: 'Fragenverwaltung',
        players_management: 'Spielerverwaltung',
        add_question: 'Frage hinzuf√ºgen',
        question_modal_title: 'Frage hinzuf√ºgen',
        question_text: 'Fragetext:',
        answers: 'Antworten:',
        difficulty_level: 'Schwierigkeitsgrad:',
        easy: 'Einfach',
        medium: 'Mittel',
        hard: 'Schwer',
        letter_reveal: 'Zu enth√ºllender Buchstabe:',
        cancel: 'Abbrechen',
        save: 'Speichern',
        edit: 'Bearbeiten',
        delete: 'L√∂schen',
        shown: 'Angezeigt',
        correct: 'Richtig',
        times: 'Mal',
        admin_impersonate: 'Sie sind als Admin im Host-Panel angemeldet.',
        back_to_admin: 'Zur√ºck zum Admin-Panel',
        warn: 'Warnen',
        warnings: 'Warnungen',
        question_category: 'Fragenkategorie:',
        category_company: 'Firma',
        category_world: 'Welt',
        host_messages: 'Nachrichten auf dem Spielbildschirm',
        messages_description: 'Senden Sie eine Nachricht, die auf dem Hauptspielbildschirm erscheint. Verwenden Sie dies, um wichtige Informationen mit allen Teilnehmern zu teilen.',
        message_label: 'Nachrichteninhalt (max. 500 Zeichen):',
        send_message: 'Nachricht senden',
        password_preview: 'Passwort',
        tab_timing: 'Zeit & Tempo',
        timing_settings: 'Spielzeit und Geschwindigkeit',
        display_panel: 'Anzeige',
        display_panel_description: 'Spielbildschirme √∂ffnen oder zu den Anzeigeeinstellungen wechseln.',
        display_settings: 'Einstellungen',
    }
};

let currentLanguage = 'pl';
let currentEditingQuestionId = null;
const EVENT_ID = {{ event.id }};
const IS_SUPERHOST = {{ 'true' if is_superhost else 'false' }};

function translatePage(lang) {
    currentLanguage = lang;
    document.querySelectorAll('[data-translate]').forEach(el => {
        const key = el.getAttribute('data-translate');
        if (translations[lang][key]) {
            if (el.tagName === 'INPUT' && el.type === 'button') {
                el.value = translations[lang][key];
            } else {
                el.textContent = translations[lang][key];
            }
        }
    });
    
    // Update pause button text based on state
    const pauseBtn = document.getElementById('pause-btn');
    if (pauseBtn && (pauseBtn.textContent.includes('Wzn√≥w') || pauseBtn.textContent.includes('Resume'))) {
        pauseBtn.textContent = translations[lang]['resume'];
    }
    
    // Update game status text
    updateGameStatusText();
}

function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

// ‚úÖ Funkcja aktualizujƒÖca tekst statusu gry
function updateGameStatusText() {
    const statusEl = document.getElementById('info-game-status');
    if (!statusEl) return;
    
    const currentStatus = statusEl.dataset.status;
    if (!currentStatus) return;
    
    const statusTexts = {
        'waiting': translations[currentLanguage].game_status_waiting,
        'active': translations[currentLanguage].game_status_active,
        'paused': translations[currentLanguage].game_status_paused,
        'stopped': translations[currentLanguage].game_status_stopped
    };
    
    statusEl.textContent = statusTexts[currentStatus] || statusTexts['waiting'];
}

document.addEventListener('DOMContentLoaded', function () {
    console.log('üéÆ HOST PANEL INITIALIZING - Event ID:', EVENT_ID);
    
    const socket = io();
    const questionModal = new bootstrap.Modal(document.getElementById('questionModal'));

        // =====================================================================
    // ‚úÖ NOWE: Przekierowanie do zak≈Çadki Has≈Ço po klikniƒôciu w pole
    // =====================================================================
    const passwordCard = document.getElementById('password-preview-card');
    if (passwordCard) {
        passwordCard.addEventListener('click', () => {
            const passwordTab = document.querySelector('button[data-bs-target="#password"]');
            if (passwordTab) {
                const tab = new bootstrap.Tab(passwordTab);
                tab.show();
            }
        });
    }
    
    // =====================================================================
    // SZYBKI DOSTƒòP DO ZAK≈ÅADEK
    // =====================================================================
    document.querySelectorAll('.quick-tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const tabName = btn.dataset.tab;
            const tabButton = document.querySelector(`button[data-bs-target="#${tabName}"]`);
            if (tabButton) {
                const tab = new bootstrap.Tab(tabButton);
                tab.show();
            }
        });
    });
    
    // =====================================================================
    // WY≈öWIETLACZ - PRZE≈ÅƒÑCZANIE LICZBY EKRAN√ìW
    // =====================================================================
    document.getElementById('display-screens-controls')?.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-value]');
        if (btn) {
            const screensCount = btn.dataset.value;

            // Update active state
            document.querySelectorAll('#display-screens-controls button').forEach(b => b.classList.remove('active-modifier'));
            btn.classList.add('active-modifier');

            // Update status message
            const statusDiv = document.getElementById('display-status');
            if (statusDiv) {
                let screenText;
                if (screensCount === '1') {
                    screenText = 'ekran';
                } else if (screensCount === '2' || screensCount === '3' || screensCount === '4') {
                    screenText = 'ekrany';
                } else {
                    screenText = 'ekran√≥w';
                }
                statusDiv.innerHTML = `Aktualnie uruchomione: <strong>${screensCount} ${screenText}</strong>`;
            }

            // Mo≈ºesz tutaj dodaƒá zapisywanie ustawie≈Ñ do GameState je≈õli potrzebne
            console.log('Liczba ekran√≥w ustawiona na:', screensCount);
        }
    });
    
    // =====================================================================
    // GRACZE
    // =====================================================================
    // Za≈Çaduj listƒô graczy po otwarciu zak≈Çadki
    document.querySelector('button[data-bs-target="#players"]')?.addEventListener('click', () => {
        loadPlayers();
    });

    function loadPlayers() {
        fetch('/api/host/players')
            .then(res => res.json())
            .then(players => {
                const list = document.getElementById('players-list');
                if (players.length === 0) {
                    list.innerHTML = `<p class="text-muted">Brak graczy</p>`;
                    return;
                }
                
                list.innerHTML = `
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>${translations[currentLanguage].player_count.replace(':', '')}</th>
                                <th>Punkty</th>
                                <th>% uko≈Ñczenia</th>
                                <th>${translations[currentLanguage].warnings}</th>
                                <th>Akcje</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${players.map(p => `
                                <tr>
                                    <td>${p.name}</td>
                                    <td>${p.score}</td>
                                    <td>${p.completion_percentage !== undefined ? p.completion_percentage + '%' : '-'}</td>
                                    <td>${p.warnings}</td>
                                    <td>
                                        <button class="btn btn-sm btn-info send-message-btn" data-id="${p.id}" data-name="${p.name}">${translations[currentLanguage].send_player_message}</button>
                                        <button class="btn btn-sm btn-warning warn-player-btn" data-id="${p.id}">${translations[currentLanguage].warn}</button>
                                        <button class="btn btn-sm btn-primary edit-player-btn" data-id="${p.id}" data-name="${p.name}" data-score="${p.score}">Edycja</button>
                                        <button class="btn btn-sm btn-danger delete-player-btn" data-id="${p.id}">${translations[currentLanguage].delete}</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                
                // Attach event listeners
                document.querySelectorAll('.send-message-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        openMessageModal(parseInt(btn.dataset.id), btn.dataset.name);
                    });
                });
                document.querySelectorAll('.warn-player-btn').forEach(btn => {
                    btn.addEventListener('click', () => warnPlayer(parseInt(btn.dataset.id)));
                });
                document.querySelectorAll('.edit-player-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        openEditPlayerModal(parseInt(btn.dataset.id), btn.dataset.name, parseInt(btn.dataset.score));
                    });
                });
                document.querySelectorAll('.delete-player-btn').forEach(btn => {
                    btn.addEventListener('click', () => deletePlayer(parseInt(btn.dataset.id)));
                });
            });
    }
    
    async function warnPlayer(id) {
        try {
            const response = await fetch(`/api/host/player/${id}/warn`, { method: 'POST' });
            if (!response.ok) throw new Error('B≈ÇƒÖd ostrze≈ºenia gracza');
            loadPlayers();
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    }
    
    async function deletePlayer(id) {
        if (!confirm('Czy na pewno chcesz usunƒÖƒá tego gracza?')) return;

        try {
            const response = await fetch(`/api/host/player/${id}`, { method: 'DELETE' });
            if (!response.ok) throw new Error('B≈ÇƒÖd usuwania gracza');
            loadPlayers();
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    }

    // =====================================================================
    // EDYCJA GRACZA
    // =====================================================================
    let currentEditPlayerId = null;

    function openEditPlayerModal(playerId, playerName, playerScore) {
        currentEditPlayerId = playerId;

        // Ustaw warto≈õci w polach formularza
        document.getElementById('edit-player-name').value = playerName;
        document.getElementById('edit-player-score').value = playerScore;

        // Poka≈º modal
        const modal = new bootstrap.Modal(document.getElementById('editPlayerModal'));
        modal.show();
    }

    // Obs≈Çuga przycisku OK w modalu edycji
    document.getElementById('save-player-edit-btn')?.addEventListener('click', async () => {
        const newName = document.getElementById('edit-player-name').value.trim();
        const newScore = parseInt(document.getElementById('edit-player-score').value);

        if (!newName) {
            alert('Proszƒô podaƒá nazwƒô gracza');
            return;
        }

        if (isNaN(newScore) || newScore < 0) {
            alert('Proszƒô podaƒá prawid≈ÇowƒÖ liczbƒô punkt√≥w');
            return;
        }

        try {
            const response = await fetch(`/api/host/player/${currentEditPlayerId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name: newName,
                    score: newScore
                })
            });

            if (!response.ok) {
                const data = await response.json();
                throw new Error(data.error || 'B≈ÇƒÖd aktualizacji gracza');
            }

            // Zamknij modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('editPlayerModal'));
            modal.hide();

            // Od≈õwie≈º listƒô graczy
            loadPlayers();

            alert('Gracz zosta≈Ç zaktualizowany');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    });

    // =====================================================================
    // WYSY≈ÅANIE WIADOMO≈öCI DO GRACZA
    // =====================================================================
    let currentMessagePlayerId = null;

    function openMessageModal(playerId, playerName) {
        currentMessagePlayerId = playerId;

        // Ustaw tytu≈Ç modala
        document.getElementById('message-modal-title').textContent =
            translations[currentLanguage].message_to_player + ': ' + playerName;

        // Ustaw label pola tekstowego
        document.getElementById('message-content-label').textContent =
            translations[currentLanguage].message_content;

        // Wyczy≈õƒá pole tekstowe
        const messageInput = document.getElementById('player-message-input');
        messageInput.value = '';
        document.getElementById('message-char-count').textContent = '0';

        // Poka≈º modal
        const modal = new bootstrap.Modal(document.getElementById('sendMessageModal'));
        modal.show();
    }

    // Licznik znak√≥w w textarea
    document.getElementById('player-message-input')?.addEventListener('input', (e) => {
        const length = e.target.value.length;
        document.getElementById('message-char-count').textContent = length;
    });

    // Obs≈Çuga przycisku wy≈õlij w modalu
    document.getElementById('send-message-to-player-btn')?.addEventListener('click', async () => {
        const message = document.getElementById('player-message-input').value.trim();

        if (!message) {
            alert('Proszƒô wpisaƒá wiadomo≈õƒá');
            return;
        }

        if (message.length > 120) {
            alert('Wiadomo≈õƒá mo≈ºe mieƒá maksymalnie 120 znak√≥w');
            return;
        }

        try {
            // Wy≈õlij wiadomo≈õƒá przez Socket.IO
            socket.emit('host_message_to_player', {
                player_id: currentMessagePlayerId,
                message: message,
                event_id: eventId
            });

            // Zamknij modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('sendMessageModal'));
            modal.hide();

            // Poka≈º komunikat
            alert('Wiadomo≈õƒá wys≈Çana do gracza');
        } catch (error) {
            alert('B≈ÇƒÖd wysy≈Çania wiadomo≈õci: ' + error.message);
        }
    });

    document.querySelector('button[data-bs-target="#players"]')?.addEventListener('click', loadPlayers);

    // =====================================================================
    // JƒòZYK I TRANSLACJA
    // =====================================================================
    document.getElementById('lang-host-controls')?.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-value]');
        if (btn) {
            const lang = btn.dataset.value;
            translatePage(lang);
            sendGameControl('language_host', lang);
            
            // Update active state
            document.querySelectorAll('#lang-host-controls button').forEach(b => b.classList.remove('active-modifier'));
            btn.classList.add('active-modifier');
        }
    });
    
    document.getElementById('lang-player-controls')?.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-value]');
        if (btn) {
            const lang = btn.dataset.value;
            sendGameControl('language_player', lang);
            
            // Update active state
            document.querySelectorAll('#lang-player-controls button').forEach(b => b.classList.remove('active-modifier'));
            btn.classList.add('active-modifier');
        }
    });
    
    // Difficulty buttons
    document.getElementById('difficulty-buttons').addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (btn) {
            document.querySelectorAll('#difficulty-buttons .btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
    });

    // Category buttons
    document.getElementById('category-buttons').addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (btn) {
            document.querySelectorAll('#category-buttons .btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
    });
    
    // =====================================================================
    // PYTANIA
    // =====================================================================
    function loadQuestions() {
        fetch('/api/host/questions')
            .then(res => res.json())
            .then(questions => {
                const list = document.getElementById('questions-list');
                if (questions.length === 0) {
                    list.innerHTML = `<p class="text-muted">${translations[currentLanguage].add_question}</p>`;
                    return;
                }
                
                list.innerHTML = questions.map((q, index) => {
                    const percentage = q.times_shown > 0 ? Math.round((q.times_correct / q.times_shown) * 100) : 0;
                    return `
                        <div class="question-item d-flex align-items-start">
                            <div class="me-3">
                                <strong>${index + 1}.</strong>
                            </div>
                            <div class="flex-grow-1">
                                <p class="mb-2">${q.text}</p>
                                <div class="question-stats">
                                    <span class="badge bg-info">${translations[currentLanguage][q.difficulty] || q.difficulty}</span>
                                    <span>${translations[currentLanguage].shown}: ${q.times_shown}</span> | 
                                    <span>${translations[currentLanguage].correct}: ${q.times_correct}</span> | 
                                    <span>${percentage}%</span>
                                </div>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-outline-primary me-2 edit-question-btn" data-id="${q.id}" data-translate="edit">${translations[currentLanguage].edit}</button>
                                <button class="btn btn-sm btn-outline-danger delete-question-btn" data-id="${q.id}" data-translate="delete">${translations[currentLanguage].delete}</button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Attach event listeners
                document.querySelectorAll('.edit-question-btn').forEach(btn => {
                    btn.addEventListener('click', () => editQuestion(parseInt(btn.dataset.id)));
                });
                document.querySelectorAll('.delete-question-btn').forEach(btn => {
                    btn.addEventListener('click', () => deleteQuestion(parseInt(btn.dataset.id)));
                });
            });
    }
    
    document.getElementById('add-question-btn').addEventListener('click', () => {
        currentEditingQuestionId = null;
        currentEditingQuestionRound = 1;
        document.getElementById('modal-question-text').value = '';
        document.getElementById('modal-answer-a').value = '';
        document.getElementById('modal-answer-b').value = '';
        document.getElementById('modal-answer-c').value = '';
        document.getElementById('modal-letter').value = 'X';
        document.querySelectorAll('input[name="correct-answer"]').forEach(r => r.checked = false);
        document.getElementById('correct-a').checked = true;
        document.querySelectorAll('#difficulty-buttons .btn').forEach(b => b.classList.remove('active'));
        document.querySelector('#difficulty-buttons .btn[data-difficulty="easy"]').classList.add('active');
        document.querySelectorAll('#category-buttons .btn').forEach(b => b.classList.remove('active'));
        document.querySelector('#category-buttons .btn[data-category="company"]').classList.add('active');
        document.querySelector('.modal-title').textContent = translations[currentLanguage].question_modal_title;
        questionModal.show();
    });
    
    let currentEditingQuestionRound = 1; // Default round

    document.getElementById('save-question-btn').addEventListener('click', async () => {
        const text = document.getElementById('modal-question-text').value.trim();
        const answerA = document.getElementById('modal-answer-a').value.trim();
        const answerB = document.getElementById('modal-answer-b').value.trim();
        const answerC = document.getElementById('modal-answer-c').value.trim();
        const correctAnswer = document.querySelector('input[name="correct-answer"]:checked')?.value;
        const difficulty = document.querySelector('#difficulty-buttons .btn.active')?.dataset.difficulty || 'easy';
        const category = document.querySelector('#category-buttons .btn.active')?.dataset.category || 'company';
        const letter = document.getElementById('modal-letter').value.toUpperCase() || 'X';

        if (!text || !answerA || !answerB || !answerC || !correctAnswer) {
            alert('Wype≈Çnij wszystkie pola!');
            return;
        }

        const payload = {
            text,
            answers: [answerA, answerB, answerC],
            correctAnswer,
            difficulty,
            letterToReveal: letter,
            category: category,
            round: currentEditingQuestionRound
        };

        try {
            let response;
            const roundParam = currentEditingQuestionRound > 1 ? `?round=${currentEditingQuestionRound}` : '';

            // Determine which editing ID to use based on round
            let editingId = null;
            if (currentEditingQuestionRound === 2) {
                editingId = currentEditingQuestionIdR2;
            } else if (currentEditingQuestionRound === 3) {
                editingId = currentEditingQuestionIdR3;
            } else {
                editingId = currentEditingQuestionId;
            }

            if (editingId) {
                response = await fetch(`/api/host/question/${editingId}${roundParam}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
            } else {
                response = await fetch(`/api/host/questions${roundParam}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
            }

            if (!response.ok) throw new Error('B≈ÇƒÖd zapisu pytania');

            questionModal.hide();

            // Reload appropriate round
            if (currentEditingQuestionRound === 2) {
                loadQuestionsR2();
            } else if (currentEditingQuestionRound === 3) {
                loadQuestionsR3();
            } else {
                loadQuestions();
            }
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    });
    
    async function editQuestion(id) {
        try {
            const response = await fetch('/api/host/questions');
            const questions = await response.json();
            const question = questions.find(q => q.id === id);
            
            if (!question) return;
            
            currentEditingQuestionId = id;
            document.getElementById('modal-question-text').value = question.text;
            document.getElementById('modal-answer-a').value = question.answers[0];
            document.getElementById('modal-answer-b').value = question.answers[1];
            document.getElementById('modal-answer-c').value = question.answers[2];
            document.getElementById('modal-letter').value = question.letterToReveal;
            
            document.getElementById(`correct-${question.correctAnswer.toLowerCase()}`).checked = true;
            
            document.querySelectorAll('#difficulty-buttons .btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`#difficulty-buttons .btn[data-difficulty="${question.difficulty}"]`)?.classList.add('active');
            
            document.querySelectorAll('#category-buttons .btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`#category-buttons .btn[data-category="${question.category}"]`)?.classList.add('active');
            
            document.querySelector('.modal-title').textContent = translations[currentLanguage].edit + ' ' + translations[currentLanguage].question_text.toLowerCase();
            questionModal.show();
        } catch (error) {
            alert('B≈ÇƒÖd ≈Çadowania pytania: ' + error.message);
        }
    }
    
    async function deleteQuestion(id) {
        if (!confirm('Czy na pewno chcesz usunƒÖƒá to pytanie?')) return;
        
        try {
            const response = await fetch(`/api/host/question/${id}`, { method: 'DELETE' });
            if (!response.ok) throw new Error('B≈ÇƒÖd usuwania pytania');
            loadQuestions();
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    }
    
    document.querySelector('button[data-bs-target="#questions"]')?.addEventListener('click', loadQuestions);

    // =====================================================================
    // PYTANIA RUNDA 2
    // =====================================================================
    let currentEditingQuestionIdR2 = null;

    function loadQuestionsR2() {
        fetch('/api/host/questions?round=2')
            .then(res => res.json())
            .then(questions => {
                const list = document.getElementById('r2-questions-list');
                if (questions.length === 0) {
                    list.innerHTML = `<p class="text-muted">${translations[currentLanguage].add_question}</p>`;
                    return;
                }

                list.innerHTML = questions.map((q, index) => {
                    const percentage = q.times_shown > 0 ? Math.round((q.times_correct / q.times_shown) * 100) : 0;
                    return `
                        <div class="question-item d-flex align-items-start">
                            <div class="me-3">
                                <strong>${index + 1}.</strong>
                            </div>
                            <div class="flex-grow-1">
                                <p class="mb-2">${q.text}</p>
                                <div class="question-stats">
                                    <span class="badge bg-info">${translations[currentLanguage][q.difficulty] || q.difficulty}</span>
                                    <span>${translations[currentLanguage].shown}: ${q.times_shown}</span> |
                                    <span>${translations[currentLanguage].correct}: ${q.times_correct}</span> |
                                    <span>${percentage}%</span>
                                </div>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-outline-primary me-2 edit-question-r2-btn" data-id="${q.id}">Edytuj</button>
                                <button class="btn btn-sm btn-outline-danger delete-question-r2-btn" data-id="${q.id}">Usu≈Ñ</button>
                            </div>
                        </div>
                    `;
                }).join('');

                // Attach event listeners
                document.querySelectorAll('.edit-question-r2-btn').forEach(btn => {
                    btn.addEventListener('click', () => editQuestionR2(parseInt(btn.dataset.id)));
                });
                document.querySelectorAll('.delete-question-r2-btn').forEach(btn => {
                    btn.addEventListener('click', () => deleteQuestionR2(parseInt(btn.dataset.id)));
                });
            });
    }

    document.getElementById('r2-add-question-btn')?.addEventListener('click', () => {
        currentEditingQuestionIdR2 = null;
        currentEditingQuestionRound = 2;
        document.getElementById('modal-question-text').value = '';
        document.getElementById('modal-answer-a').value = '';
        document.getElementById('modal-answer-b').value = '';
        document.getElementById('modal-answer-c').value = '';
        document.getElementById('modal-letter').value = 'X';
        document.querySelectorAll('input[name="correct-answer"]').forEach(r => r.checked = false);
        document.getElementById('correct-a').checked = true;
        document.querySelectorAll('#difficulty-buttons .btn').forEach(b => b.classList.remove('active'));
        document.querySelector('#difficulty-buttons .btn[data-difficulty="easy"]')?.classList.add('active');
        document.querySelectorAll('#category-buttons .btn').forEach(b => b.classList.remove('active'));
        document.querySelector('#category-buttons .btn[data-category="company"]')?.classList.add('active');
        document.querySelector('.modal-title').textContent = 'Dodaj pytanie - Runda 2';
        questionModal.show();
    });

    async function editQuestionR2(id) {
        try {
            const response = await fetch('/api/host/questions?round=2');
            const questions = await response.json();
            const question = questions.find(q => q.id === id);

            if (!question) return;

            currentEditingQuestionIdR2 = id;
            currentEditingQuestionRound = 2;
            document.getElementById('modal-question-text').value = question.text;
            document.getElementById('modal-answer-a').value = question.answers[0];
            document.getElementById('modal-answer-b').value = question.answers[1];
            document.getElementById('modal-answer-c').value = question.answers[2];
            document.getElementById('modal-letter').value = question.letterToReveal;

            document.getElementById(`correct-${question.correctAnswer.toLowerCase()}`).checked = true;

            document.querySelectorAll('#difficulty-buttons .btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`#difficulty-buttons .btn[data-difficulty="${question.difficulty}"]`)?.classList.add('active');

            document.querySelectorAll('#category-buttons .btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`#category-buttons .btn[data-category="${question.category}"]`)?.classList.add('active');

            document.querySelector('.modal-title').textContent = 'Edytuj pytanie - Runda 2';
            questionModal.show();
        } catch (error) {
            alert('B≈ÇƒÖd ≈Çadowania pytania: ' + error.message);
        }
    }

    async function deleteQuestionR2(id) {
        if (!confirm('Czy na pewno chcesz usunƒÖƒá to pytanie?')) return;

        try {
            const response = await fetch(`/api/host/question/${id}?round=2`, { method: 'DELETE' });
            if (!response.ok) throw new Error('B≈ÇƒÖd usuwania pytania');
            loadQuestionsR2();
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    }

    document.querySelector('button[data-bs-target="#questions-r2"]')?.addEventListener('click', loadQuestionsR2);

    // =====================================================================
    // PYTANIA RUNDA 3
    // =====================================================================
    let currentEditingQuestionIdR3 = null;

    function loadQuestionsR3() {
        fetch('/api/host/questions?round=3')
            .then(res => res.json())
            .then(questions => {
                const list = document.getElementById('r3-questions-list');
                if (questions.length === 0) {
                    list.innerHTML = `<p class="text-muted">${translations[currentLanguage].add_question}</p>`;
                    return;
                }

                list.innerHTML = questions.map((q, index) => {
                    const percentage = q.times_shown > 0 ? Math.round((q.times_correct / q.times_shown) * 100) : 0;
                    return `
                        <div class="question-item d-flex align-items-start">
                            <div class="me-3">
                                <strong>${index + 1}.</strong>
                            </div>
                            <div class="flex-grow-1">
                                <p class="mb-2">${q.text}</p>
                                <div class="question-stats">
                                    <span class="badge bg-info">${translations[currentLanguage][q.difficulty] || q.difficulty}</span>
                                    <span>${translations[currentLanguage].shown}: ${q.times_shown}</span> |
                                    <span>${translations[currentLanguage].correct}: ${q.times_correct}</span> |
                                    <span>${percentage}%</span>
                                </div>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-outline-primary me-2 edit-question-r3-btn" data-id="${q.id}">Edytuj</button>
                                <button class="btn btn-sm btn-outline-danger delete-question-r3-btn" data-id="${q.id}">Usu≈Ñ</button>
                            </div>
                        </div>
                    `;
                }).join('');

                // Attach event listeners
                document.querySelectorAll('.edit-question-r3-btn').forEach(btn => {
                    btn.addEventListener('click', () => editQuestionR3(parseInt(btn.dataset.id)));
                });
                document.querySelectorAll('.delete-question-r3-btn').forEach(btn => {
                    btn.addEventListener('click', () => deleteQuestionR3(parseInt(btn.dataset.id)));
                });
            });
    }

    document.getElementById('r3-add-question-btn')?.addEventListener('click', () => {
        currentEditingQuestionIdR3 = null;
        currentEditingQuestionRound = 3;
        document.getElementById('modal-question-text').value = '';
        document.getElementById('modal-answer-a').value = '';
        document.getElementById('modal-answer-b').value = '';
        document.getElementById('modal-answer-c').value = '';
        document.getElementById('modal-letter').value = 'X';
        document.querySelectorAll('input[name="correct-answer"]').forEach(r => r.checked = false);
        document.getElementById('correct-a').checked = true;
        document.querySelectorAll('#difficulty-buttons .btn').forEach(b => b.classList.remove('active'));
        document.querySelector('#difficulty-buttons .btn[data-difficulty="easy"]')?.classList.add('active');
        document.querySelectorAll('#category-buttons .btn').forEach(b => b.classList.remove('active'));
        document.querySelector('#category-buttons .btn[data-category="company"]')?.classList.add('active');
        document.querySelector('.modal-title').textContent = 'Dodaj pytanie - Runda 3';
        questionModal.show();
    });

    async function editQuestionR3(id) {
        try {
            const response = await fetch('/api/host/questions?round=3');
            const questions = await response.json();
            const question = questions.find(q => q.id === id);

            if (!question) return;

            currentEditingQuestionIdR3 = id;
            currentEditingQuestionRound = 3;
            document.getElementById('modal-question-text').value = question.text;
            document.getElementById('modal-answer-a').value = question.answers[0];
            document.getElementById('modal-answer-b').value = question.answers[1];
            document.getElementById('modal-answer-c').value = question.answers[2];
            document.getElementById('modal-letter').value = question.letterToReveal;

            document.getElementById(`correct-${question.correctAnswer.toLowerCase()}`).checked = true;

            document.querySelectorAll('#difficulty-buttons .btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`#difficulty-buttons .btn[data-difficulty="${question.difficulty}"]`)?.classList.add('active');

            document.querySelectorAll('#category-buttons .btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`#category-buttons .btn[data-category="${question.category}"]`)?.classList.add('active');

            document.querySelector('.modal-title').textContent = 'Edytuj pytanie - Runda 3';
            questionModal.show();
        } catch (error) {
            alert('B≈ÇƒÖd ≈Çadowania pytania: ' + error.message);
        }
    }

    async function deleteQuestionR3(id) {
        if (!confirm('Czy na pewno chcesz usunƒÖƒá to pytanie?')) return;

        try {
            const response = await fetch(`/api/host/question/${id}?round=3`, { method: 'DELETE' });
            if (!response.ok) throw new Error('B≈ÇƒÖd usuwania pytania');
            loadQuestionsR3();
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    }

    document.querySelector('button[data-bs-target="#questions-r3"]')?.addEventListener('click', loadQuestionsR3);

    // =====================================================================
    // MINIGRY
    // =====================================================================
    function loadMinigamesStatus() {
        fetch('/api/host/minigames/status')
            .then(res => res.json())
            .then(data => {
                // Tetris
                const tetrisToggle = document.getElementById('tetris-toggle');
                const tetrisStatus = document.getElementById('tetris-status');
                if (tetrisToggle && tetrisStatus) {
                    tetrisToggle.checked = data.tetris_enabled;
                    tetrisStatus.textContent = data.tetris_enabled ? 'Aktywny' : 'Nieaktywny';
                    tetrisStatus.className = data.tetris_enabled ? 'badge bg-success' : 'badge bg-secondary';
                }

                // Arkanoid
                const arkanoidToggle = document.getElementById('arkanoid-toggle');
                const arkanoidStatus = document.getElementById('arkanoid-status');
                if (arkanoidToggle && arkanoidStatus) {
                    arkanoidToggle.checked = data.arkanoid_enabled;
                    arkanoidStatus.textContent = data.arkanoid_enabled ? 'Aktywny' : 'Nieaktywny';
                    arkanoidStatus.className = data.arkanoid_enabled ? 'badge bg-success' : 'badge bg-secondary';
                }

                // Snake
                const snakeToggle = document.getElementById('snake-toggle');
                const snakeStatus = document.getElementById('snake-status');
                if (snakeToggle && snakeStatus) {
                    snakeToggle.checked = data.snake_enabled;
                    snakeStatus.textContent = data.snake_enabled ? 'Aktywny' : 'Nieaktywny';
                    snakeStatus.className = data.snake_enabled ? 'badge bg-success' : 'badge bg-secondary';
                }

                // T-Rex
                const trexToggle = document.getElementById('trex-toggle');
                const trexStatus = document.getElementById('trex-status');
                if (trexToggle && trexStatus) {
                    trexToggle.checked = data.trex_enabled;
                    trexStatus.textContent = data.trex_enabled ? 'Aktywny' : 'Nieaktywny';
                    trexStatus.className = data.trex_enabled ? 'badge bg-success' : 'badge bg-secondary';
                }
            });
    }
    
    // Tetris toggle
    document.getElementById('tetris-toggle')?.addEventListener('change', async (e) => {
        const enabled = e.target.checked;
        const statusEl = document.getElementById('tetris-status');
        const infoEl = document.getElementById('minigames-info');
        try {
            const response = await fetch('/api/host/minigames/toggle', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ game_type: 'tetris', enabled })
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error);
            statusEl.textContent = enabled ? 'Aktywny' : 'Nieaktywny';
            statusEl.className = enabled ? 'badge bg-success' : 'badge bg-secondary';
            infoEl.textContent = result.message;
            infoEl.style.display = 'block';
            setTimeout(() => { infoEl.style.display = 'none'; }, 3000);
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            e.target.checked = !enabled;
        }
    });
    
    // Arkanoid toggle
    document.getElementById('arkanoid-toggle')?.addEventListener('change', async (e) => {
        const enabled = e.target.checked;
        const statusEl = document.getElementById('arkanoid-status');
        const infoEl = document.getElementById('minigames-info');
        try {
            const response = await fetch('/api/host/minigames/toggle', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ game_type: 'arkanoid', enabled })
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error);
            statusEl.textContent = enabled ? 'Aktywny' : 'Nieaktywny';
            statusEl.className = enabled ? 'badge bg-success' : 'badge bg-secondary';
            infoEl.textContent = result.message;
            infoEl.style.display = 'block';
            setTimeout(() => { infoEl.style.display = 'none'; }, 3000);
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            e.target.checked = !enabled;
        }
    });

    // Snake toggle
    document.getElementById('snake-toggle')?.addEventListener('change', async (e) => {
        const enabled = e.target.checked;
        const statusEl = document.getElementById('snake-status');
        const infoEl = document.getElementById('minigames-info');
        try {
            const response = await fetch('/api/host/minigames/toggle', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ game_type: 'snake', enabled })
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error);
            statusEl.textContent = enabled ? 'Aktywny' : 'Nieaktywny';
            statusEl.className = enabled ? 'badge bg-success' : 'badge bg-secondary';
            infoEl.textContent = result.message;
            infoEl.style.display = 'block';
            setTimeout(() => { infoEl.style.display = 'none'; }, 3000);
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            e.target.checked = !enabled;
        }
    });

    document.getElementById('trex-toggle')?.addEventListener('change', async (e) => {
        const enabled = e.target.checked;
        const statusEl = document.getElementById('trex-status');
        const infoEl = document.getElementById('minigames-info');
        try {
            const response = await fetch('/api/host/minigames/toggle', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ game_type: 'trex', enabled })
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error);
            statusEl.textContent = enabled ? 'Aktywny' : 'Nieaktywny';
            statusEl.className = enabled ? 'badge bg-success' : 'badge bg-secondary';
            infoEl.textContent = result.message;
            infoEl.style.display = 'block';
            setTimeout(() => { infoEl.style.display = 'none'; }, 3000);
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            e.target.checked = !enabled;
        }
    });

    document.querySelector('button[data-bs-target="#minigames"]')?.addEventListener('click', loadMinigamesStatus);

    // Funkcja do aktualizacji ustawie≈Ñ minigr√≥w
    async function updateMinigameSetting(settingType) {
        const infoEl = document.getElementById('minigames-info');
        let value, settingName;

        if (settingType === 'completion_points') {
            value = document.getElementById('minigame-completion-points').value;
            settingName = 'Liczba punkt√≥w za przej≈õcie gry';
        } else if (settingType === 'target_points') {
            value = document.getElementById('minigame-target-points').value;
            settingName = 'Liczba punkt√≥w do zdobycia w grze';
        }

        try {
            const response = await fetch('/api/host/minigames/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ setting_type: settingType, value: parseInt(value) })
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error);

            // Aktualizuj wy≈õwietlanie w alercie informacyjnym
            if (settingType === 'completion_points') {
                const completionDisplay = document.getElementById('minigame-completion-display');
                if (completionDisplay) completionDisplay.textContent = value;
            } else if (settingType === 'target_points') {
                const targetDisplay = document.getElementById('minigame-target-display');
                if (targetDisplay) targetDisplay.textContent = value;
            }

            infoEl.textContent = `${settingName} zaktualizowane: ${value}`;
            infoEl.className = 'alert alert-success mt-3';
            infoEl.style.display = 'block';
            setTimeout(() => { infoEl.style.display = 'none'; }, 3000);
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    }

    // Event listener dla prze≈ÇƒÖcznika wyboru gry
    document.getElementById('minigame-player-choice')?.addEventListener('change', async (e) => {
        const enabled = e.target.checked;
        const statusEl = document.getElementById('minigame-choice-status');
        const infoEl = document.getElementById('minigames-info');

        try {
            const response = await fetch('/api/host/minigames/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ setting_type: 'player_choice', value: enabled })
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error);

            statusEl.textContent = enabled ? 'Wyb√≥r gracza' : 'Losowa kolejno≈õƒá';
            statusEl.className = enabled ? 'badge bg-success' : 'badge bg-secondary';

            infoEl.textContent = enabled
                ? 'Gracze bƒôdƒÖ mogli wybraƒá grƒô po zeskanowaniu kodu QR'
                : 'Gry bƒôdƒÖ uruchamiane w losowej kolejno≈õci';
            infoEl.className = 'alert alert-success mt-3';
            infoEl.style.display = 'block';
            setTimeout(() => { infoEl.style.display = 'none'; }, 3000);
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            e.target.checked = !enabled;
        }
    });

    // ≈Åadowanie ustawie≈Ñ minigr√≥w przy starcie
    function loadMinigamesSettings() {
        fetch('/api/host/minigames/settings')
            .then(res => res.json())
            .then(data => {
                // Ustawienie punkt√≥w za przej≈õcie
                const completionPointsInput = document.getElementById('minigame-completion-points');
                if (completionPointsInput && data.completion_points !== undefined) {
                    completionPointsInput.value = data.completion_points;
                }

                // Ustawienie punkt√≥w do zdobycia
                const targetPointsInput = document.getElementById('minigame-target-points');
                if (targetPointsInput && data.target_points !== undefined) {
                    targetPointsInput.value = data.target_points;
                }

                // Ustawienie prze≈ÇƒÖcznika wyboru gry
                const playerChoiceToggle = document.getElementById('minigame-player-choice');
                const playerChoiceStatus = document.getElementById('minigame-choice-status');
                if (playerChoiceToggle && playerChoiceStatus && data.player_choice !== undefined) {
                    playerChoiceToggle.checked = data.player_choice;
                    playerChoiceStatus.textContent = data.player_choice ? 'Wyb√≥r gracza' : 'Losowa kolejno≈õƒá';
                    playerChoiceStatus.className = data.player_choice ? 'badge bg-success' : 'badge bg-secondary';
                }

                // Aktualizuj wy≈õwietlanie warto≈õci w alercie informacyjnym
                const targetDisplay = document.getElementById('minigame-target-display');
                const completionDisplay = document.getElementById('minigame-completion-display');
                if (targetDisplay && data.target_points !== undefined) {
                    targetDisplay.textContent = data.target_points;
                }
                if (completionDisplay && data.completion_points !== undefined) {
                    completionDisplay.textContent = data.completion_points;
                }
            })
            .catch(error => console.error('B≈ÇƒÖd ≈Çadowania ustawie≈Ñ minigr√≥w:', error));
    }

    // Wywo≈Çaj ≈Çadowanie ustawie≈Ñ gdy zak≈Çadka Minigry jest otwierana
    document.querySelector('button[data-bs-target="#minigames"]')?.addEventListener('click', loadMinigamesSettings);

    // =====================================================================
    // STEROWANIE GRƒÑ
    // =====================================================================
    const infoElements = {
        playerCount: document.getElementById('info-player-count'),
        completionPercentage: document.getElementById('info-completion-percentage'),
        language: document.getElementById('info-language'),
        timeLeft: document.getElementById('info-time-left'),
        timeElapsed: document.getElementById('info-time-elapsed'),
        timeElapsedPauses: document.getElementById('info-time-elapsed-pauses'),
        bonus: document.getElementById('info-bonus'),
        speed: document.getElementById('info-speed'),
        gameStatus: document.getElementById('info-game-status')
    };
    
    let isTimerRunning = false;
    let isGameActive = false;
    
    async function sendGameControl(control, value = null) {
        console.log('üéÆ Sending game control:', control, value);
        try {
            const response = await fetch('/api/host/game_control', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ control, value })
            });
            if (!response.ok) throw new Error('Server error');
            const result = await response.json();
            console.log('‚úÖ Game control response:', result);
        } catch (error) {
            console.error('‚ùå Control error:', error);
        }
    }
    
    function updateUI(state) {
        console.log('üîÑ Updating UI with state:', state);
        
        // Update player count
        if (infoElements.playerCount) infoElements.playerCount.textContent = state.player_count || 0;
        
        // ‚úÖ Update completion percentage
        if (infoElements.completionPercentage) {
            infoElements.completionPercentage.textContent = `${state.completion_percentage || 0}%`;
        }
        
        // Update language display
        if (infoElements.language) {
            const langText = state.language_host === 'en' ? 'English' : 'Polski';
            infoElements.language.textContent = langText;
        }
        
        // Update bonus display
        if (infoElements.bonus) {
            const bonusVal = state.bonus_multiplier || 1;
            infoElements.bonus.textContent = bonusVal > 1 ? `x${bonusVal}` : 'Brak';
            
            // Update button states
            document.querySelectorAll('[data-control="bonus"]').forEach(btn => {
                btn.classList.toggle('active-modifier', btn.dataset.value === String(bonusVal));
            });
        }
        
        // Update speed display
        if (infoElements.speed) {
            const speedVal = state.time_speed || 1;
            infoElements.speed.textContent = `x${speedVal}`;
            
            // Update button states
            document.querySelectorAll('[data-control="speed"]').forEach(btn => {
                btn.classList.toggle('active-modifier', btn.dataset.value === String(speedVal));
            });
        }
        
        // ‚úÖ Update game status
        if (infoElements.gameStatus) {
            const statusEl = infoElements.gameStatus;
            const status = state.game_status || 'waiting';
            statusEl.dataset.status = status;
            
            // Remove all status classes
            statusEl.classList.remove('status-waiting', 'status-active', 'status-paused', 'status-stopped');
            
            // Add appropriate class
            statusEl.classList.add(`status-${status}`);
            
            // Update text
            updateGameStatusText();
        }
        
        // Update pause button text
        const pauseBtn = document.getElementById('pause-btn');
        if (pauseBtn) {
            isTimerRunning = state.is_timer_running;
            pauseBtn.textContent = state.is_timer_running 
                ? translations[currentLanguage].pause 
                : translations[currentLanguage].resume;
        }
        
        // Store game active state
        isGameActive = state.game_active;
        
        // ‚úÖ LOGIKA AKTYWACJI/DEAKTYWACJI PRZYCISK√ìW
        const startGameBtn = document.getElementById('start-game');
        const pauseGameBtn = document.getElementById('pause-btn');
        const stopGameBtn = document.getElementById('stop-game');
        const resetGameBtn = document.getElementById('reset-game');
        
        if (state.game_active) {
            // GRA JEST AKTYWNA
            // Start - nieaktywny (blady)
            if (startGameBtn) {
                startGameBtn.disabled = true;
                startGameBtn.classList.add('opacity-50');
            }
            
            // Pauza - aktywny
            if (pauseGameBtn) {
                pauseGameBtn.disabled = false;
                pauseGameBtn.classList.remove('opacity-50');
            }
            
            // Stop - aktywny
            if (stopGameBtn) {
                stopGameBtn.disabled = false;
                stopGameBtn.classList.remove('opacity-50');
            }
            
            // Reset - aktywny
            if (resetGameBtn) {
                resetGameBtn.disabled = false;
                resetGameBtn.classList.remove('opacity-50');
            }
        } else {
            // GRA NIE JEST AKTYWNA
            // Start - aktywny
            if (startGameBtn) {
                startGameBtn.disabled = false;
                startGameBtn.classList.remove('opacity-50');
            }
            
            // Pauza - nieaktywny (blady)
            if (pauseGameBtn) {
                pauseGameBtn.disabled = true;
                pauseGameBtn.classList.add('opacity-50');
            }
            
            // Stop - nieaktywny (blady)
            if (stopGameBtn) {
                stopGameBtn.disabled = true;
                stopGameBtn.classList.add('opacity-50');
            }
            
            // Reset - nieaktywny (blady)
            if (resetGameBtn) {
                resetGameBtn.disabled = true;
                resetGameBtn.classList.add('opacity-50');
            }
        }
        
        // Enable/disable fieldsets based on game state
        const preGameFieldset = document.getElementById('pre-game-settings');
        const inGameFieldset = document.getElementById('in-game-settings');
        const timingFieldset = document.getElementById('timing-settings');
        const gameDurationInput = document.getElementById('game-duration-input-2');
        const setTimeBtn = document.getElementById('set-time-btn-2');

        // ‚úÖ Zawsze w≈ÇƒÖcz timing-settings (zak≈Çadka Czas i tempo)
        if (timingFieldset) {
            timingFieldset.disabled = false;
        }

        if (state.game_active) {
            preGameFieldset.disabled = false; // ‚úÖ Zawsze dostƒôpne
            inGameFieldset.disabled = false;
            // ‚úÖ Zmie≈Ñ tekst przycisku podczas gry
            if (setTimeBtn) setTimeBtn.textContent = translations[currentLanguage].set_time_btn || 'OK';
        } else {
            preGameFieldset.disabled = false;
            inGameFieldset.disabled = true;
            // ‚úÖ Przywr√≥ƒá oryginalny tekst przycisku
            if (setTimeBtn) setTimeBtn.textContent = translations[currentLanguage].set_time_btn || 'OK';
        }
        
        // ‚úÖ Aktualizuj wy≈õwietlanie has≈Ça
        const passwordDisplay = document.getElementById('current-password-display');
        if (passwordDisplay && state.password) {
            passwordDisplay.textContent = state.password.split('').join(' ');
        }
    }
    
    // Socket.IO event handlers
    socket.on('connect', () => {
        console.log('‚úÖ Socket connected, joining room for event:', EVENT_ID);
        socket.emit('join', { event_id: EVENT_ID });
    });
    
    socket.on('disconnect', () => {
        console.log('‚ùå Socket disconnected');
    });
    
    socket.on('game_state_update', (state) => {
        console.log('üì° Game state update received:', state);
        updateUI(state);
    });
    
    socket.on('timer_tick', (data) => {
        console.log('‚è±Ô∏è Timer tick:', data);
        if (infoElements.timeLeft) infoElements.timeLeft.textContent = formatTime(data.time_left);
        if (infoElements.timeElapsed) infoElements.timeElapsed.textContent = formatTime(data.time_elapsed);
        // ‚úÖ Zawsze aktualizuj czas brutto (r√≥wnie≈º podczas pauzy)
        if (infoElements.timeElapsedPauses) infoElements.timeElapsedPauses.textContent = formatTime(data.time_elapsed_with_pauses);
    });
    
    socket.on('game_over', () => {
        alert('Czas minƒÖ≈Ç! Gra zako≈Ñczona.');
    });
    
    socket.on('game_forced_win', (data) => {
        alert(data.message);
    });
    
    socket.on('password_update', (password) => {
        const passwordDisplay = document.getElementById('current-password-display');
        if (passwordDisplay) {
            passwordDisplay.textContent = password.split('').join(' ');
        }

        // ‚úÖ NOWE: Aktualizuj r√≥wnie≈º podglƒÖd has≈Ça w zak≈Çadce Gra
        loadPasswordState();
    });

    socket.on('leaderboard_update', (players) => {
        console.log('üìä Leaderboard update received:', players);
        loadPlayers();
    });

    // Initial state load
    console.log('üîÑ Loading initial state...');
    fetch('/api/host/state')
        .then(res => res.json())
        .then(state => {
            console.log('‚úÖ Initial state loaded:', state);
            updateUI(state);
            if (state.language_host === 'en') {
                translatePage('en');
                document.querySelectorAll('#lang-host-controls button').forEach(b => b.classList.remove('active-modifier'));
                document.querySelector('#lang-host-controls button[data-value="en"]')?.classList.add('active-modifier');
            }
            if (state.language_player === 'en') {
                document.querySelectorAll('#lang-player-controls button').forEach(b => b.classList.remove('active-modifier'));
                document.querySelector('#lang-player-controls button[data-value="en"]')?.classList.add('active-modifier');
            }

            // ‚úÖ Za≈Çaduj stan has≈Ça od razu przy inicjalizacji - WYMUSZONY
            setTimeout(() => loadPasswordState(), 100);

            // ‚úÖ Za≈Çaduj listƒô graczy od razu przy inicjalizacji
            setTimeout(() => loadPlayers(), 100);
        })
        .catch(error => console.error('‚ùå Error loading initial state:', error));
    
    // ‚úÖ NOWY: Ujednolicona obs≈Çuga przycisku "OK"
    document.getElementById('set-time-btn-2')?.addEventListener('click', async () => {
        const minutes = parseInt(document.getElementById('game-duration-input-2').value);
        console.log('üéÆ Setting time:', minutes, 'minutes, Game active:', isGameActive);
        
        if (isNaN(minutes) || minutes < 1) {
            alert('Proszƒô wprowadziƒá poprawny czas gry (minimum 1 minuta).');
            return;
        }
        
        if (!isGameActive) {
            // ‚úÖ PRZED GRƒÑ: Po prostu zapisz warto≈õƒá (nie uruchamiaj gry)
            alert(`Czas gry ustawiony na ${minutes} minut. Kliknij "Start Gry", aby rozpoczƒÖƒá.`);
        } else {
            // ‚úÖ PODCZAS GRY: Zmie≈Ñ czas (wymaga has≈Ça)
            const password = prompt('Wprowad≈∫ has≈Ço Hosta, aby zmieniƒá czas gry:');
            if (!password) return;
            
            if (!confirm(`Czy na pewno chcesz zmieniƒá czas gry na ${minutes} minut?`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/host/adjust_time', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        new_minutes: minutes,
                        password: password 
                    })
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'B≈ÇƒÖd zmiany czasu');
                }
                
                alert(result.message || 'Czas gry zosta≈Ç zmieniony!');
            } catch (error) {
                alert('B≈ÇƒÖd: ' + error.message);
            }
        }
    });
    
    // ‚úÖ Synchronizacja p√≥l czasu gry miƒôdzy sekcjami
    const dashboardInput = document.getElementById('game-duration-input-dashboard');
    const timingInput = document.getElementById('game-duration-input-2');

    if (dashboardInput && timingInput) {
        dashboardInput.addEventListener('input', () => {
            timingInput.value = dashboardInput.value;
        });

        timingInput.addEventListener('input', () => {
            dashboardInput.value = timingInput.value;
        });
    }

    // ‚úÖ Obs≈Çuga przycisku "OK" w sekcji Pulpit (synchronizacja z timing-section)
    document.getElementById('set-time-btn-dashboard')?.addEventListener('click', async () => {
        const minutes = parseInt(document.getElementById('game-duration-input-dashboard').value);
        console.log('üéÆ Setting time (dashboard):', minutes, 'minutes, Game active:', isGameActive);

        if (isNaN(minutes) || minutes < 1) {
            alert('Proszƒô wprowadziƒá poprawny czas gry (minimum 1 minuta).');
            return;
        }

        // Synchronizuj z polem w timing-section
        const timingInput = document.getElementById('game-duration-input-2');
        if (timingInput) {
            timingInput.value = minutes;
        }

        if (!isGameActive) {
            // ‚úÖ PRZED GRƒÑ: Po prostu zapisz warto≈õƒá (nie uruchamiaj gry)
            alert(`Czas gry ustawiony na ${minutes} minut. Kliknij "Start Gry", aby rozpoczƒÖƒá.`);
        } else {
            // ‚úÖ PODCZAS GRY: Zmie≈Ñ czas (wymaga has≈Ça)
            const password = prompt('Wprowad≈∫ has≈Ço Hosta, aby zmieniƒá czas gry:');
            if (!password) return;

            if (!confirm(`Czy na pewno chcesz zmieniƒá czas gry na ${minutes} minut?`)) {
                return;
            }

            try {
                const response = await fetch('/api/host/adjust_time', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        new_minutes: minutes,
                        password: password
                    })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'B≈ÇƒÖd zmiany czasu');
                }

                alert(result.message || 'Czas gry zosta≈Ç zmieniony!');
            } catch (error) {
                alert('B≈ÇƒÖd: ' + error.message);
            }
        }
    });

    // Start game button
    document.getElementById('start-game')?.addEventListener('click', async () => {
        console.log('üñ±Ô∏è Start Game button clicked');

        // Inteligentne pobieranie warto≈õci czasu z jednego z dw√≥ch p√≥l
        const dashboardInput = document.getElementById('game-duration-input-dashboard');
        const timingInput = document.getElementById('game-duration-input-2');

        let minutesValue = '60'; // Warto≈õƒá domy≈õlna

        // Pr√≥bujemy pobraƒá z pola dashboard (Pulpit)
        if (dashboardInput && dashboardInput.value) {
            minutesValue = dashboardInput.value;
            console.log('‚è±Ô∏è Using time from dashboard field:', minutesValue);
        }
        // Je≈õli nie ma, pr√≥bujemy z pola timing (zak≈Çadka Czas)
        else if (timingInput && timingInput.value) {
            minutesValue = timingInput.value;
            console.log('‚è±Ô∏è Using time from timing field:', minutesValue);
        } else {
            console.log('‚è±Ô∏è Using default time:', minutesValue);
        }

        const minutes = parseInt(minutesValue);
        console.log('üéÆ Starting game with', minutes, 'minutes');

        if (isNaN(minutes) || minutes < 1) {
            alert('Proszƒô wprowadziƒá poprawny czas gry (minimum 1 minuta).');
            return;
        }

        if (!confirm(`Czy na pewno chcesz rozpoczƒÖƒá nowƒÖ grƒô na ${minutes} minut?`)) {
            return;
        }

        // Wizualna informacja o uruchamianiu
        const startGameBtn = document.getElementById('start-game');
        const originalText = startGameBtn ? startGameBtn.textContent : '';
        if (startGameBtn) {
            startGameBtn.disabled = true;
            startGameBtn.textContent = "Uruchamianie...";
        }

        try {
            console.log('üì§ Sending start game request...');
            const response = await fetch('/api/host/start_game', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ minutes })
            });

            const result = await response.json();
            console.log('üì• Start game response:', result);

            if (!response.ok) {
                throw new Error(result.error || 'Nieznany b≈ÇƒÖd uruchamiania gry');
            }

            console.log('‚úÖ Game started successfully');
            alert(result.message || 'Gra rozpoczƒôta!');
        } catch (error) {
            console.error('‚ùå Error starting game:', error);
            alert('B≈ÇƒÖd podczas uruchamiania gry: ' + error.message);

            // Przywr√≥ƒá przycisk w przypadku b≈Çƒôdu
            if (startGameBtn) {
                startGameBtn.disabled = false;
                startGameBtn.textContent = originalText;
            }
        }
    });
    
    // Stop game button
    document.getElementById('stop-game')?.addEventListener('click', async () => {
        const password = prompt('Wprowad≈∫ has≈Ço Hosta, aby zako≈Ñczyƒá grƒô:');
        if (!password) return;
        
        try {
            const response = await fetch('/api/host/stop_game', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password })
            });
            
            const result = await response.json();
            
            if (!response.ok) {
                throw new Error(result.error || 'B≈ÇƒÖd zatrzymywania gry');
            }
            
            alert(result.message || 'Gra zatrzymana');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    });
    
    // Reset game button
    document.getElementById('reset-game')?.addEventListener('click', async () => {
        const password = prompt('Wprowad≈∫ has≈Ço Hosta, aby zresetowaƒá grƒô:');
        if (!password) return;
        
        if (!confirm('Czy na pewno chcesz zresetowaƒá ca≈ÇƒÖ grƒô? To usunie wszystkich graczy, pytania i dane gry!')) {
            return;
        }
        
        try {
            // Weryfikuj has≈Ço przez endpoint stop_game (mo≈ºesz te≈º dodaƒá osobny endpoint)
            // Na razie wykorzystamy istniejƒÖcy endpoint do resetu z admina
            const response = await fetch(`/api/admin/event/${EVENT_ID}/reset`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            
            const result = await response.json();
            
            if (!response.ok) {
                throw new Error(result.message || 'B≈ÇƒÖd resetowania gry');
            }
            
            alert(result.message || 'Gra zosta≈Ça zresetowana');
            location.reload(); // Od≈õwie≈º stronƒô
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    });
    
    // In-game controls
    document.getElementById('game-controls')?.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-control]');
        if (!btn) return;

        const control = btn.dataset.control;
        const value = btn.dataset.value;

        console.log('üéÆ Sending game control:', control, value);
        sendGameControl(control, value);
    });

    // Pause button
    document.getElementById('pause-btn')?.addEventListener('click', () => {
        console.log('üéÆ Pause/Resume button clicked');
        sendGameControl('pause');
    });

    // Timing controls (zak≈Çadka Czas i tempo)
    document.getElementById('timing-controls')?.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-control]');
        if (!btn) return;

        const control = btn.dataset.control;
        const value = btn.dataset.value;

        console.log('üéÆ Sending timing control:', control, value);
        sendGameControl(control, value);
    });

// =====================================================================
    // ‚úÖ KOMUNIKATY NA EKRAN GRY
    // =====================================================================
    const messageInput = document.getElementById('host-message-input');
    const charCount = document.getElementById('message-char-count');
    const sendMessageBtn = document.getElementById('send-message-btn');
    const messageStatus = document.getElementById('message-status');

    if (messageInput && charCount) {
        messageInput.addEventListener('input', () => {
            charCount.textContent = messageInput.value.length;
        });
    }

    // Wysy≈Çanie komunikatu
    if (sendMessageBtn) {
        sendMessageBtn.addEventListener('click', async () => {
            const message = messageInput.value.trim();
            
            if (!message) {
                messageStatus.innerHTML = '<div class="alert alert-warning">Wpisz tre≈õƒá komunikatu</div>';
                setTimeout(() => messageStatus.innerHTML = '', 3000);
                return;
            }
            
            sendMessageBtn.disabled = true;
            sendMessageBtn.textContent = 'Wysy≈Çanie...';
            
            try {
                const response = await fetch('/api/host/send_message', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'B≈ÇƒÖd wysy≈Çania');
                }
                
                messageStatus.innerHTML = '<div class="alert alert-success">‚úÖ Komunikat wys≈Çany!</div>';
                messageInput.value = '';
                charCount.textContent = '0';
                
                setTimeout(() => messageStatus.innerHTML = '', 3000);
            } catch (error) {
                messageStatus.innerHTML = `<div class="alert alert-danger">‚ùå ${error.message}</div>`;
            } finally {
                sendMessageBtn.disabled = false;
                sendMessageBtn.textContent = translations[currentLanguage].send_message || 'Wy≈õlij komunikat';
            }
        });
    }
    
    console.log('‚úÖ HOST PANEL INITIALIZED');

// =====================================================================
// ZARZƒÑDZANIE HAS≈ÅEM - NOWY SYSTEM Z INDEKSAMI
// =====================================================================

    let currentPassword = 'SAPEREVENT';
    let revealedLettersIndices = new Set();
    let autoRevealEnabled = true;
    let selectedLettersForReveal = new Set();
    let passwordLetters = [];


      // ‚úÖ NOWA FUNKCJA: Renderowanie podglƒÖdu has≈Ça w zak≈Çadce Gra
    function renderGamePasswordPreview() {
        const container = document.getElementById('game-password-display');
        if (!container) return;
        
        container.innerHTML = '';
        
        for (let i = 0; i < currentPassword.length; i++) {
            const char = currentPassword[i];
            const isRevealed = revealedLettersIndices.has(i);
            
            if (char === ' ') {
                // Spacja = odstƒôp
                const spaceEl = document.createElement('div');
                spaceEl.style.width = '15px';
                spaceEl.style.height = '30px';
                container.appendChild(spaceEl);
            } else {
                // Litera = badge (czerwony lub zielony)
                const span = document.createElement('span');
                span.className = isRevealed ? 'badge bg-success' : 'badge bg-danger';
                span.textContent = char;
                span.style.fontSize = '0.9rem';      // Mniejsza czcionka
                span.style.width = '28px';           // Mniejszy rozmiar
                span.style.height = '28px';
                span.style.display = 'inline-flex';
                span.style.alignItems = 'center';
                span.style.justifyContent = 'center';
                container.appendChild(span);
            }
        }
    }
    
    async function loadPasswordState() {
        try {
            const response = await fetch('/api/host/password/state');
            const data = await response.json();
            
            currentPassword = data.password;
            autoRevealEnabled = data.mode === 'auto';

            revealedLettersIndices.clear();
            if (data.revealed_letters) {
                const indices = data.revealed_letters.split(',').filter(x => x);
                indices.forEach(idx => revealedLettersIndices.add(parseInt(idx)));
            }

            document.getElementById('password-edit-input').value = currentPassword;

            const autoToggle = document.getElementById('password-auto-reveal-toggle');
            const autoStatus = document.getElementById('auto-reveal-status');
            if (autoToggle && autoStatus) {
                autoToggle.checked = autoRevealEnabled;
                autoStatus.textContent = autoRevealEnabled ? 'W≈ÇƒÖczone' : 'Wy≈ÇƒÖczone';
                autoStatus.className = autoRevealEnabled ? 'badge bg-success' : 'badge bg-secondary';
            }

            // Ustaw warto≈õƒá procentu
            const percentageInput = document.getElementById('auto-reveal-percentage');
            if (percentageInput && data.reveal_percentage) {
                percentageInput.value = data.reveal_percentage;
            }
            
            renderPasswordLetters();
            
       // ‚úÖ NOWE: Renderuj r√≥wnie≈º podglƒÖd w zak≈Çadce Gra
            renderGamePasswordPreview();
            
        } catch (error) {
            console.error('B≈ÇƒÖd ≈Çadowania has≈Ça:', error);
        }
    }
    
    function renderPasswordLetters() {
        const container = document.getElementById('password-letters-display');
        if (!container) return;
        
        container.innerHTML = '';
        passwordLetters = [];
        selectedLettersForReveal.clear();
        
        for (let i = 0; i < currentPassword.length; i++) {
            const char = currentPassword[i];
            const isRevealed = revealedLettersIndices.has(i);
            
            passwordLetters.push({ char, index: i, revealed: isRevealed });
            
            if (char === ' ') {
                const spaceEl = document.createElement('div');
                spaceEl.style.width = '30px';
                spaceEl.style.height = '50px';
                container.appendChild(spaceEl);
            } else {
                const btn = document.createElement('button');
                btn.className = isRevealed ? 'btn btn-success' : 'btn btn-danger';
                btn.textContent = char;
                btn.disabled = false;
                btn.style.width = '50px';
                btn.style.height = '50px';
                btn.style.fontSize = '1.5rem';
                btn.style.fontWeight = 'bold';
                btn.dataset.index = i;
                
                btn.addEventListener('click', () => {
                    if (isRevealed) return;
                    
                    if (btn.classList.contains('btn-danger')) {
                        btn.classList.remove('btn-danger');
                        btn.classList.add('btn-warning');
                        selectedLettersForReveal.add(i);
                    } else if (btn.classList.contains('btn-warning')) {
                        btn.classList.remove('btn-warning');
                        btn.classList.add('btn-danger');
                        selectedLettersForReveal.delete(i);
                    }
                    
                    const confirmBtn = document.getElementById('reveal-selected-letters-btn');
                    if (confirmBtn) {
                        confirmBtn.disabled = selectedLettersForReveal.size === 0;
                    }
                });
                
                container.appendChild(btn);
            }
        }
        
        const confirmBtn = document.getElementById('reveal-selected-letters-btn');
        if (confirmBtn) {
            confirmBtn.disabled = true;
        }
        
        // ‚úÖ NOWE: Aktualizuj r√≥wnie≈º podglƒÖd w zak≈Çadce Gra
        renderGamePasswordPreview();
    }
    
    document.getElementById('password-edit-ok-btn')?.addEventListener('click', async () => {
        const newPassword = document.getElementById('password-edit-input').value.trim().toUpperCase();
        const statusEl = document.getElementById('password-edit-status');
        
        if (!newPassword) {
            statusEl.innerHTML = '<div class="alert alert-warning">Has≈Ço nie mo≈ºe byƒá puste</div>';
            return;
        }
        
        if (newPassword.length > 50) {
            statusEl.innerHTML = '<div class="alert alert-warning">Has≈Ço mo≈ºe mieƒá maksymalnie 50 znak√≥w</div>';
            return;
        }
        
        try {
            const response = await fetch('/api/host/password/set', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password: newPassword })
            });
            
            const result = await response.json();
            
            if (!response.ok) {
                throw new Error(result.error || 'B≈ÇƒÖd zapisu has≈Ça');
            }
            
            currentPassword = newPassword;
            revealedLettersIndices.clear();
            statusEl.innerHTML = '<div class="alert alert-success">‚úÖ Has≈Ço zaktualizowane!</div>';
            
            loadPasswordState();
            
            setTimeout(() => statusEl.innerHTML = '', 3000);
        } catch (error) {
            statusEl.innerHTML = `<div class="alert alert-danger">‚ùå ${error.message}</div>`;
        }
    });
    
    document.getElementById('password-auto-reveal-toggle')?.addEventListener('change', async (e) => {
        const enabled = e.target.checked;
        const statusEl = document.getElementById('auto-reveal-status');
        
        try {
            const mode = enabled ? 'auto' : 'manual';
            const response = await fetch('/api/host/password/mode', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ mode })
            });
            
            const result = await response.json();
            
            if (!response.ok) {
                throw new Error(result.error || 'B≈ÇƒÖd zmiany trybu');
            }
            
            autoRevealEnabled = enabled;
            statusEl.textContent = enabled ? 'W≈ÇƒÖczone' : 'Wy≈ÇƒÖczone';
            statusEl.className = enabled ? 'badge bg-success' : 'badge bg-secondary';
            
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            e.target.checked = !enabled;
        }
    });

    // Event listener dla zmiany procentu odkrywania
    document.getElementById('auto-reveal-percentage')?.addEventListener('change', async (e) => {
        const percentage = parseInt(e.target.value);

        if (isNaN(percentage) || percentage < 1 || percentage > 100) {
            alert('Procent musi byƒá w zakresie 1-100');
            e.target.value = 50; // Reset do domy≈õlnej warto≈õci
            return;
        }

        try {
            const response = await fetch('/api/host/password/reveal_percentage', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ percentage })
            });

            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.error || 'B≈ÇƒÖd zmiany procentu');
            }

            console.log(`Procent odkrywania ustawiony na: ${percentage}%`);

        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            loadPasswordState(); // Prze≈Çaduj warto≈õƒá z serwera
        }
    });

    document.getElementById('reveal-selected-letters-btn')?.addEventListener('click', async () => {
        if (selectedLettersForReveal.size === 0) return;
        
        const indices = Array.from(selectedLettersForReveal);
        const statusEl = document.getElementById('password-reveal-status');
        
        try {
            const response = await fetch('/api/host/password/reveal_manual', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ indices })
            });
            
            const result = await response.json();
            
            if (!response.ok) {
                throw new Error(result.error || 'B≈ÇƒÖd odkrywania liter');
            }
            
            indices.forEach(idx => revealedLettersIndices.add(idx));
            
            statusEl.innerHTML = `<div class="alert alert-success">‚úÖ ${result.message}</div>`;
            
            renderPasswordLetters();
            
            setTimeout(() => statusEl.innerHTML = '', 3000);
        } catch (error) {
            statusEl.innerHTML = `<div class="alert alert-danger">‚ùå ${error.message}</div>`;
        }
    });
    
    document.querySelector('button[data-bs-target="#password"]')?.addEventListener('click', loadPasswordState);

    // ===================================================
    // AI CATEGORIES MANAGEMENT
    // ===================================================
    async function loadAICategories() {
        try {
            const response = await fetch('/api/host/ai/categories');
            const categories = await response.json();

            const categoriesList = document.getElementById('ai-categories-list');
            categoriesList.innerHTML = '';

            if (categories.length === 0) {
                categoriesList.innerHTML = '<p class="text-muted">Brak kategorii. Dodaj swojƒÖ pierwszƒÖ kategoriƒô powy≈ºej.</p>';
                return;
            }

            categories.forEach(cat => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'card mb-3';

                const difficultyBadge = cat.difficulty_level === 'easy' ? 'success' :
                                       cat.difficulty_level === 'medium' ? 'warning' : 'danger';
                const difficultyText = cat.difficulty_level === 'easy' ? '≈Åatwy' :
                                      cat.difficulty_level === 'medium' ? '≈öredni' : 'Zaawansowany';

                categoryItem.innerHTML = `
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="flex-grow-1">
                                <h6 class="mb-1">${cat.name}</h6>
                                <span class="badge bg-${difficultyBadge}">${difficultyText}</span>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox"
                                       ${cat.is_enabled ? 'checked' : ''}
                                       onchange="toggleAICategory(${cat.id}, this.checked)">
                                <label class="form-check-label">Aktywna</label>
                            </div>
                            <button class="btn btn-sm btn-primary ms-3" onclick="generateQuestionsForCategory(${cat.id}, '${cat.name}')">
                                Generuj pytania
                            </button>
                            <button class="btn btn-sm btn-info ms-2" onclick="editCategoryQuestions(${cat.id}, '${cat.name}')">
                                Edytuj
                            </button>
                            <button class="btn btn-sm btn-danger ms-2" onclick="deleteAICategory(${cat.id})">
                                Usu≈Ñ
                            </button>
                        </div>
                    </div>
                `;

                categoriesList.appendChild(categoryItem);
            });
        } catch (error) {
            console.error('Error loading AI categories:', error);
        }
    }

    window.toggleAICategory = async function(categoryId, enabled) {
        try {
            const response = await fetch(`/api/host/ai/category/${categoryId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ is_enabled: enabled })
            });

            if (!response.ok) throw new Error('B≈ÇƒÖd aktualizacji kategorii');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            loadAICategories();
        }
    };

    window.deleteAICategory = async function(categoryId) {
        if (!confirm('Czy na pewno chcesz usunƒÖƒá tƒô kategoriƒô wraz z pytaniami?')) return;

        try {
            const response = await fetch(`/api/host/ai/category/${categoryId}`, {
                method: 'DELETE'
            });

            if (!response.ok) throw new Error('B≈ÇƒÖd usuwania kategorii');

            loadAICategories();
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    window.generateQuestionsForCategory = async function(categoryId, categoryName) {
        const count = prompt(`Ile pyta≈Ñ wygenerowaƒá dla kategorii "${categoryName}"?`, '10');
        if (!count) return;

        const btn = event.target;
        btn.disabled = true;
        btn.textContent = 'Generowanie...';

        try {
            const response = await fetch(`/api/host/ai/generate_questions/${categoryId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ count: parseInt(count) })
            });

            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.error || 'B≈ÇƒÖd generowania pyta≈Ñ');
            }

            alert(result.message);
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        } finally {
            btn.disabled = false;
            btn.textContent = 'Generuj pytania';
        }
    };

    // Edycja pyta≈Ñ AI dla kategorii
    window.editCategoryQuestions = async function(categoryId, categoryName) {
        try {
            const response = await fetch(`/api/host/ai/questions/${categoryId}`);
            const questions = await response.json();

            if (!response.ok) {
                throw new Error(questions.error || 'B≈ÇƒÖd pobierania pyta≈Ñ');
            }

            // Ustaw nazwƒô kategorii w modalu
            document.getElementById('ai-category-name').textContent = categoryName;

            // Renderuj listƒô pyta≈Ñ
            const questionsList = document.getElementById('ai-questions-list');
            if (questions.length === 0) {
                questionsList.innerHTML = '<p class="text-muted">Brak pyta≈Ñ w tej kategorii. U≈ºyj przycisku "Generuj pytania" aby dodaƒá pytania.</p>';
            } else {
                questionsList.innerHTML = questions.map((q, index) => `
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="mb-0">Pytanie ${index + 1}</h6>
                                <div>
                                    <span class="badge bg-${q.source === 'generated' ? 'success' : 'warning'}">${q.source === 'generated' ? 'Wygenerowane' : 'Edytowane'}</span>
                                    <span class="badge bg-info ms-1">Wy≈õwietlone: ${q.times_shown}</span>
                                    <span class="badge bg-primary ms-1">Poprawne: ${q.times_correct}</span>
                                </div>
                            </div>
                            <p class="mb-2"><strong>Tre≈õƒá:</strong> ${q.text}</p>
                            <p class="mb-1"><strong>Odpowiedzi:</strong></p>
                            <ul class="mb-2">
                                <li>A) ${q.option_a} ${q.correct_answer === 'A' ? '<span class="badge bg-success">Poprawna</span>' : ''}</li>
                                <li>B) ${q.option_b} ${q.correct_answer === 'B' ? '<span class="badge bg-success">Poprawna</span>' : ''}</li>
                                <li>C) ${q.option_c} ${q.correct_answer === 'C' ? '<span class="badge bg-success">Poprawna</span>' : ''}</li>
                            </ul>
                            <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-primary" onclick="openEditQuestionModal(${q.id}, ${categoryId})">
                                    Edytuj
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteAIQuestion(${q.id}, ${categoryId}, '${categoryName}')">
                                    Usu≈Ñ
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            // Poka≈º modal
            const modal = new bootstrap.Modal(document.getElementById('aiQuestionsModal'));
            modal.show();
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    window.openEditQuestionModal = async function(questionId, categoryId) {
        try {
            const response = await fetch(`/api/host/ai/questions/${categoryId}`);
            const questions = await response.json();

            if (!response.ok) {
                throw new Error('B≈ÇƒÖd pobierania pytania');
            }

            const question = questions.find(q => q.id === questionId);
            if (!question) {
                throw new Error('Nie znaleziono pytania');
            }

            // Wype≈Çnij formularz edycji
            document.getElementById('edit-question-id').value = question.id;
            document.getElementById('edit-question-text').value = question.text;
            document.getElementById('edit-answer-a').value = question.option_a;
            document.getElementById('edit-answer-b').value = question.option_b;
            document.getElementById('edit-answer-c').value = question.option_c;

            // Ustaw poprawnƒÖ odpowied≈∫
            document.getElementById(`edit-correct-${question.correct_answer.toLowerCase()}`).checked = true;

            // Zapisz categoryId w przycisku zapisu
            document.getElementById('save-ai-question-btn').setAttribute('data-category-id', categoryId);

            // Poka≈º modal edycji
            const modal = new bootstrap.Modal(document.getElementById('editAIQuestionModal'));
            modal.show();
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    document.getElementById('save-ai-question-btn')?.addEventListener('click', async () => {
        const questionId = document.getElementById('edit-question-id').value;
        const categoryId = document.getElementById('save-ai-question-btn').getAttribute('data-category-id');
        const text = document.getElementById('edit-question-text').value.trim();
        const optionA = document.getElementById('edit-answer-a').value.trim();
        const optionB = document.getElementById('edit-answer-b').value.trim();
        const optionC = document.getElementById('edit-answer-c').value.trim();
        const correctAnswer = document.querySelector('input[name="edit-correct-answer"]:checked')?.value;

        if (!text || !optionA || !optionB || !optionC || !correctAnswer) {
            alert('Wype≈Çnij wszystkie pola i wybierz poprawnƒÖ odpowied≈∫');
            return;
        }

        try {
            const response = await fetch(`/api/host/ai/question/${questionId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    text: text,
                    option_a: optionA,
                    option_b: optionB,
                    option_c: optionC,
                    correct_answer: correctAnswer
                })
            });

            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.error || 'B≈ÇƒÖd aktualizacji pytania');
            }

            // Zamknij modal edycji
            const editModal = bootstrap.Modal.getInstance(document.getElementById('editAIQuestionModal'));
            editModal.hide();

            // Od≈õwie≈º listƒô pyta≈Ñ
            const categoryName = document.getElementById('ai-category-name').textContent;
            await editCategoryQuestions(categoryId, categoryName);

            alert('Pytanie zosta≈Ço zaktualizowane');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    });

    window.deleteAIQuestion = async function(questionId, categoryId, categoryName) {
        if (!confirm('Czy na pewno chcesz usunƒÖƒá to pytanie?')) return;

        try {
            const response = await fetch(`/api/host/ai/question/${questionId}`, {
                method: 'DELETE'
            });

            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.error || 'B≈ÇƒÖd usuwania pytania');
            }

            // Od≈õwie≈º listƒô pyta≈Ñ
            await editCategoryQuestions(categoryId, categoryName);

            alert('Pytanie zosta≈Ço usuniƒôte');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    document.getElementById('add-custom-category-btn')?.addEventListener('click', async () => {
        const nameInput = document.getElementById('custom-category-name');
        const difficultySelect = document.getElementById('custom-category-difficulty');

        const name = nameInput.value.trim();
        const difficulty = difficultySelect.value;

        if (!name) {
            alert('Podaj nazwƒô kategorii');
            return;
        }

        try {
            const response = await fetch('/api/host/ai/categories', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name: name,
                    difficulty_level: difficulty
                })
            });

            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.error || 'B≈ÇƒÖd dodawania kategorii');
            }

            nameInput.value = '';
            difficultySelect.value = 'easy';
            loadAICategories();
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    });

    document.querySelector('button[data-bs-target="#ai"]')?.addEventListener('click', loadAICategories);

    // ============ AR FUNKCJE ============

    let arObjectsCounter = 0;

    window.addNewARObject = function() {
        arObjectsCounter++;
        const container = document.getElementById('ar-objects-container');
        const objectDiv = document.createElement('div');
        objectDiv.className = 'col-md-6';
        objectDiv.id = `ar-object-${arObjectsCounter}`;
        objectDiv.innerHTML = `
            <div class="card">
                <div class="card-body">
                    <h6>Obiekt AR #${arObjectsCounter}</h6>
                    <div id="ar-preview-${arObjectsCounter}" class="mb-3 text-center" style="min-height: 200px; background: #f8f9fa; border-radius: 8px; overflow: hidden;">
                        <span class="text-muted" style="line-height: 200px;">Brak zdjƒôcia</span>
                    </div>
                    <input type="text" class="form-control mb-2" id="ar-name-${arObjectsCounter}" placeholder="Nazwa obiektu (np. Butelka)">
                    <select class="form-select mb-2" id="ar-game-${arObjectsCounter}">
                        <option value="questions_easy">‚ùì Pytania (≈Çatwe)</option>
                        <option value="questions_medium">‚ùì Pytania (≈õrednie)</option>
                        <option value="questions_hard">‚ùì Pytania (trudne)</option>
                        <option value="questions_mixed">‚ùì Pytania (mieszane)</option>
                        <option value="questions_round2_easy">‚ùì Pytania runda 2 (≈Çatwe)</option>
                        <option value="questions_round2_medium">‚ùì Pytania runda 2 (≈õrednie)</option>
                        <option value="questions_round2_hard">‚ùì Pytania runda 2 (trudne)</option>
                        <option value="questions_round2_mixed">‚ùì Pytania runda 2 (mieszane)</option>
                        <option value="questions_round3_easy">‚ùì Pytania runda 3 (≈Çatwe)</option>
                        <option value="questions_round3_medium">‚ùì Pytania runda 3 (≈õrednie)</option>
                        <option value="questions_round3_hard">‚ùì Pytania runda 3 (trudne)</option>
                        <option value="questions_round3_mixed">‚ùì Pytania runda 3 (mieszane)</option>
                        <option value="ai_easy">ü§ñ AI (pytania ≈Çatwe)</option>
                        <option value="ai_medium">ü§ñ AI (pytania ≈õrednie)</option>
                        <option value="ai_hard">ü§ñ AI (pytania trudne)</option>
                        <option value="ai_mixed">ü§ñ AI (pytania mieszane)</option>
                        <option value="fortune">üîÆ Wr√≥≈ºka AI</option>
                        <option value="minigames">üéÆ Minigry</option>
                        <option value="photo">üì∏ Foto</option>
                        <option value="voting">üó≥Ô∏è G≈Çosowanie</option>
                        <option value="live">üì° Na ≈ºywo</option>
                    </select>
                    <button class="btn btn-primary w-100 mb-2" onclick="captureARObject(${arObjectsCounter})">
                        üì∏ Zr√≥b zdjƒôcie obiektu
                    </button>
                    <button class="btn btn-danger w-100" onclick="removeARObject(${arObjectsCounter})">
                        üóëÔ∏è Usu≈Ñ
                    </button>
                </div>
            </div>
        `;
        container.appendChild(objectDiv);
    };

    window.removeARObject = function(objectId) {
        const objectDiv = document.getElementById(`ar-object-${objectId}`);
        if (objectDiv) {
            objectDiv.remove();
        }
    };

    window.captureARObject = async function(objectId) {
        const nameInput = document.getElementById(`ar-name-${objectId}`);
        const gameSelect = document.getElementById(`ar-game-${objectId}`);
        const previewDiv = document.getElementById(`ar-preview-${objectId}`);

        const objectName = nameInput.value.trim();
        if (!objectName) {
            alert('Podaj nazwƒô obiektu!');
            return;
        }

        try {
            // Otw√≥rz kamerƒô
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: 'environment' }
            });

            // Utw√≥rz video element
            const video = document.createElement('video');
            video.srcObject = stream;
            video.autoplay = true;
            video.style.width = '100%';

            // Poka≈º podglƒÖd kamery
            previewDiv.innerHTML = '';
            previewDiv.appendChild(video);

            // Dodaj przycisk do zrobienia zdjƒôcia
            const captureBtn = document.createElement('button');
            captureBtn.className = 'btn btn-success mt-2';
            captureBtn.textContent = 'üì∏ Zr√≥b zdjƒôcie';
            captureBtn.onclick = async function() {
                // Zr√≥b zdjƒôcie
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0);

                // Konwertuj na base64
                const imageData = canvas.toDataURL('image/jpeg', 0.8);

                // Zatrzymaj kamerƒô
                stream.getTracks().forEach(track => track.stop());

                // Poka≈º zdjƒôcie
                const img = document.createElement('img');
                img.src = imageData;
                img.style.width = '100%';
                previewDiv.innerHTML = '';
                previewDiv.appendChild(img);

                // Wy≈õlij do backendu
                const response = await fetch('/api/host/ar/setup-object', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        object_name: objectName,
                        image_data: imageData,
                        game_type: gameSelect.value
                    })
                });

                const result = await response.json();
                if (response.ok) {
                    alert('‚úÖ Obiekt AR zapisany!');
                } else {
                    alert('‚ùå B≈ÇƒÖd: ' + result.error);
                }
            };

            previewDiv.appendChild(captureBtn);

            // Dodaj przycisk do anulowania
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'btn btn-secondary mt-2 ms-2';
            cancelBtn.textContent = 'Anuluj';
            cancelBtn.onclick = function() {
                stream.getTracks().forEach(track => track.stop());
                previewDiv.innerHTML = '<span class="text-muted" style="line-height: 200px;">Brak zdjƒôcia</span>';
            };
            previewDiv.appendChild(cancelBtn);

        } catch (error) {
            alert('B≈ÇƒÖd dostƒôpu do kamery: ' + error.message);
        }
    };

    // Za≈Çaduj istniejƒÖce obiekty AR przy otwieraniu zak≈Çadki
    document.querySelector('button[data-bs-target="#ar"]')?.addEventListener('click', async () => {
        try {
            const response = await fetch('/api/host/ar/objects');
            const result = await response.json();

            const container = document.getElementById('ar-objects-container');
            container.innerHTML = '';

            if (result.objects && result.objects.length > 0) {
                result.objects.forEach((obj, index) => {
                    arObjectsCounter++;
                    const objectDiv = document.createElement('div');
                    objectDiv.className = 'col-md-6';
                    objectDiv.id = `ar-object-${arObjectsCounter}`;
                    objectDiv.innerHTML = `
                        <div class="card">
                            <div class="card-body">
                                <h6>${obj.object_name}</h6>
                                <div class="mb-3 text-center" style="min-height: 200px; background: #f8f9fa; border-radius: 8px; overflow: hidden;">
                                    <img src="${obj.image_data}" style="width: 100%; max-height: 200px; object-fit: contain;">
                                </div>
                                <p class="mb-2"><strong>Gra:</strong> ${obj.game_type}</p>

                                <!-- Czu≈Ço≈õƒá -->
                                <div class="mb-3">
                                    <label class="form-label"><strong>Czu≈Ço≈õƒá:</strong></label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="sensitivity-${obj.id}"
                                               value="${obj.sensitivity || 50}" min="5" max="500" step="5">
                                        <button class="btn btn-primary" onclick="updateARSensitivity(${obj.id})">OK</button>
                                    </div>
                                    <small class="text-muted">Zakres: 5-500 (domy≈õlnie: 50)</small>
                                </div>

                                <!-- Interwa≈Ç skanowania -->
                                <div class="mb-3">
                                    <label class="form-label"><strong>Interwa≈Ç skanowania:</strong></label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="interval-${obj.id}"
                                               value="${obj.scan_interval || 2}" min="1" max="10" step="1">
                                        <button class="btn btn-primary" onclick="updateARInterval(${obj.id})">OK</button>
                                    </div>
                                    <small class="text-muted">Zakres: 1-10 sekund (domy≈õlnie: 2)</small>
                                </div>

                                <button class="btn btn-danger w-100" onclick="deleteARObject(${obj.id})">
                                    üóëÔ∏è Usu≈Ñ
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(objectDiv);
                });
            }
        } catch (error) {
            console.error('B≈ÇƒÖd ≈Çadowania obiekt√≥w AR:', error);
        }
    });

    window.deleteARObject = async function(objectId) {
        if (!confirm('Czy na pewno chcesz usunƒÖƒá ten obiekt AR?')) return;

        try {
            const response = await fetch(`/api/host/ar/object/${objectId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                // Od≈õwie≈º listƒô
                document.querySelector('button[data-bs-target="#ar"]').click();
            } else {
                alert('B≈ÇƒÖd usuwania obiektu');
            }
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    window.updateARSensitivity = async function(objectId) {
        const inputElement = document.getElementById(`sensitivity-${objectId}`);
        const sensitivity = parseInt(inputElement.value);

        // Walidacja
        if (isNaN(sensitivity) || sensitivity < 5 || sensitivity > 500) {
            alert('Czu≈Ço≈õƒá musi byƒá w zakresie 5-500');
            return;
        }

        try {
            const response = await fetch(`/api/host/ar/object/${objectId}/sensitivity`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ sensitivity })
            });

            const data = await response.json();

            if (response.ok) {
                alert(data.message);
            } else {
                alert('B≈ÇƒÖd: ' + (data.error || 'Nie uda≈Ço siƒô zaktualizowaƒá czu≈Ço≈õci'));
            }
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    window.updateARInterval = async function(objectId) {
        const inputElement = document.getElementById(`interval-${objectId}`);
        const scan_interval = parseInt(inputElement.value);

        // Walidacja
        if (isNaN(scan_interval) || scan_interval < 1 || scan_interval > 10) {
            alert('Interwa≈Ç skanowania musi byƒá w zakresie 1-10 sekund');
            return;
        }

        try {
            const response = await fetch(`/api/host/ar/object/${objectId}/interval`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ scan_interval })
            });

            const data = await response.json();

            if (response.ok) {
                alert(data.message);
            } else {
                alert('B≈ÇƒÖd: ' + (data.error || 'Nie uda≈Ço siƒô zaktualizowaƒá interwa≈Çu'));
            }
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    // =====================================================================
    // TRYB TESTOWY MINIGIER
    // =====================================================================

    // Tetris Test Mode
    document.getElementById('tetris-test-btn')?.addEventListener('click', () => {
        document.getElementById('tetris-test-view').style.display = 'block';
    });

    document.getElementById('tetris-test-start-btn')?.addEventListener('click', () => {
        const tetrisGame = new TetrisGame('tetris-test-canvas', 0, 0, 0);
        tetrisGame.start();

        document.getElementById('tetris-test-start-section').style.display = 'none';
        document.getElementById('tetris-test-left-controls').style.display = 'block';
        document.getElementById('tetris-test-right-controls').style.display = 'block';
        document.getElementById('tetris-test-exit-btn').style.display = 'block';
    });

    document.getElementById('tetris-test-close-btn')?.addEventListener('click', () => {
        document.getElementById('tetris-test-view').style.display = 'none';
        document.getElementById('tetris-test-start-section').style.display = 'block';
        document.getElementById('tetris-test-left-controls').style.display = 'none';
        document.getElementById('tetris-test-right-controls').style.display = 'none';
        document.getElementById('tetris-test-exit-btn').style.display = 'none';
    });

    document.getElementById('tetris-test-exit-btn')?.addEventListener('click', () => {
        if (confirm('Czy na pewno chcesz zako≈Ñczyƒá test?')) {
            document.getElementById('tetris-test-view').style.display = 'none';
            document.getElementById('tetris-test-start-section').style.display = 'block';
            document.getElementById('tetris-test-left-controls').style.display = 'none';
            document.getElementById('tetris-test-right-controls').style.display = 'none';
            document.getElementById('tetris-test-exit-btn').style.display = 'none';
        }
    });

    // Arkanoid Test Mode
    document.getElementById('arkanoid-test-btn')?.addEventListener('click', () => {
        document.getElementById('arkanoid-test-view').style.display = 'block';
    });

    document.getElementById('arkanoid-test-start-btn')?.addEventListener('click', () => {
        const arkanoidGame = new ArkanoidGame('arkanoid-test-canvas', 0, 0, 0);
        arkanoidGame.start();

        document.getElementById('arkanoid-test-start-section').style.display = 'none';
        document.getElementById('arkanoid-test-left-controls').style.display = 'block';
        document.getElementById('arkanoid-test-right-controls').style.display = 'block';
        document.getElementById('arkanoid-test-exit-btn').style.display = 'block';
    });

    document.getElementById('arkanoid-test-close-btn')?.addEventListener('click', () => {
        document.getElementById('arkanoid-test-view').style.display = 'none';
        document.getElementById('arkanoid-test-start-section').style.display = 'block';
        document.getElementById('arkanoid-test-left-controls').style.display = 'none';
        document.getElementById('arkanoid-test-right-controls').style.display = 'none';
        document.getElementById('arkanoid-test-exit-btn').style.display = 'none';
    });

    document.getElementById('arkanoid-test-exit-btn')?.addEventListener('click', () => {
        if (confirm('Czy na pewno chcesz zako≈Ñczyƒá test?')) {
            document.getElementById('arkanoid-test-view').style.display = 'none';
            document.getElementById('arkanoid-test-start-section').style.display = 'block';
            document.getElementById('arkanoid-test-left-controls').style.display = 'none';
            document.getElementById('arkanoid-test-right-controls').style.display = 'none';
            document.getElementById('arkanoid-test-exit-btn').style.display = 'none';
        }
    });

    // Snake Test Mode
    document.getElementById('snake-test-btn')?.addEventListener('click', () => {
        document.getElementById('snake-test-view').style.display = 'block';
    });

    document.getElementById('snake-test-start-btn')?.addEventListener('click', () => {
        const snakeGame = new SnakeGame('snake-test-canvas', 0, 0, 0);
        snakeGame.start();

        document.getElementById('snake-test-start-section').style.display = 'none';
        document.getElementById('snake-test-left-controls').style.display = 'block';
        document.getElementById('snake-test-right-controls').style.display = 'block';
        document.getElementById('snake-test-exit-btn').style.display = 'block';
    });

    document.getElementById('snake-test-close-btn')?.addEventListener('click', () => {
        document.getElementById('snake-test-view').style.display = 'none';
        document.getElementById('snake-test-start-section').style.display = 'block';
        document.getElementById('snake-test-left-controls').style.display = 'none';
        document.getElementById('snake-test-right-controls').style.display = 'none';
        document.getElementById('snake-test-exit-btn').style.display = 'none';
    });

    document.getElementById('snake-test-exit-btn')?.addEventListener('click', () => {
        if (confirm('Czy na pewno chcesz zako≈Ñczyƒá test?')) {
            document.getElementById('snake-test-view').style.display = 'none';
            document.getElementById('snake-test-start-section').style.display = 'block';
            document.getElementById('snake-test-left-controls').style.display = 'none';
            document.getElementById('snake-test-right-controls').style.display = 'none';
            document.getElementById('snake-test-exit-btn').style.display = 'none';
        }
    });

    // T-Rex Test Mode
    document.getElementById('trex-test-btn')?.addEventListener('click', () => {
        document.getElementById('trex-test-view').style.display = 'block';
    });

    document.getElementById('trex-test-start-btn')?.addEventListener('click', () => {
        const trexGame = new TRexGame('trex-test-canvas', 0, 0, 0);
        trexGame.start();

        document.getElementById('trex-test-start-section').style.display = 'none';
        document.getElementById('trex-test-jump-control').style.display = 'block';
        document.getElementById('trex-test-exit-btn').style.display = 'block';
    });

    document.getElementById('trex-test-close-btn')?.addEventListener('click', () => {
        document.getElementById('trex-test-view').style.display = 'none';
        document.getElementById('trex-test-start-section').style.display = 'block';
        document.getElementById('trex-test-jump-control').style.display = 'none';
        document.getElementById('trex-test-exit-btn').style.display = 'none';
    });

    document.getElementById('trex-test-exit-btn')?.addEventListener('click', () => {
        if (confirm('Czy na pewno chcesz zako≈Ñczyƒá test?')) {
            document.getElementById('trex-test-view').style.display = 'none';
            document.getElementById('trex-test-start-section').style.display = 'block';
            document.getElementById('trex-test-jump-control').style.display = 'none';
            document.getElementById('trex-test-exit-btn').style.display = 'none';
        }
    });

    // Wr√≥≈ºka AI - prze≈ÇƒÖcznik
    document.getElementById('fortune-enabled')?.addEventListener('change', async (e) => {
        const enabled = e.target.checked;
        const statusEl = document.getElementById('fortune-status');
        try {
            const response = await fetch('/api/host/fortune/toggle', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enabled })
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error);
            statusEl.textContent = enabled ? 'Aktywna' : 'Nieaktywna';
            statusEl.className = enabled ? 'badge bg-success' : 'badge bg-secondary';
            alert(result.message);
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            e.target.checked = !enabled;
        }
    });

    // PodglƒÖd QR
    document.getElementById('fortune-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/fortune_qr/${eventId}`, '_blank');
    });

    // Generuj zapasowy kod QR
    document.getElementById('fortune-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('fortune-generate-backup-qr-btn');
        const backupBtn = document.getElementById('fortune-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/fortune/generate_backup_qr/${eventId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            // W≈ÇƒÖcz przycisk podglƒÖdu zapasowego kodu
            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR
    document.getElementById('fortune-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/fortune_qr/${eventId}?backup=true`, '_blank');
    });

    // ===================================================
    // KODY QR DLA PYTA≈É
    // ===================================================

    // PodglƒÖd QR Pytania
    document.getElementById('questions-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_qr/${eventId}?difficulty=easy`, '_blank');
    });

    // Generuj zapasowy kod QR dla ≈Çatwych Pyta≈Ñ
    document.getElementById('questions-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('questions-generate-backup-qr-btn');
        const backupBtn = document.getElementById('questions-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/questions/generate_backup_qr/${eventId}?difficulty=easy`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            // W≈ÇƒÖcz przycisk podglƒÖdu zapasowego kodu
            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla ≈Çatwych pyta≈Ñ zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla ≈Çatwych Pyta≈Ñ
    document.getElementById('questions-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_qr/${eventId}?backup=true&difficulty=easy`, '_blank');
    });

    // PodglƒÖd g≈Ç√≥wnego QR dla ≈õrednich Pyta≈Ñ
    document.getElementById('questions-medium-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_qr/${eventId}?difficulty=medium`, '_blank');
    });

    // Generuj zapasowy kod QR dla ≈õrednich Pyta≈Ñ
    document.getElementById('questions-medium-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('questions-medium-generate-backup-qr-btn');
        const backupBtn = document.getElementById('questions-medium-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/questions/generate_backup_qr/${eventId}?difficulty=medium`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            // W≈ÇƒÖcz przycisk podglƒÖdu zapasowego kodu
            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla ≈õrednich pyta≈Ñ zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla ≈õrednich Pyta≈Ñ
    document.getElementById('questions-medium-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_qr/${eventId}?backup=true&difficulty=medium`, '_blank');
    });

    // PodglƒÖd g≈Ç√≥wnego QR dla trudnych Pyta≈Ñ
    document.getElementById('questions-hard-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_qr/${eventId}?difficulty=hard`, '_blank');
    });

    // Generuj zapasowy kod QR dla trudnych Pyta≈Ñ
    document.getElementById('questions-hard-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('questions-hard-generate-backup-qr-btn');
        const backupBtn = document.getElementById('questions-hard-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/questions/generate_backup_qr/${eventId}?difficulty=hard`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            // W≈ÇƒÖcz przycisk podglƒÖdu zapasowego kodu
            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla trudnych pyta≈Ñ zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla trudnych Pyta≈Ñ
    document.getElementById('questions-hard-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_qr/${eventId}?backup=true&difficulty=hard`, '_blank');
    });

    // PodglƒÖd g≈Ç√≥wnego QR dla mieszanych Pyta≈Ñ
    document.getElementById('questions-mixed-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_qr/${eventId}?difficulty=mixed`, '_blank');
    });

    // Generuj zapasowy kod QR dla mieszanych Pyta≈Ñ
    document.getElementById('questions-mixed-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('questions-mixed-generate-backup-qr-btn');
        const backupBtn = document.getElementById('questions-mixed-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/questions/generate_backup_qr/${eventId}?difficulty=mixed`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            // W≈ÇƒÖcz przycisk podglƒÖdu zapasowego kodu
            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla mieszanych pyta≈Ñ zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla mieszanych Pyta≈Ñ
    document.getElementById('questions-mixed-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_qr/${eventId}?backup=true&difficulty=mixed`, '_blank');
    });

    // ===================================================
    // KODY QR DLA PYTA≈É RUNDA 2
    // ===================================================

    // Funkcja prze≈ÇƒÖczania QR z rundy 1 dla rundy 2
    function toggleR2Round1QR() {
        const useRound1QR = document.getElementById('r2-use-round1-qr').checked;
        const disableOtherRoundsCheckbox = document.getElementById('r2-disable-other-rounds');

        // W≈ÇƒÖcz/wy≈ÇƒÖcz prze≈ÇƒÖcznik "Wy≈ÇƒÖcz pytania z innych rund"
        if (useRound1QR) {
            disableOtherRoundsCheckbox.disabled = false;
        } else {
            disableOtherRoundsCheckbox.disabled = true;
            disableOtherRoundsCheckbox.checked = false;
        }

        // Przyciski generowania zapasowych kod√≥w
        const generateButtons = [
            'r2-questions-generate-backup-qr-btn',
            'r2-questions-medium-generate-backup-qr-btn',
            'r2-questions-hard-generate-backup-qr-btn',
            'r2-questions-mixed-generate-backup-qr-btn'
        ];

        // Przyciski podglƒÖdu zapasowych kod√≥w
        const backupButtons = [
            'r2-questions-backup-qr-btn',
            'r2-questions-medium-backup-qr-btn',
            'r2-questions-hard-backup-qr-btn',
            'r2-questions-mixed-backup-qr-btn'
        ];

        if (useRound1QR) {
            // Wy≈ÇƒÖcz przyciski generowania i podglƒÖdu zapasowych kod√≥w
            generateButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.disabled = true;
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-secondary');
                }
            });

            backupButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.disabled = true;
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-secondary');
                }
            });
        } else {
            // W≈ÇƒÖcz przyciski generowania zapasowych kod√≥w
            generateButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.disabled = false;
                    btn.classList.remove('btn-secondary');
                    btn.classList.add('btn-success');
                }
            });

            // Przyciski podglƒÖdu zapasowych kod√≥w pozostajƒÖ wy≈ÇƒÖczone
            // (bƒôdƒÖ w≈ÇƒÖczone po wygenerowaniu zapasowego kodu)
        }
    }

    // Funkcja prze≈ÇƒÖczania "Wy≈ÇƒÖcz pytania z innych rund" dla rundy 2
    async function toggleR2DisableOtherRounds() {
        const eventId = {{ event.id }};
        const disableOtherRounds = document.getElementById('r2-disable-other-rounds').checked;

        try {
            const response = await fetch(`/api/host/questions_r2/disable_other_rounds/${eventId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ value: disableOtherRounds })
            });

            if (!response.ok) {
                throw new Error('B≈ÇƒÖd zapisywania ustawienia');
            }
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    }

    // PodglƒÖd g≈Ç√≥wnego QR dla ≈Çatwych pyta≈Ñ - Runda 2
    document.getElementById('r2-questions-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        const useRound1QR = document.getElementById('r2-use-round1-qr').checked;

        if (useRound1QR) {
            // U≈ºyj kodu QR z rundy 1
            window.open(`/questions_qr/${eventId}?difficulty=easy`, '_blank');
        } else {
            // U≈ºyj kodu QR z rundy 2
            window.open(`/questions_r2_qr/${eventId}?difficulty=easy`, '_blank');
        }
    });

    // Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ - Runda 2
    document.getElementById('r2-questions-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('r2-questions-generate-backup-qr-btn');
        const backupBtn = document.getElementById('r2-questions-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/questions_r2/generate_backup_qr/${eventId}?difficulty=easy`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla ≈Çatwych pyta≈Ñ (runda 2) zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla ≈Çatwych pyta≈Ñ - Runda 2
    document.getElementById('r2-questions-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_r2_qr/${eventId}?backup=true&difficulty=easy`, '_blank');
    });

    // PodglƒÖd g≈Ç√≥wnego QR dla ≈õrednich pyta≈Ñ - Runda 2
    document.getElementById('r2-questions-medium-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        const useRound1QR = document.getElementById('r2-use-round1-qr').checked;

        if (useRound1QR) {
            window.open(`/questions_qr/${eventId}?difficulty=medium`, '_blank');
        } else {
            window.open(`/questions_r2_qr/${eventId}?difficulty=medium`, '_blank');
        }
    });

    // Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ - Runda 2
    document.getElementById('r2-questions-medium-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('r2-questions-medium-generate-backup-qr-btn');
        const backupBtn = document.getElementById('r2-questions-medium-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/questions_r2/generate_backup_qr/${eventId}?difficulty=medium`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla ≈õrednich pyta≈Ñ (runda 2) zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla ≈õrednich pyta≈Ñ - Runda 2
    document.getElementById('r2-questions-medium-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_r2_qr/${eventId}?backup=true&difficulty=medium`, '_blank');
    });

    // PodglƒÖd g≈Ç√≥wnego QR dla trudnych pyta≈Ñ - Runda 2
    document.getElementById('r2-questions-hard-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        const useRound1QR = document.getElementById('r2-use-round1-qr').checked;

        if (useRound1QR) {
            window.open(`/questions_qr/${eventId}?difficulty=hard`, '_blank');
        } else {
            window.open(`/questions_r2_qr/${eventId}?difficulty=hard`, '_blank');
        }
    });

    // Generuj zapasowy kod QR dla trudnych pyta≈Ñ - Runda 2
    document.getElementById('r2-questions-hard-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('r2-questions-hard-generate-backup-qr-btn');
        const backupBtn = document.getElementById('r2-questions-hard-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/questions_r2/generate_backup_qr/${eventId}?difficulty=hard`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla trudnych pyta≈Ñ (runda 2) zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla trudnych pyta≈Ñ - Runda 2
    document.getElementById('r2-questions-hard-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_r2_qr/${eventId}?backup=true&difficulty=hard`, '_blank');
    });

    // PodglƒÖd g≈Ç√≥wnego QR dla mieszanych pyta≈Ñ - Runda 2
    document.getElementById('r2-questions-mixed-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        const useRound1QR = document.getElementById('r2-use-round1-qr').checked;

        if (useRound1QR) {
            window.open(`/questions_qr/${eventId}?difficulty=mixed`, '_blank');
        } else {
            window.open(`/questions_r2_qr/${eventId}?difficulty=mixed`, '_blank');
        }
    });

    // Generuj zapasowy kod QR dla mieszanych pyta≈Ñ - Runda 2
    document.getElementById('r2-questions-mixed-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('r2-questions-mixed-generate-backup-qr-btn');
        const backupBtn = document.getElementById('r2-questions-mixed-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/questions_r2/generate_backup_qr/${eventId}?difficulty=mixed`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla mieszanych pyta≈Ñ (runda 2) zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla mieszanych pyta≈Ñ - Runda 2
    document.getElementById('r2-questions-mixed-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_r2_qr/${eventId}?backup=true&difficulty=mixed`, '_blank');
    });

    // ===================================================
    // KODY QR DLA PYTA≈É RUNDA 3
    // ===================================================

    // Funkcja prze≈ÇƒÖczania QR z rundy 1 dla rundy 3
    function toggleR3Round1QR() {
        const useRound1QR = document.getElementById('r3-use-round1-qr').checked;
        const disableOtherRoundsCheckbox = document.getElementById('r3-disable-other-rounds');

        // W≈ÇƒÖcz/wy≈ÇƒÖcz prze≈ÇƒÖcznik "Wy≈ÇƒÖcz pytania z innych rund"
        if (useRound1QR) {
            disableOtherRoundsCheckbox.disabled = false;
        } else {
            disableOtherRoundsCheckbox.disabled = true;
            disableOtherRoundsCheckbox.checked = false;
        }

        // Przyciski generowania zapasowych kod√≥w
        const generateButtons = [
            'r3-questions-generate-backup-qr-btn',
            'r3-questions-medium-generate-backup-qr-btn',
            'r3-questions-hard-generate-backup-qr-btn',
            'r3-questions-mixed-generate-backup-qr-btn'
        ];

        // Przyciski podglƒÖdu zapasowych kod√≥w
        const backupButtons = [
            'r3-questions-backup-qr-btn',
            'r3-questions-medium-backup-qr-btn',
            'r3-questions-hard-backup-qr-btn',
            'r3-questions-mixed-backup-qr-btn'
        ];

        if (useRound1QR) {
            // Wy≈ÇƒÖcz przyciski generowania i podglƒÖdu zapasowych kod√≥w
            generateButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.disabled = true;
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-secondary');
                }
            });

            backupButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.disabled = true;
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-secondary');
                }
            });
        } else {
            // W≈ÇƒÖcz przyciski generowania zapasowych kod√≥w
            generateButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.disabled = false;
                    btn.classList.remove('btn-secondary');
                    btn.classList.add('btn-success');
                }
            });

            // Przyciski podglƒÖdu zapasowych kod√≥w pozostajƒÖ wy≈ÇƒÖczone
            // (bƒôdƒÖ w≈ÇƒÖczone po wygenerowaniu zapasowego kodu)
        }
    }

    // Funkcja prze≈ÇƒÖczania "Wy≈ÇƒÖcz pytania z innych rund" dla rundy 3
    async function toggleR3DisableOtherRounds() {
        const eventId = {{ event.id }};
        const disableOtherRounds = document.getElementById('r3-disable-other-rounds').checked;

        try {
            const response = await fetch(`/api/host/questions_r3/disable_other_rounds/${eventId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ value: disableOtherRounds })
            });

            if (!response.ok) {
                throw new Error('B≈ÇƒÖd zapisywania ustawienia');
            }
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    }

    // PodglƒÖd g≈Ç√≥wnego QR dla ≈Çatwych pyta≈Ñ - Runda 3
    document.getElementById('r3-questions-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        const useRound1QR = document.getElementById('r3-use-round1-qr').checked;

        if (useRound1QR) {
            window.open(`/questions_qr/${eventId}?difficulty=easy`, '_blank');
        } else {
            window.open(`/questions_r3_qr/${eventId}?difficulty=easy`, '_blank');
        }
    });

    // Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ - Runda 3
    document.getElementById('r3-questions-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('r3-questions-generate-backup-qr-btn');
        const backupBtn = document.getElementById('r3-questions-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/questions_r3/generate_backup_qr/${eventId}?difficulty=easy`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla ≈Çatwych pyta≈Ñ (runda 3) zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla ≈Çatwych pyta≈Ñ - Runda 3
    document.getElementById('r3-questions-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_r3_qr/${eventId}?backup=true&difficulty=easy`, '_blank');
    });

    // PodglƒÖd g≈Ç√≥wnego QR dla ≈õrednich pyta≈Ñ - Runda 3
    document.getElementById('r3-questions-medium-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        const useRound1QR = document.getElementById('r3-use-round1-qr').checked;

        if (useRound1QR) {
            window.open(`/questions_qr/${eventId}?difficulty=medium`, '_blank');
        } else {
            window.open(`/questions_r3_qr/${eventId}?difficulty=medium`, '_blank');
        }
    });

    // Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ - Runda 3
    document.getElementById('r3-questions-medium-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('r3-questions-medium-generate-backup-qr-btn');
        const backupBtn = document.getElementById('r3-questions-medium-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/questions_r3/generate_backup_qr/${eventId}?difficulty=medium`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla ≈õrednich pyta≈Ñ (runda 3) zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla ≈õrednich pyta≈Ñ - Runda 3
    document.getElementById('r3-questions-medium-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_r3_qr/${eventId}?backup=true&difficulty=medium`, '_blank');
    });

    // PodglƒÖd g≈Ç√≥wnego QR dla trudnych pyta≈Ñ - Runda 3
    document.getElementById('r3-questions-hard-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        const useRound1QR = document.getElementById('r3-use-round1-qr').checked;

        if (useRound1QR) {
            window.open(`/questions_qr/${eventId}?difficulty=hard`, '_blank');
        } else {
            window.open(`/questions_r3_qr/${eventId}?difficulty=hard`, '_blank');
        }
    });

    // Generuj zapasowy kod QR dla trudnych pyta≈Ñ - Runda 3
    document.getElementById('r3-questions-hard-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('r3-questions-hard-generate-backup-qr-btn');
        const backupBtn = document.getElementById('r3-questions-hard-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/questions_r3/generate_backup_qr/${eventId}?difficulty=hard`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla trudnych pyta≈Ñ (runda 3) zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla trudnych pyta≈Ñ - Runda 3
    document.getElementById('r3-questions-hard-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_r3_qr/${eventId}?backup=true&difficulty=hard`, '_blank');
    });

    // PodglƒÖd g≈Ç√≥wnego QR dla mieszanych pyta≈Ñ - Runda 3
    document.getElementById('r3-questions-mixed-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        const useRound1QR = document.getElementById('r3-use-round1-qr').checked;

        if (useRound1QR) {
            window.open(`/questions_qr/${eventId}?difficulty=mixed`, '_blank');
        } else {
            window.open(`/questions_r3_qr/${eventId}?difficulty=mixed`, '_blank');
        }
    });

    // Generuj zapasowy kod QR dla mieszanych pyta≈Ñ - Runda 3
    document.getElementById('r3-questions-mixed-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('r3-questions-mixed-generate-backup-qr-btn');
        const backupBtn = document.getElementById('r3-questions-mixed-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/questions_r3/generate_backup_qr/${eventId}?difficulty=mixed`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla mieszanych pyta≈Ñ (runda 3) zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla mieszanych pyta≈Ñ - Runda 3
    document.getElementById('r3-questions-mixed-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/questions_r3_qr/${eventId}?backup=true&difficulty=mixed`, '_blank');
    });

    // ===================================================
    // KODY QR DLA FOTO
    // ===================================================

    // PodglƒÖd QR Foto
    document.getElementById('photo-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/photo_qr/${eventId}`, '_blank');
    });

    // Generuj zapasowy kod QR dla Foto
    document.getElementById('photo-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('photo-generate-backup-qr-btn');
        const backupBtn = document.getElementById('photo-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/photo/generate_backup_qr/${eventId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            // W≈ÇƒÖcz przycisk podglƒÖdu zapasowego kodu
            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR Foto
    document.getElementById('photo-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/photo_qr/${eventId}?backup=true`, '_blank');
    });

    // ===================================================
    // KODY QR DLA MINIGRY
    // ===================================================

    // PodglƒÖd QR Minigry
    document.getElementById('minigames-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/minigames_qr/${eventId}`, '_blank');
    });

    // Generuj zapasowy kod QR dla Minigry
    document.getElementById('minigames-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('minigames-generate-backup-qr-btn');
        const backupBtn = document.getElementById('minigames-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/minigames/generate_backup_qr/${eventId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            // W≈ÇƒÖcz przycisk podglƒÖdu zapasowego kodu
            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR Minigry
    document.getElementById('minigames-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/minigames_qr/${eventId}?backup=true`, '_blank');
    });

    // ===================================================
    // KODY QR DLA AI
    // ===================================================

    // PodglƒÖd QR AI
    document.getElementById('ai-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/ai_qr/${eventId}?difficulty=easy`, '_blank');
    });

    // Generuj zapasowy kod QR dla ≈Çatwych AI
    document.getElementById('ai-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('ai-generate-backup-qr-btn');
        const backupBtn = document.getElementById('ai-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/ai/generate_backup_qr/${eventId}?difficulty=easy`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            // W≈ÇƒÖcz przycisk podglƒÖdu zapasowego kodu
            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla ≈Çatwych pyta≈Ñ AI zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla ≈Çatwych AI
    document.getElementById('ai-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/ai_qr/${eventId}?backup=true&difficulty=easy`, '_blank');
    });

    // PodglƒÖd g≈Ç√≥wnego QR dla ≈õrednich AI
    document.getElementById('ai-medium-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/ai_qr/${eventId}?difficulty=medium`, '_blank');
    });

    // Generuj zapasowy kod QR dla ≈õrednich AI
    document.getElementById('ai-medium-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('ai-medium-generate-backup-qr-btn');
        const backupBtn = document.getElementById('ai-medium-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/ai/generate_backup_qr/${eventId}?difficulty=medium`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            // W≈ÇƒÖcz przycisk podglƒÖdu zapasowego kodu
            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla ≈õrednich pyta≈Ñ AI zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla ≈õrednich AI
    document.getElementById('ai-medium-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/ai_qr/${eventId}?backup=true&difficulty=medium`, '_blank');
    });

    // PodglƒÖd g≈Ç√≥wnego QR dla trudnych AI
    document.getElementById('ai-hard-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/ai_qr/${eventId}?difficulty=hard`, '_blank');
    });

    // Generuj zapasowy kod QR dla trudnych AI
    document.getElementById('ai-hard-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('ai-hard-generate-backup-qr-btn');
        const backupBtn = document.getElementById('ai-hard-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/ai/generate_backup_qr/${eventId}?difficulty=hard`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            // W≈ÇƒÖcz przycisk podglƒÖdu zapasowego kodu
            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla trudnych pyta≈Ñ AI zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla trudnych AI
    document.getElementById('ai-hard-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/ai_qr/${eventId}?backup=true&difficulty=hard`, '_blank');
    });

    // PodglƒÖd g≈Ç√≥wnego QR dla mieszanych AI
    document.getElementById('ai-mixed-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/ai_qr/${eventId}?difficulty=mixed`, '_blank');
    });

    // Generuj zapasowy kod QR dla mieszanych AI
    document.getElementById('ai-mixed-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('ai-mixed-generate-backup-qr-btn');
        const backupBtn = document.getElementById('ai-mixed-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/ai/generate_backup_qr/${eventId}?difficulty=mixed`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await response.json();

            if (!response.ok) throw new Error(result.error || 'B≈ÇƒÖd generowania kodu QR');

            // W≈ÇƒÖcz przycisk podglƒÖdu zapasowego kodu
            backupBtn.disabled = false;
            backupBtn.classList.remove('btn-secondary');
            backupBtn.classList.add('btn-primary');

            generateBtn.textContent = '‚úÖ Wygenerowano';
            setTimeout(() => {
                generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ';
                generateBtn.disabled = false;
            }, 2000);

            alert('Zapasowy kod QR dla mieszanych pyta≈Ñ AI zosta≈Ç wygenerowany pomy≈õlnie!');
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ';
            generateBtn.disabled = false;
        }
    });

    // PodglƒÖd zapasowego QR dla mieszanych AI
    document.getElementById('ai-mixed-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/ai_qr/${eventId}?backup=true&difficulty=mixed`, '_blank');
    });

    // ===================================================
    // PRZE≈ÅƒÑCZNIKI STAN GRY
    // ===================================================

    // Pytania - prze≈ÇƒÖcznik
    document.getElementById('questions-enabled')?.addEventListener('change', async (e) => {
        const enabled = e.target.checked;
        const statusEl = document.getElementById('questions-status');
        try {
            const response = await fetch('/api/host/questions/toggle', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enabled })
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error);
            statusEl.textContent = enabled ? 'Aktywna' : 'Nieaktywna';
            statusEl.className = enabled ? 'badge bg-success' : 'badge bg-secondary';
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            e.target.checked = !enabled;
        }
    });

    // AI - prze≈ÇƒÖcznik
    document.getElementById('ai-enabled')?.addEventListener('change', async (e) => {
        const enabled = e.target.checked;
        const statusEl = document.getElementById('ai-status');
        try {
            const response = await fetch('/api/host/ai/toggle', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enabled })
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error);
            statusEl.textContent = enabled ? 'Aktywna' : 'Nieaktywna';
            statusEl.className = enabled ? 'badge bg-success' : 'badge bg-secondary';
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            e.target.checked = !enabled;
        }
    });

    // Minigry - prze≈ÇƒÖcznik
    document.getElementById('minigames-enabled')?.addEventListener('change', async (e) => {
        const enabled = e.target.checked;
        const statusEl = document.getElementById('minigames-status');
        try {
            const response = await fetch('/api/host/minigames/toggle', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enabled })
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error);
            statusEl.textContent = enabled ? 'Aktywna' : 'Nieaktywna';
            statusEl.className = enabled ? 'badge bg-success' : 'badge bg-secondary';
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            e.target.checked = !enabled;
        }
    });

    // Foto - prze≈ÇƒÖcznik
    document.getElementById('photo-enabled')?.addEventListener('change', async (e) => {
        const enabled = e.target.checked;
        const statusEl = document.getElementById('photo-status');
        try {
            const response = await fetch('/api/host/photo/toggle', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enabled })
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error);
            statusEl.textContent = enabled ? 'Aktywna' : 'Nieaktywna';
            statusEl.className = enabled ? 'badge bg-success' : 'badge bg-secondary';
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
            e.target.checked = !enabled;
        }
    });

    // G≈Çosowanie - prze≈ÇƒÖcznik
    document.getElementById('voting-enabled')?.addEventListener('change', async (e) => {
        const enabled = e.target.checked;
        const statusEl = document.getElementById('voting-status');
        statusEl.textContent = enabled ? 'Aktywna' : 'Nieaktywna';
        statusEl.className = enabled ? 'badge bg-success' : 'badge bg-secondary';
        // TODO: Dodaƒá endpoint API dla g≈Çosowania
        console.log('Voting enabled:', enabled);
    });

    // G≈Çosowanie - zarzƒÖdzanie pytaniami
    let votingQuestions = [];
    let votingEditingIndex = null;

    // Pokazywanie formularza
    document.getElementById('voting-add-question-btn')?.addEventListener('click', function() {
        document.getElementById('voting-question-form').style.display = 'block';
        document.getElementById('voting-add-question-btn').style.display = 'none';
        votingEditingIndex = null;
        votingResetForm();
    });

    // Anulowanie formularza
    document.getElementById('voting-cancel-question-btn')?.addEventListener('click', function() {
        document.getElementById('voting-question-form').style.display = 'none';
        document.getElementById('voting-add-question-btn').style.display = 'block';
        votingResetForm();
    });

    // Dodawanie nowego pola odpowiedzi
    document.getElementById('voting-add-answer-btn')?.addEventListener('click', function() {
        const container = document.getElementById('voting-answers-container');
        const currentCount = container.querySelectorAll('.voting-answer-item').length;

        if (currentCount >= 100) {
            alert('Maksymalna liczba odpowiedzi to 100');
            return;
        }

        const newIndex = currentCount + 1;
        const newAnswerItem = document.createElement('div');
        newAnswerItem.className = 'input-group mb-2 voting-answer-item';
        newAnswerItem.innerHTML = `
            <span class="input-group-text">${newIndex}</span>
            <input type="text" class="form-control voting-answer-input" placeholder="Odpowied≈∫ ${newIndex}">
            <button class="btn btn-danger voting-remove-answer-btn" type="button">√ó</button>
        `;

        container.appendChild(newAnswerItem);

        // Poka≈º przyciski usuwania je≈õli jest wiƒôcej ni≈º 2 odpowiedzi
        votingUpdateRemoveButtons();

        // Dodaj event listener do nowego przycisku usuwania
        newAnswerItem.querySelector('.voting-remove-answer-btn').addEventListener('click', function() {
            newAnswerItem.remove();
            votingUpdateAnswerNumbers();
            votingUpdateRemoveButtons();
        });
    });

    // Funkcja aktualizujƒÖca numeracjƒô odpowiedzi
    function votingUpdateAnswerNumbers() {
        const container = document.getElementById('voting-answers-container');
        const items = container.querySelectorAll('.voting-answer-item');
        items.forEach((item, index) => {
            item.querySelector('.input-group-text').textContent = index + 1;
            item.querySelector('.voting-answer-input').placeholder = `Odpowied≈∫ ${index + 1}`;
        });
    }

    // Funkcja pokazujƒÖca/ukrywajƒÖca przyciski usuwania
    function votingUpdateRemoveButtons() {
        const container = document.getElementById('voting-answers-container');
        const items = container.querySelectorAll('.voting-answer-item');
        const showButtons = items.length > 2;

        items.forEach(item => {
            const removeBtn = item.querySelector('.voting-remove-answer-btn');
            removeBtn.style.display = showButtons ? 'block' : 'none';
        });
    }

    // Dodaj event listenery do poczƒÖtkowych przycisk√≥w usuwania
    document.querySelectorAll('.voting-remove-answer-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const item = btn.closest('.voting-answer-item');
            item.remove();
            votingUpdateAnswerNumbers();
            votingUpdateRemoveButtons();
        });
    });

    // Zatwierdzanie pytania
    document.getElementById('voting-submit-question-btn')?.addEventListener('click', function() {
        const questionText = document.getElementById('voting-question-text').value.trim();

        if (!questionText) {
            alert('Proszƒô wpisaƒá pytanie');
            return;
        }

        // Pobierz odpowiedzi
        const answerInputs = document.querySelectorAll('.voting-answer-input');
        const answers = [];
        answerInputs.forEach(input => {
            const value = input.value.trim();
            if (value) {
                answers.push(value);
            }
        });

        if (answers.length < 2) {
            alert('Proszƒô dodaƒá przynajmniej 2 odpowiedzi');
            return;
        }

        // Pobierz typ wyboru
        const choiceType = document.querySelector('input[name="voting-choice-type"]:checked').value;

        // Pobierz czas
        const timeValue = parseInt(document.getElementById('voting-time-value').value);
        const timeUnit = document.getElementById('voting-time-unit').value;

        // Pobierz typ wyniku
        const resultType = document.querySelector('input[name="voting-result-type"]:checked').value;

        // Utw√≥rz obiekt pytania
        const question = {
            id: votingEditingIndex !== null ? votingQuestions[votingEditingIndex].id : Date.now(),
            question: questionText,
            answers: answers,
            choiceType: choiceType,
            timeValue: timeValue,
            timeUnit: timeUnit,
            resultType: resultType,
            status: 'inactive' // inactive, active, finished
        };

        // Dodaj lub zaktualizuj pytanie
        if (votingEditingIndex !== null) {
            votingQuestions[votingEditingIndex] = question;
            votingEditingIndex = null;
        } else {
            votingQuestions.push(question);
        }

        // Wy≈õwietl pytania
        votingDisplayQuestions();

        // Ukryj formularz
        document.getElementById('voting-question-form').style.display = 'none';
        document.getElementById('voting-add-question-btn').style.display = 'block';
        votingResetForm();
    });

    // Funkcja resetujƒÖca formularz
    function votingResetForm() {
        document.getElementById('voting-question-text').value = '';

        // Resetuj odpowiedzi do 2
        const container = document.getElementById('voting-answers-container');
        container.innerHTML = `
            <div class="input-group mb-2 voting-answer-item">
                <span class="input-group-text">1</span>
                <input type="text" class="form-control voting-answer-input" placeholder="Odpowied≈∫ 1">
                <button class="btn btn-danger voting-remove-answer-btn" type="button" style="display: none;">√ó</button>
            </div>
            <div class="input-group mb-2 voting-answer-item">
                <span class="input-group-text">2</span>
                <input type="text" class="form-control voting-answer-input" placeholder="Odpowied≈∫ 2">
                <button class="btn btn-danger voting-remove-answer-btn" type="button" style="display: none;">√ó</button>
            </div>
        `;

        // Dodaj event listenery do przycisk√≥w usuwania
        container.querySelectorAll('.voting-remove-answer-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const item = btn.closest('.voting-answer-item');
                item.remove();
                votingUpdateAnswerNumbers();
                votingUpdateRemoveButtons();
            });
        });

        // Resetuj opcje
        document.getElementById('voting-single-choice').checked = true;
        document.getElementById('voting-time-value').value = 60;
        document.getElementById('voting-time-unit').value = 'seconds';
        document.getElementById('voting-result-auto').checked = true;
    }

    // Funkcja wy≈õwietlajƒÖca pytania
    function votingDisplayQuestions() {
        const listContainer = document.getElementById('voting-questions-list');

        if (votingQuestions.length === 0) {
            listContainer.innerHTML = '<p class="text-muted">Brak dodanych pyta≈Ñ. Kliknij "Dodaj propozycjƒô" aby utworzyƒá pierwsze pytanie.</p>';
            return;
        }

        listContainer.innerHTML = votingQuestions.map((q, index) => {
            const timeDisplay = q.timeUnit === 'minutes' ? `${q.timeValue} min` : `${q.timeValue} sek`;
            const choiceDisplay = q.choiceType === 'single' ? 'Jeden wyb√≥r' : 'Wielokrotny';
            const resultDisplay = q.resultType === 'auto' ? 'Auto' : 'Manual';

            return `
                <div class="card mb-3" style="background: white;">
                    <div class="card-body">
                        <h6 class="card-title mb-3"><strong>Pytanie ${index + 1}:</strong> ${q.question}</h6>

                        <div class="mb-2">
                            <strong>Odpowiedzi:</strong>
                            <ol class="mb-2">
                                ${q.answers.map(a => `<li>${a}</li>`).join('')}
                            </ol>
                        </div>

                        <div class="mb-3">
                            <span class="badge bg-info me-2">${choiceDisplay}</span>
                            <span class="badge bg-secondary me-2">Czas: ${timeDisplay}</span>
                            <span class="badge bg-primary me-2">Wynik: ${resultDisplay}</span>
                            <span class="badge ${q.status === 'active' ? 'bg-success' : q.status === 'finished' ? 'bg-dark' : 'bg-warning'}">${
                                q.status === 'active' ? 'Aktywne' : q.status === 'finished' ? 'Zako≈Ñczone' : 'Nieaktywne'
                            }</span>
                        </div>

                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-success" onclick="votingStartQuestion(${index})" ${q.status === 'active' ? 'disabled' : ''}>
                                Start
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="votingStopQuestion(${index})" ${q.status !== 'active' ? 'disabled' : ''}>
                                Stop
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="votingResetQuestion(${index})">
                                Reset
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="votingEditQuestion(${index})" ${q.status === 'active' ? 'disabled' : ''}>
                                Edytuj
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="votingDeleteQuestion(${index})" ${q.status === 'active' ? 'disabled' : ''}>
                                Usu≈Ñ
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // Funkcje kontrolne dla pyta≈Ñ
    window.votingStartQuestion = function(index) {
        votingQuestions[index].status = 'active';
        votingDisplayQuestions();
        console.log('Started question:', votingQuestions[index]);
        // TODO: Wys≈Çaƒá do API
    };

    window.votingStopQuestion = function(index) {
        votingQuestions[index].status = 'finished';
        votingDisplayQuestions();
        console.log('Stopped question:', votingQuestions[index]);
        // TODO: Wys≈Çaƒá do API
    };

    window.votingResetQuestion = function(index) {
        votingQuestions[index].status = 'inactive';
        votingDisplayQuestions();
        console.log('Reset question:', votingQuestions[index]);
        // TODO: Wys≈Çaƒá do API
    };

    window.votingEditQuestion = function(index) {
        const question = votingQuestions[index];
        votingEditingIndex = index;

        // Wype≈Çnij formularz danymi pytania
        document.getElementById('voting-question-text').value = question.question;

        // Wype≈Çnij odpowiedzi
        const container = document.getElementById('voting-answers-container');
        container.innerHTML = '';

        question.answers.forEach((answer, i) => {
            const answerItem = document.createElement('div');
            answerItem.className = 'input-group mb-2 voting-answer-item';
            answerItem.innerHTML = `
                <span class="input-group-text">${i + 1}</span>
                <input type="text" class="form-control voting-answer-input" placeholder="Odpowied≈∫ ${i + 1}" value="${answer}">
                <button class="btn btn-danger voting-remove-answer-btn" type="button" ${question.answers.length <= 2 ? 'style="display: none;"' : ''}>√ó</button>
            `;
            container.appendChild(answerItem);

            answerItem.querySelector('.voting-remove-answer-btn').addEventListener('click', function() {
                answerItem.remove();
                votingUpdateAnswerNumbers();
                votingUpdateRemoveButtons();
            });
        });

        // Wype≈Çnij opcje
        if (question.choiceType === 'single') {
            document.getElementById('voting-single-choice').checked = true;
        } else {
            document.getElementById('voting-multiple-choice').checked = true;
        }

        document.getElementById('voting-time-value').value = question.timeValue;
        document.getElementById('voting-time-unit').value = question.timeUnit;

        if (question.resultType === 'auto') {
            document.getElementById('voting-result-auto').checked = true;
        } else {
            document.getElementById('voting-result-manual').checked = true;
        }

        // Poka≈º formularz
        document.getElementById('voting-question-form').style.display = 'block';
        document.getElementById('voting-add-question-btn').style.display = 'none';
    };

    window.votingDeleteQuestion = function(index) {
        if (confirm('Czy na pewno chcesz usunƒÖƒá to pytanie?')) {
            votingQuestions.splice(index, 1);
            votingDisplayQuestions();
            console.log('Deleted question at index:', index);
            // TODO: Wys≈Çaƒá do API
        }
    };

    // Inicjalizacja wy≈õwietlania pyta≈Ñ
    votingDisplayQuestions();

    // Na ≈ºywo - prze≈ÇƒÖcznik
    document.getElementById('live-enabled')?.addEventListener('change', async (e) => {
        const enabled = e.target.checked;
        const statusEl = document.getElementById('live-status');
        statusEl.textContent = enabled ? 'Aktywna' : 'Nieaktywna';
        statusEl.className = enabled ? 'badge bg-success' : 'badge bg-secondary';
        // TODO: Dodaƒá endpoint API dla funkcji na ≈ºywo
        console.log('Live enabled:', enabled);
    });

    // Aktualizacja ustawie≈Ñ
    window.updateFortuneSetting = async function(setting) {
        let value, endpoint;

        if (setting === 'word_count') {
            value = parseInt(document.getElementById('fortune-word-count').value);
            if (value < 10 || value > 500) {
                alert('Liczba s≈Ç√≥w musi byƒá w zakresie 10-500');
                return;
            }
            endpoint = '/api/host/fortune/word-count';
        } else if (setting === 'points') {
            value = parseInt(document.getElementById('fortune-points').value);
            if (value < 1 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 1-100');
                return;
            }
            endpoint = '/api/host/fortune/points';
        } else if (setting === 'player_words') {
            value = parseInt(document.getElementById('fortune-player-words').value);
            if (value < 1 || value > 10) {
                alert('Liczba s≈Ç√≥w gracza musi byƒá w zakresie 1-10');
                return;
            }
            endpoint = '/api/host/fortune/player-words';
        }

        try {
            const response = await fetch(endpoint, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ value })
            });
            const data = await response.json();
            if (response.ok) {
                alert(data.message);
            } else {
                alert('B≈ÇƒÖd: ' + data.error);
            }
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    // Funkcja do aktualizacji ustawie≈Ñ pyta≈Ñ
    window.updateQuestionsSetting = async function(setting) {
        let value, endpoint;
        const eventId = {{ event.id }};

        if (setting === 'easy_points') {
            value = parseInt(document.getElementById('questions-easy-points').value);
            if (value < 1 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 1-100');
                return;
            }
            endpoint = `/api/host/questions/easy-points/${eventId}`;
        } else if (setting === 'medium_points') {
            value = parseInt(document.getElementById('questions-medium-points').value);
            if (value < 1 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 1-100');
                return;
            }
            endpoint = `/api/host/questions/medium-points/${eventId}`;
        } else if (setting === 'hard_points') {
            value = parseInt(document.getElementById('questions-hard-points').value);
            if (value < 1 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 1-100');
                return;
            }
            endpoint = `/api/host/questions/hard-points/${eventId}`;
        }

        try {
            const response = await fetch(endpoint, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ value })
            });
            const data = await response.json();
            if (response.ok) {
                alert(data.message);
            } else {
                alert('B≈ÇƒÖd: ' + data.error);
            }
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    window.updateR2QuestionsSetting = async function(setting) {
        let value, endpoint;
        const eventId = {{ event.id }};

        if (setting === 'easy_points') {
            value = parseInt(document.getElementById('r2-questions-easy-points').value);
            if (value < 1 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 1-100');
                return;
            }
            endpoint = `/api/host/questions/easy-points/${eventId}?round=2`;
        } else if (setting === 'medium_points') {
            value = parseInt(document.getElementById('r2-questions-medium-points').value);
            if (value < 1 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 1-100');
                return;
            }
            endpoint = `/api/host/questions/medium-points/${eventId}?round=2`;
        } else if (setting === 'hard_points') {
            value = parseInt(document.getElementById('r2-questions-hard-points').value);
            if (value < 1 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 1-100');
                return;
            }
            endpoint = `/api/host/questions/hard-points/${eventId}?round=2`;
        }

        try {
            const response = await fetch(endpoint, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ value })
            });
            const data = await response.json();
            if (response.ok) {
                alert(data.message);
            } else {
                alert('B≈ÇƒÖd: ' + data.error);
            }
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    window.updateR3QuestionsSetting = async function(setting) {
        let value, endpoint;
        const eventId = {{ event.id }};

        if (setting === 'easy_points') {
            value = parseInt(document.getElementById('r3-questions-easy-points').value);
            if (value < 1 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 1-100');
                return;
            }
            endpoint = `/api/host/questions/easy-points/${eventId}?round=3`;
        } else if (setting === 'medium_points') {
            value = parseInt(document.getElementById('r3-questions-medium-points').value);
            if (value < 1 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 1-100');
                return;
            }
            endpoint = `/api/host/questions/medium-points/${eventId}?round=3`;
        } else if (setting === 'hard_points') {
            value = parseInt(document.getElementById('r3-questions-hard-points').value);
            if (value < 1 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 1-100');
                return;
            }
            endpoint = `/api/host/questions/hard-points/${eventId}?round=3`;
        }

        try {
            const response = await fetch(endpoint, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ value })
            });
            const data = await response.json();
            if (response.ok) {
                alert(data.message);
            } else {
                alert('B≈ÇƒÖd: ' + data.error);
            }
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    // Funkcja do aktualizacji ustawie≈Ñ AI
    window.updateAISetting = async function(setting) {
        let value, endpoint;
        const eventId = {{ event.id }};

        if (setting === 'easy_points') {
            value = parseInt(document.getElementById('ai-easy-points').value);
            if (value < 1 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 1-100');
                return;
            }
            endpoint = `/api/host/ai/easy-points/${eventId}`;
        } else if (setting === 'medium_points') {
            value = parseInt(document.getElementById('ai-medium-points').value);
            if (value < 1 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 1-100');
                return;
            }
            endpoint = `/api/host/ai/medium-points/${eventId}`;
        } else if (setting === 'hard_points') {
            value = parseInt(document.getElementById('ai-hard-points').value);
            if (value < 1 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 1-100');
                return;
            }
            endpoint = `/api/host/ai/hard-points/${eventId}`;
        }

        try {
            const response = await fetch(endpoint, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ value })
            });
            const data = await response.json();
            if (response.ok) {
                alert(data.message);
            } else {
                alert('B≈ÇƒÖd: ' + data.error);
            }
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    // Funkcja do aktualizacji ustawie≈Ñ Foto
    window.updatePhotoSetting = async function(setting) {
        let value, endpoint;
        const eventId = {{ event.id }};

        if (setting === 'selfie_points') {
            value = parseInt(document.getElementById('photo-selfie-points').value);
            if (value < 1 || value > 1000) {
                alert('Punkty muszƒÖ byƒá w zakresie 1-1000');
                return;
            }
            endpoint = `/api/host/photo/selfie-points/${eventId}`;
        } else if (setting === 'like_given_points') {
            value = parseInt(document.getElementById('photo-like-given-points').value);
            if (value < 0 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 0-100');
                return;
            }
            endpoint = `/api/host/photo/like-given-points/${eventId}`;
        } else if (setting === 'like_received_points') {
            value = parseInt(document.getElementById('photo-like-received-points').value);
            if (value < 0 || value > 100) {
                alert('Punkty muszƒÖ byƒá w zakresie 0-100');
                return;
            }
            endpoint = `/api/host/photo/like-received-points/${eventId}`;
        } else if (setting === 'max_likes') {
            value = parseInt(document.getElementById('photo-max-likes').value);
            if (value < 1 || value > 1000) {
                alert('Warto≈õƒá musi byƒá w zakresie 1-1000');
                return;
            }
            endpoint = `/api/host/photo/max-likes/${eventId}`;
        }

        try {
            const response = await fetch(endpoint, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ value })
            });
            const data = await response.json();
            if (response.ok) {
                alert(data.message);
            } else {
                alert('B≈ÇƒÖd: ' + data.error);
            }
        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    // Funkcja do ≈Çadowania galerii zdjƒôƒá w panelu hosta
    window.loadHostPhotoGallery = async function() {
        const eventId = {{ event.id }};
        try {
            const response = await fetch(`/api/photos/${eventId}`);
            const photos = await response.json();

            const gallery = document.getElementById('host-photo-gallery');
            const noPhotosMsg = document.getElementById('no-photos-message');

            if (photos.length === 0) {
                gallery.innerHTML = '';
                noPhotosMsg.style.display = 'block';
                return;
            }

            noPhotosMsg.style.display = 'none';
            gallery.innerHTML = photos.map(photo => `
                <div class="col-md-4 col-sm-6">
                    <div class="card">
                        <img src="${photo.image_url}" class="card-img-top" alt="Photo by ${photo.player_name}" style="height: 250px; object-fit: cover;">
                        <div class="card-body">
                            <h6 class="card-title">${photo.player_name}</h6>
                            <p class="card-text">
                                <span class="badge bg-primary">‚ù§Ô∏è ${photo.votes} polubie≈Ñ</span>
                            </p>
                            <small class="text-muted">${new Date(photo.timestamp).toLocaleString('pl-PL')}</small>
                        </div>
                    </div>
                </div>
            `).join('');
        } catch (error) {
            console.error('B≈ÇƒÖd ≈Çadowania galerii:', error);
        }
    };

    // ≈Åaduj galeriƒô przy otwieraniu zak≈Çadki Foto
    document.querySelector('button[data-bs-target="#photo"]').addEventListener('click', function() {
        setTimeout(() => loadHostPhotoGallery(), 100);
    });

    // Nas≈Çuchuj na nowe zdjƒôcia przez Socket.IO
    socket.on('new_photo', function(data) {
        console.log('New photo received:', data);
        // Prze≈Çaduj galeriƒô je≈õli jest otwarta zak≈Çadka Foto
        if (document.getElementById('photo').classList.contains('active')) {
            loadHostPhotoGallery();
        }
    });

    // ========================================
    // PRZYCISKI WY≈öWIETLACZA
    // ========================================

    // Otw√≥rz ekran gry 1
    document.getElementById('open-display-1-btn')?.addEventListener('click', () => {
        window.open("{{ url_for('display', event_id=event.id) }}", '_blank');
    });

    // Otw√≥rz ekran gry 2
    document.getElementById('open-display-2-btn')?.addEventListener('click', () => {
        window.open("{{ url_for('display2', event_id=event.id) }}", '_blank');
    });

    // Otw√≥rz ekran gry 3
    document.getElementById('open-display-3-btn')?.addEventListener('click', () => {
        window.open("{{ url_for('photo_player', event_id=event.id) }}", '_blank');
    });

    // Otw√≥rz ekran gry 4
    document.getElementById('open-display-4-btn')?.addEventListener('click', () => {
        window.open("{{ url_for('display4', event_id=event.id) }}", '_blank');
    });

    // Przejd≈∫ do zak≈Çadki Ustawienia wy≈õwietlacza
    document.getElementById('open-display-settings-btn')?.addEventListener('click', () => {
        const displayTab = document.querySelector('button[data-bs-target="#display"]');
        if (displayTab) {
            displayTab.click();
        }
    });

    // ========================================
    // DARK MODE TOGGLE
    // ========================================

    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const darkModeStatus = document.getElementById('dark-mode-status');

    // Function to apply dark mode
    function applyDarkMode(enabled) {
        if (enabled) {
            document.body.classList.add('dark-mode');
            darkModeStatus.textContent = 'W≈ÇƒÖczony';
            darkModeStatus.className = 'badge bg-success';
        } else {
            document.body.classList.remove('dark-mode');
            darkModeStatus.textContent = 'Wy≈ÇƒÖczony';
            darkModeStatus.className = 'badge bg-secondary';
        }
    }

    // Load dark mode preference from localStorage (default: enabled)
    const darkModeEnabled = localStorage.getItem('darkMode') !== 'false';
    if (darkModeToggle) {
        darkModeToggle.checked = darkModeEnabled;
        applyDarkMode(darkModeEnabled);

        // Dark mode toggle event listener
        darkModeToggle.addEventListener('change', (e) => {
            const enabled = e.target.checked;
            applyDarkMode(enabled);
            localStorage.setItem('darkMode', enabled ? 'true' : 'false');
        });
    }

    // ========================================
    // LIVE MODE FUNCTIONS
    // ========================================

    let liveSession = null;
    let liveTimerInterval = null;
    let activeQuestionId = null;

    // Load Live Mode session on page load
    async function loadLiveSession() {
        try {
            const response = await fetch('/api/host/live/session');
            const data = await response.json();
            liveSession = data;

            // Update UI
            const enabledCheckbox = document.getElementById('live-enabled');
            const statusBadge = document.getElementById('live-status');
            const separateScorePoolCheckbox = document.getElementById('live-separate-score-pool');

            if (enabledCheckbox) {
                enabledCheckbox.checked = data.is_enabled;
                statusBadge.textContent = data.is_enabled ? 'Aktywna' : 'Nieaktywna';
                statusBadge.className = data.is_enabled ? 'badge bg-success' : 'badge bg-secondary';
            }

            if (separateScorePoolCheckbox) {
                separateScorePoolCheckbox.checked = data.separate_score_pool || false;
            }

            // Set result mode radio buttons
            const resultMode = data.result_mode || 'auto';
            const resultModeRadio = document.getElementById(`live-result-${resultMode}`);
            if (resultModeRadio) {
                resultModeRadio.checked = true;
            }

            // Generate QR code
            if (data.qr_code) {
                const qrContainer = document.getElementById('live-qr-code');
                if (qrContainer) {
                    qrContainer.innerHTML = '';
                    const liveUrl = `${window.location.origin}/live/{{ event.id }}/${data.qr_code}`;
                    new QRCode(qrContainer, {
                        text: liveUrl,
                        width: 200,
                        height: 200
                    });
                }

                // Set Screen 5 link
                const screen5Link = document.getElementById('live-screen5-link');
                if (screen5Link) {
                    const screen5Url = `${window.location.origin}/live/screen5/{{ event.id }}`;
                    screen5Link.href = screen5Url;
                    screen5Link.textContent = screen5Url;
                }
            }

            // Enable/disable backup QR button
            const backupQRBtn = document.getElementById('live-backup-qr-btn');
            if (backupQRBtn) {
                if (data.backup_qr_code) {
                    backupQRBtn.disabled = false;
                } else {
                    backupQRBtn.disabled = true;
                }
            }

            // Load questions
            loadLiveQuestions();
        } catch (error) {
            console.error('Error loading live session:', error);
        }
    }

    // Save Live Mode settings
    window.saveLiveSettings = async function() {
        const enabled = document.getElementById('live-enabled').checked;
        const separateScorePool = document.getElementById('live-separate-score-pool').checked;
        const resultMode = document.querySelector('input[name="live-result-mode"]:checked').value;

        try {
            const response = await fetch('/api/host/live/session', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    is_enabled: enabled,
                    separate_score_pool: separateScorePool,
                    result_mode: resultMode
                })
            });

            if (response.ok) {
                console.log('Ustawienia zapisane');
                loadLiveSession();
            } else {
                alert('B≈ÇƒÖd zapisu ustawie≈Ñ');
            }
        } catch (error) {
            console.error('Error saving settings:', error);
            alert('B≈ÇƒÖd zapisu ustawie≈Ñ: ' + error.message);
        }
    };

    // Live enabled toggle handler
    if (document.getElementById('live-enabled')) {
        document.getElementById('live-enabled').addEventListener('change', function(e) {
            const statusBadge = document.getElementById('live-status');
            if (e.target.checked) {
                statusBadge.textContent = 'Aktywna';
                statusBadge.className = 'badge bg-success';
            } else {
                statusBadge.textContent = 'Nieaktywna';
                statusBadge.className = 'badge bg-secondary';
            }
            saveLiveSettings();
        });
    }

    // Separate score pool toggle handler
    if (document.getElementById('live-separate-score-pool')) {
        document.getElementById('live-separate-score-pool').addEventListener('change', function(e) {
            saveLiveSettings();
        });
    }

    // Result mode radio buttons handler
    document.querySelectorAll('input[name="live-result-mode"]').forEach(radio => {
        radio.addEventListener('change', function() {
            saveLiveSettings();
        });
    });

    // Show Screen 5 button
    const liveShowScreen5Btn = document.getElementById('live-show-screen5-btn');
    if (liveShowScreen5Btn) {
        liveShowScreen5Btn.addEventListener('click', function() {
            const link = document.getElementById('live-screen5-link').href;
            if (link && link !== '#') {
                window.open(link, '_blank');
            }
        });
    }

    // Generate backup QR button
    const liveGenerateBackupQRBtn = document.getElementById('live-generate-backup-qr-btn');
    if (liveGenerateBackupQRBtn) {
        liveGenerateBackupQRBtn.addEventListener('click', async function() {
            try {
                const response = await fetch('/api/host/live/backup-qr/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });

                if (response.ok) {
                    const data = await response.json();
                    alert('Zapasowy kod QR zosta≈Ç wygenerowany!');
                    loadLiveSession(); // Reload to update UI
                } else {
                    alert('B≈ÇƒÖd generowania zapasowego kodu QR');
                }
            } catch (error) {
                console.error('Error generating backup QR:', error);
                alert('B≈ÇƒÖd: ' + error.message);
            }
        });
    }

    // Backup QR preview button
    const liveBackupQRBtn = document.getElementById('live-backup-qr-btn');
    if (liveBackupQRBtn) {
        liveBackupQRBtn.addEventListener('click', function() {
            if (liveSession && liveSession.backup_qr_code) {
                const liveUrl = `${window.location.origin}/live/{{ event.id }}/${liveSession.backup_qr_code}`;
                window.open(`/player_qr_preview/{{ event.id }}?url=${encodeURIComponent(liveUrl)}&title=Tryb Na ≈ªywo (Zapasowy)`, '_blank');
            }
        });
    }

    // Show statistics button
    const liveShowStatisticsBtn = document.getElementById('live-show-statistics-btn');
    if (liveShowStatisticsBtn) {
        liveShowStatisticsBtn.addEventListener('click', async function() {
            if (!activeQuestionId) {
                alert('Brak zako≈Ñczonego pytania do wy≈õwietlenia statystyk');
                return;
            }

            try {
                const response = await fetch(`/api/host/live/question/${activeQuestionId}/show-statistics`, {
                    method: 'POST'
                });

                if (response.ok) {
                    alert('Statystyki zosta≈Çy wys≈Çane na ekran 5');
                } else {
                    alert('B≈ÇƒÖd wy≈õwietlania statystyk');
                }
            } catch (error) {
                console.error('Error showing statistics:', error);
                alert('B≈ÇƒÖd: ' + error.message);
            }
        });
    }

    // Handle adding new answer fields for Live mode
    const liveAddAnswerBtn = document.getElementById('live-add-answer-btn');
    if (liveAddAnswerBtn) {
        liveAddAnswerBtn.addEventListener('click', function() {
            const container = document.getElementById('live-answers-container');
            const currentCount = container.querySelectorAll('.live-answer-item').length;
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

            if (currentCount < 26) {
                const newLetter = letters[currentCount];
                const newItem = document.createElement('div');
                newItem.className = 'input-group mb-2 live-answer-item';
                newItem.innerHTML = `
                    <span class="input-group-text">Odpowied≈∫ ${newLetter}</span>
                    <input type="text" class="form-control live-answer-input" placeholder="Opcjonalnie">
                    <div class="input-group-text">
                        <input class="form-check-input live-correct-checkbox mt-0" type="checkbox" title="Poprawna odpowied≈∫">
                        <span class="ms-2 small">Poprawna</span>
                    </div>
                    <button class="btn btn-danger live-remove-answer-btn" type="button">√ó</button>
                `;

                // Add event listener to the remove button
                const removeBtn = newItem.querySelector('.live-remove-answer-btn');
                removeBtn.addEventListener('click', function() {
                    newItem.remove();
                    updateLiveAnswerLabels();
                    updateLiveRemoveButtons();
                });

                container.appendChild(newItem);
                updateLiveRemoveButtons();
            }
        });
    }

    // Update answer labels after removal
    function updateLiveAnswerLabels() {
        const items = document.querySelectorAll('#live-answers-container .live-answer-item');
        const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        items.forEach((item, index) => {
            const label = item.querySelector('.input-group-text');
            if (label) {
                label.textContent = `Odpowied≈∫ ${letters[index]}`;
            }
        });
    }

    // Update visibility of remove buttons (always show for >2 items)
    function updateLiveRemoveButtons() {
        const items = document.querySelectorAll('#live-answers-container .live-answer-item');
        items.forEach((item, index) => {
            const removeBtn = item.querySelector('.live-remove-answer-btn');
            if (removeBtn) {
                // Show remove button only if there are more than 2 items
                if (items.length > 2) {
                    removeBtn.style.display = 'block';
                    // Add event listener if not already present
                    if (!removeBtn.hasAttribute('data-listener')) {
                        removeBtn.setAttribute('data-listener', 'true');
                        removeBtn.addEventListener('click', function() {
                            item.remove();
                            updateLiveAnswerLabels();
                            updateLiveRemoveButtons();
                        });
                    }
                } else {
                    removeBtn.style.display = 'none';
                }
            }
        });
    }

    // Create new live question
    window.createLiveQuestion = async function() {
        const questionText = document.getElementById('live-new-question-text').value;
        const timeLimit = parseInt(document.getElementById('live-new-time-limit').value);

        // Collect answers and correct answers from dynamic fields
        const answerItems = document.querySelectorAll('#live-answers-container .live-answer-item');
        const options = {};
        const correctAnswers = [];
        const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

        answerItems.forEach((item, index) => {
            const input = item.querySelector('.live-answer-input');
            const checkbox = item.querySelector('.live-correct-checkbox');
            const letter = letters[index];

            if (input && input.value.trim()) {
                options[`option_${letter.toLowerCase()}`] = input.value.trim();

                if (checkbox && checkbox.checked) {
                    correctAnswers.push(letter);
                }
            }
        });

        try {
            const response = await fetch('/api/host/live/question', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    question_text: questionText,
                    ...options,
                    correct_answers: correctAnswers,
                    time_limit: timeLimit
                })
            });

            if (response.ok) {
                console.log('Pytanie dodane');
                // Clear form
                document.getElementById('live-new-question-text').value = '';
                document.getElementById('live-new-time-limit').value = '30';

                // Reset answer fields to initial state (A and B only)
                const container = document.getElementById('live-answers-container');
                container.innerHTML = `
                    <div class="input-group mb-2 live-answer-item">
                        <span class="input-group-text">Odpowied≈∫ A</span>
                        <input type="text" class="form-control live-answer-input" placeholder="Opcjonalnie">
                        <div class="input-group-text">
                            <input class="form-check-input live-correct-checkbox mt-0" type="checkbox" title="Poprawna odpowied≈∫">
                            <span class="ms-2 small">Poprawna</span>
                        </div>
                        <button class="btn btn-danger live-remove-answer-btn" type="button" style="display: none;">√ó</button>
                    </div>
                    <div class="input-group mb-2 live-answer-item">
                        <span class="input-group-text">Odpowied≈∫ B</span>
                        <input type="text" class="form-control live-answer-input" placeholder="Opcjonalnie">
                        <div class="input-group-text">
                            <input class="form-check-input live-correct-checkbox mt-0" type="checkbox" title="Poprawna odpowied≈∫">
                            <span class="ms-2 small">Poprawna</span>
                        </div>
                        <button class="btn btn-danger live-remove-answer-btn" type="button" style="display: none;">√ó</button>
                    </div>
                `;
                updateLiveRemoveButtons();

                loadLiveQuestions();
            } else {
                const data = await response.json();
                alert('B≈ÇƒÖd: ' + (data.error || 'Nie uda≈Ço siƒô dodaƒá pytania'));
            }
        } catch (error) {
            console.error('Error creating question:', error);
            alert('B≈ÇƒÖd tworzenia pytania: ' + error.message);
        }
    };

    // Load live questions list
    async function loadLiveQuestions() {
        try {
            const response = await fetch('/api/host/live/questions');
            const data = await response.json();
            const container = document.getElementById('live-questions-list');

            if (data.questions && data.questions.length > 0) {
                container.innerHTML = data.questions.map(q => {
                    // Build options dynamically
                    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                    let optionsHtml = '';
                    for (let i = 0; i < letters.length; i++) {
                        const letter = letters[i].toLowerCase();
                        const optionKey = `option_${letter}`;
                        if (q[optionKey]) {
                            optionsHtml += `<small>${letters[i]}: ${q[optionKey]}</small><br>`;
                        }
                    }

                    // Display correct answers
                    let correctAnswersHtml = '';
                    if (q.is_revealed && q.correct_answer) {
                        correctAnswersHtml = `<br><small class="text-success">Poprawna: ${q.correct_answer} (${q.correct_answers || 0} poprawnych)</small>`;
                    }

                    return `
                        <div class="card mb-2 ${q.is_active ? 'border-warning' : ''}">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="flex-grow-1">
                                        <p class="mb-1"><strong>${q.question_text || '(Pytanie czytane ze sceny)'}</strong></p>
                                        ${optionsHtml}
                                        <small class="text-muted">Limit: ${q.time_limit}s | Odpowiedzi: ${q.total_answers || 0}</small>
                                        ${correctAnswersHtml}
                                    </div>
                                    <div class="btn-group-vertical ms-2">
                                        ${!q.is_active && !q.is_revealed ? `
                                            <button class="btn btn-sm btn-success" onclick="startLiveQuestion(${q.id})">‚ñ∂ Start</button>
                                        ` : ''}
                                        ${q.is_active ? `<span class="badge bg-warning">Aktywne</span>` : ''}
                                        ${q.is_revealed ? `<span class="badge bg-info">Zako≈Ñczone</span>` : ''}
                                        <button class="btn btn-sm btn-danger" onclick="deleteLiveQuestion(${q.id})">üóë</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                container.innerHTML = '<p class="text-muted text-center">Brak pyta≈Ñ. Dodaj nowe pytanie powy≈ºej.</p>';
            }
        } catch (error) {
            console.error('Error loading questions:', error);
        }
    }

    // Start live question
    window.startLiveQuestion = async function(questionId) {
        try {
            const response = await fetch(`/api/host/live/question/${questionId}/start`, {
                method: 'POST'
            });

            if (response.ok) {
                activeQuestionId = questionId;
                console.log('Pytanie uruchomione');
                loadLiveQuestions();
                showActiveQuestionPanel(questionId);
                startLiveTimer();
            } else {
                alert('B≈ÇƒÖd uruchamiania pytania');
            }
        } catch (error) {
            console.error('Error starting question:', error);
            alert('B≈ÇƒÖd uruchamiania pytania: ' + error.message);
        }
    };

    // Show active question panel
    async function showActiveQuestionPanel(questionId) {
        try {
            // Fetch question details to show options
            const response = await fetch('/api/host/live/questions');
            const data = await response.json();
            const question = data.questions.find(q => q.id === questionId);

            if (!question) return;

            // Update question text
            const questionTextEl = document.getElementById('live-active-q-text');
            if (questionTextEl) {
                questionTextEl.textContent = question.question_text || '(Pytanie czytane ze sceny)';
            }

            // Display options
            const optionsEl = document.getElementById('live-active-options');
            if (optionsEl) {
                const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                let optionsHtml = '';
                for (let i = 0; i < letters.length; i++) {
                    const letter = letters[i].toLowerCase();
                    const optionKey = `option_${letter}`;
                    if (question[optionKey]) {
                        optionsHtml += `<div><strong>${letters[i]}:</strong> ${question[optionKey]}</div>`;
                    }
                }
                optionsEl.innerHTML = optionsHtml;
            }

            // Generate reveal buttons dynamically
            const buttonsContainer = document.getElementById('live-reveal-buttons');
            if (buttonsContainer) {
                const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                let buttonsHtml = '';
                for (let i = 0; i < letters.length; i++) {
                    const letter = letters[i].toLowerCase();
                    const optionKey = `option_${letter}`;
                    if (question[optionKey]) {
                        buttonsHtml += `<button type="button" class="btn btn-outline-primary live-reveal-btn" data-answer="${letters[i]}">${letters[i]}</button>`;
                    }
                }
                buttonsContainer.innerHTML = buttonsHtml;

                // Add event listeners to buttons
                const selectedAnswers = new Set();
                buttonsContainer.querySelectorAll('.live-reveal-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const answer = this.dataset.answer;
                        if (selectedAnswers.has(answer)) {
                            selectedAnswers.delete(answer);
                            this.classList.remove('btn-success');
                            this.classList.add('btn-outline-primary');
                        } else {
                            selectedAnswers.add(answer);
                            this.classList.remove('btn-outline-primary');
                            this.classList.add('btn-success');
                        }
                    });
                });

                // Add final reveal button
                const revealBtn = document.createElement('button');
                revealBtn.className = 'btn btn-danger w-100 mt-2';
                revealBtn.textContent = '‚úÖ Ujawnij wybrane odpowiedzi';
                revealBtn.onclick = function() {
                    if (selectedAnswers.size === 0) {
                        alert('Wybierz przynajmniej jednƒÖ poprawnƒÖ odpowied≈∫');
                        return;
                    }
                    revealAnswers(Array.from(selectedAnswers));
                };
                buttonsContainer.appendChild(revealBtn);
            }

            const card = document.getElementById('live-active-question-card');
            card.style.display = 'block';
            // Scroll to active question card
            card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        } catch (error) {
            console.error('Error showing active question panel:', error);
        }
    }

    // Hide active question panel
    function hideActiveQuestionPanel() {
        const card = document.getElementById('live-active-question-card');
        card.style.display = 'none';
        if (liveTimerInterval) {
            clearInterval(liveTimerInterval);
            liveTimerInterval = null;
        }
    }

    // Start live timer
    function startLiveTimer() {
        if (liveTimerInterval) {
            clearInterval(liveTimerInterval);
        }

        let timeRemaining = 30; // Default, will be updated
        const timerDisplay = document.getElementById('live-timer-display');

        liveTimerInterval = setInterval(() => {
            timeRemaining--;
            if (timerDisplay) {
                timerDisplay.textContent = timeRemaining;
            }

            if (timeRemaining <= 0) {
                clearInterval(liveTimerInterval);
                liveTimerInterval = null;
            }
        }, 1000);
    }

    // Reveal answer (legacy function for backwards compatibility)
    window.revealAnswer = async function(answer) {
        return revealAnswers([answer]);
    };

    // Reveal answers (supports multiple correct answers)
    window.revealAnswers = async function(answers) {
        if (!activeQuestionId) return;

        try {
            const response = await fetch(`/api/host/live/question/${activeQuestionId}/reveal`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    correct_answer: answers.join(','),  // Send as comma-separated string
                    correct_answers: answers  // Also send as array
                })
            });

            if (response.ok) {
                console.log(`Poprawne odpowiedzi: ${answers.join(', ')}`);
                activeQuestionId = null;
                hideActiveQuestionPanel();
                loadLiveQuestions();
            } else {
                alert('B≈ÇƒÖd ujawniania odpowiedzi');
            }
        } catch (error) {
            console.error('Error revealing answer:', error);
            alert('B≈ÇƒÖd ujawniania odpowiedzi: ' + error.message);
        }
    };

    // Delete live question
    window.deleteLiveQuestion = async function(questionId) {
        if (!confirm('Czy na pewno chcesz usunƒÖƒá to pytanie?')) return;

        try {
            const response = await fetch(`/api/host/live/question/${questionId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                console.log('Pytanie usuniƒôte');
                loadLiveQuestions();
            } else {
                alert('B≈ÇƒÖd usuwania pytania');
            }
        } catch (error) {
            console.error('Error deleting question:', error);
            alert('B≈ÇƒÖd usuwania pytania: ' + error.message);
        }
    };

    // Open Live QR Preview (similar to other QR previews)
    window.openLiveQRPreview = function() {
        if (liveSession && liveSession.qr_code) {
            const liveUrl = `${window.location.origin}/live/{{ event.id }}/${liveSession.qr_code}`;
            window.open(`/player_qr_preview/{{ event.id }}?url=${encodeURIComponent(liveUrl)}&title=Tryb Na ≈ªywo`, '_blank');
        }
    };

    // WebSocket listeners for live mode
    if (socket) {
        socket.on('live_question_started', function(data) {
            console.log('Live question started:', data);
            loadLiveQuestions();
        });

        socket.on('live_answer_revealed', function(data) {
            console.log('Live answer revealed:', data);
            loadLiveQuestions();
        });

        socket.on('live_questions_reset', function(data) {
            console.log('Live questions reset by admin');
            loadLiveQuestions();
            // Ukryj aktywne pytanie je≈õli by≈Ço wy≈õwietlane
            hideActiveQuestionPanel();
        });
    }

    // Initialize Live Mode on page load
    loadLiveSession();

    // =====================================================================
    // ZARZƒÑDZANIE ZABEZPIECZENIAMI REJESTRACJI
    // =====================================================================

    window.loadSecurityStats = async function() {
        try {
            const response = await fetch('/api/host/registration/limits');
            const data = await response.json();

            // Ustaw limity w formularzu
            document.getElementById('limit-ip').value = data.limits.max_players_per_ip;
            document.getElementById('limit-device').value = data.limits.max_players_per_device;

            // Wy≈õwietl statystyki
            let html = `
                <div class="row text-center mb-3">
                    <div class="col-md-3">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h3 class="mb-0">${data.stats.total_players}</h3>
                                <small class="text-muted">Graczy</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h3 class="mb-0">${data.stats.unique_ips}</h3>
                                <small class="text-muted">Unikalne IP</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h3 class="mb-0">${data.stats.unique_devices}</h3>
                                <small class="text-muted">UrzƒÖdze≈Ñ</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card ${data.stats.suspicious_devices_count > 0 ? 'bg-warning' : 'bg-success'} text-white">
                            <div class="card-body">
                                <h3 class="mb-0">${data.stats.suspicious_devices_count}</h3>
                                <small>Podejrzanych</small>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Podejrzane urzƒÖdzenia
            if (Object.keys(data.suspicious_devices).length > 0) {
                html += '<div class="alert alert-warning"><strong>‚ö†Ô∏è Podejrzane urzƒÖdzenia (wiele kont):</strong><ul class="mb-0">';

                for (const [fp, players] of Object.entries(data.suspicious_devices)) {
                    const fpShort = fp.substring(0, 12) + '...';
                    html += `<li><strong>UrzƒÖdzenie ${fpShort}:</strong> ${players.length} graczy<ul>`;
                    players.forEach(p => {
                        html += `<li>${p.name} (${p.score} pkt, IP: ${p.ip})</li>`;
                    });
                    html += `</ul></li>`;
                }

                html += '</ul></div>';
            }

            // Podejrzane IP
            if (Object.keys(data.suspicious_ips).length > 0) {
                html += '<div class="alert alert-info"><strong>‚ÑπÔ∏è IP z wieloma graczami (mo≈ºe byƒá OK dla WiFi):</strong><ul class="mb-0">';

                for (const [ip, players] of Object.entries(data.suspicious_ips)) {
                    html += `<li><strong>${ip}:</strong> ${players.length} graczy<ul>`;
                    players.forEach(p => {
                        const fpInfo = p.fingerprint ? ` (UrzƒÖdzenie: ${p.fingerprint})` : '';
                        html += `<li>${p.name} (${p.score} pkt)${fpInfo}</li>`;
                    });
                    html += `</ul></li>`;
                }

                html += '</ul></div>';
            }

            if (Object.keys(data.suspicious_devices).length === 0 && Object.keys(data.suspicious_ips).length === 0) {
                html += '<div class="alert alert-success">‚úÖ Wszystko wyglƒÖda OK! Brak podejrzanych rejestracji.</div>';
            }

            document.getElementById('security-stats').innerHTML = html;

        } catch (error) {
            alert('B≈ÇƒÖd ≈Çadowania statystyk: ' + error.message);
        }
    };

    window.updateSecurityLimits = async function() {
        const limitIP = parseInt(document.getElementById('limit-ip').value);
        const limitDevice = parseInt(document.getElementById('limit-device').value);

        try {
            const response = await fetch('/api/host/registration/limits', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    max_players_per_ip: limitIP,
                    max_players_per_device: limitDevice
                })
            });

            const data = await response.json();
            alert(data.message || 'Limity zaktualizowane!');
            loadSecurityStats();

        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    window.cleanupDuplicates = async function(strategy) {
        const confirmMessage =
            strategy === 'fingerprint' ? 'Usu≈Ñ duplikaty wed≈Çug urzƒÖdze≈Ñ? (zostawi najlepszego gracza z ka≈ºdego urzƒÖdzenia)' :
            strategy === 'ip' ? 'Usu≈Ñ duplikaty wed≈Çug IP? (zostawi najlepszych graczy wed≈Çug limitu IP)' :
            'Usu≈Ñ wszystkie duplikaty? (po≈ÇƒÖczenie obu metod)';

        if (!confirm(confirmMessage)) return;

        try {
            const response = await fetch('/api/host/registration/cleanup_duplicates', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ strategy })
            });

            const data = await response.json();
            alert(`${data.message}\n\nUsuniƒôto: ${data.removed_count} graczy`);

            loadSecurityStats();
            loadPlayers();

        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    };

    // Za≈Çaduj statystyki przy otwarciu zak≈Çadki Gracze
    document.querySelector('button[data-bs-target="#players"]')?.addEventListener('click', () => {
        setTimeout(() => loadSecurityStats(), 100);
    });

    // === VOTING QR CODES ===

    // PodglƒÖd g≈Ç√≥wnego kodu QR dla g≈Çosowania
    document.getElementById('voting-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/voting_qr/${eventId}`, '_blank');
    });

    // Generuj zapasowy kod QR dla g≈Çosowania
    document.getElementById('voting-generate-backup-qr-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const generateBtn = document.getElementById('voting-generate-backup-qr-btn');
        const backupBtn = document.getElementById('voting-backup-qr-btn');

        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generowanie...';

        try {
            const response = await fetch(`/api/host/voting/generate_backup_qr/${eventId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error('B≈ÇƒÖd generowania kodu QR');
            }

            const data = await response.json();
            alert(data.message);

            // Aktywuj przycisk podglƒÖdu zapasowego kodu
            backupBtn.disabled = false;

        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        } finally {
            generateBtn.disabled = false;
            generateBtn.textContent = 'üîÑ Generuj zapasowy kod QR';
        }
    });

    // PodglƒÖd zapasowego kodu QR dla g≈Çosowania
    document.getElementById('voting-backup-qr-btn')?.addEventListener('click', () => {
        const eventId = {{ event.id }};
        window.open(`/voting_qr/${eventId}?backup=true`, '_blank');
    });

    // Wy≈õlij kod QR g≈Çosowania na ekran 5
    document.getElementById('voting-send-to-screen5-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const btn = document.getElementById('voting-send-to-screen5-btn');

        btn.disabled = true;
        btn.textContent = 'üì∫ Wysy≈Çanie...';

        try {
            const votingUrl = `${window.location.origin}/voting/${eventId}`;

            const response = await fetch('/api/display/screen5/send_qr', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    type: 'voting',
                    url: votingUrl,
                    description: 'Zeskanuj kod aby zag≈Çosowaƒá'
                })
            });

            if (!response.ok) {
                throw new Error('B≈ÇƒÖd wysy≈Çania kodu QR');
            }

            const data = await response.json();
            alert('Kod QR zosta≈Ç wys≈Çany na ekran 5!');

        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        } finally {
            btn.disabled = false;
            btn.textContent = 'üì∫ Wy≈õlij kod na ekran numer 5';
        }
    });

    // === LIVE MODE - SEND TO SCREEN 5 ===

    document.getElementById('live-send-to-screen5-btn')?.addEventListener('click', async () => {
        const eventId = {{ event.id }};
        const btn = document.getElementById('live-send-to-screen5-btn');

        btn.disabled = true;
        btn.textContent = 'üì∫ Wysy≈Çanie...';

        try {
            // Sprawd≈∫ czy liveSession istnieje
            if (!liveSession || !liveSession.qr_code) {
                throw new Error('Brak sesji live. Upewnij siƒô ≈ºe tryb live jest w≈ÇƒÖczony.');
            }

            const liveUrl = `${window.location.origin}/live/${eventId}/${liveSession.qr_code}`;

            const response = await fetch('/api/display/screen5/send_qr', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    type: 'live',
                    url: liveUrl,
                    description: 'Do≈ÇƒÖcz do trybu live'
                })
            });

            if (!response.ok) {
                throw new Error('B≈ÇƒÖd wysy≈Çania kodu QR');
            }

            const data = await response.json();
            alert('Kod QR zosta≈Ç wys≈Çany na ekran 5!');

        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        } finally {
            btn.disabled = false;
            btn.textContent = 'üì∫ Wy≈õlij kod na ekran numer 5';
        }
    });

    // ===================================================
    // TIMER DLA PYTA≈É RUNDA 2
    // ===================================================

    let r2TimerInterval = null;
    let r2TimerEndTime = null;

    async function startR2QuestionsTimer() {
        const eventId = {{ event.id }};
        const minutes = parseInt(document.getElementById('r2-questions-timer-minutes').value);

        if (!minutes || minutes < 1) {
            alert('Proszƒô wprowadziƒá prawid≈ÇowƒÖ liczbƒô minut (min. 1)');
            return;
        }

        try {
            const response = await fetch(`/api/host/questions_r2/timer/${eventId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ minutes: minutes })
            });

            if (!response.ok) {
                throw new Error('B≈ÇƒÖd uruchamiania timera');
            }

            const data = await response.json();
            r2TimerEndTime = new Date(data.end_time);

            // Poka≈º timer i przycisk anulowania
            document.getElementById('r2-questions-timer-display').style.display = 'block';
            document.getElementById('r2-questions-timer-cancel').style.display = 'inline-block';
            document.getElementById('r2-questions-timer-minutes').disabled = true;

            // Rozpocznij odliczanie
            updateR2TimerDisplay();
            r2TimerInterval = setInterval(updateR2TimerDisplay, 1000);

        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    }

    function updateR2TimerDisplay() {
        if (!r2TimerEndTime) return;

        const now = new Date();
        const diff = r2TimerEndTime - now;

        if (diff <= 0) {
            // Timer zako≈Ñczony - w≈ÇƒÖcz pytania
            clearInterval(r2TimerInterval);
            r2TimerInterval = null;
            r2TimerEndTime = null;

            document.getElementById('r2-questions-timer-display').style.display = 'none';
            document.getElementById('r2-questions-timer-cancel').style.display = 'none';
            document.getElementById('r2-questions-timer-minutes').disabled = false;
            document.getElementById('r2-questions-timer-minutes').value = '';

            // W≈ÇƒÖcz pytania
            document.getElementById('r2-questions-enabled').checked = true;
            document.getElementById('r2-questions-status').textContent = 'Aktywna';
            document.getElementById('r2-questions-status').className = 'badge bg-success';

            alert('Pytania Runda 2 zosta≈Çy automatycznie w≈ÇƒÖczone!');
            return;
        }

        // Oblicz pozosta≈Çy czas
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        const display = `${hours}h ${minutes}m ${seconds}s`;
        document.getElementById('r2-questions-timer-countdown').textContent = display;
    }

    async function cancelR2QuestionsTimer() {
        const eventId = {{ event.id }};

        try {
            const response = await fetch(`/api/host/questions_r2/timer/${eventId}`, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' }
            });

            if (!response.ok) {
                throw new Error('B≈ÇƒÖd anulowania timera');
            }

            // Zatrzymaj timer
            clearInterval(r2TimerInterval);
            r2TimerInterval = null;
            r2TimerEndTime = null;

            // Ukryj elementy timera
            document.getElementById('r2-questions-timer-display').style.display = 'none';
            document.getElementById('r2-questions-timer-cancel').style.display = 'none';
            document.getElementById('r2-questions-timer-minutes').disabled = false;
            document.getElementById('r2-questions-timer-minutes').value = '';

            alert('Timer zosta≈Ç anulowany');

        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    }

    // ===================================================
    // TIMER DLA PYTA≈É RUNDA 3
    // ===================================================

    let r3TimerInterval = null;
    let r3TimerEndTime = null;

    async function startR3QuestionsTimer() {
        const eventId = {{ event.id }};
        const minutes = parseInt(document.getElementById('r3-questions-timer-minutes').value);

        if (!minutes || minutes < 1) {
            alert('Proszƒô wprowadziƒá prawid≈ÇowƒÖ liczbƒô minut (min. 1)');
            return;
        }

        try {
            const response = await fetch(`/api/host/questions_r3/timer/${eventId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ minutes: minutes })
            });

            if (!response.ok) {
                throw new Error('B≈ÇƒÖd uruchamiania timera');
            }

            const data = await response.json();
            r3TimerEndTime = new Date(data.end_time);

            // Poka≈º timer i przycisk anulowania
            document.getElementById('r3-questions-timer-display').style.display = 'block';
            document.getElementById('r3-questions-timer-cancel').style.display = 'inline-block';
            document.getElementById('r3-questions-timer-minutes').disabled = true;

            // Rozpocznij odliczanie
            updateR3TimerDisplay();
            r3TimerInterval = setInterval(updateR3TimerDisplay, 1000);

        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    }

    function updateR3TimerDisplay() {
        if (!r3TimerEndTime) return;

        const now = new Date();
        const diff = r3TimerEndTime - now;

        if (diff <= 0) {
            // Timer zako≈Ñczony - w≈ÇƒÖcz pytania
            clearInterval(r3TimerInterval);
            r3TimerInterval = null;
            r3TimerEndTime = null;

            document.getElementById('r3-questions-timer-display').style.display = 'none';
            document.getElementById('r3-questions-timer-cancel').style.display = 'none';
            document.getElementById('r3-questions-timer-minutes').disabled = false;
            document.getElementById('r3-questions-timer-minutes').value = '';

            // W≈ÇƒÖcz pytania
            document.getElementById('r3-questions-enabled').checked = true;
            document.getElementById('r3-questions-status').textContent = 'Aktywna';
            document.getElementById('r3-questions-status').className = 'badge bg-success';

            alert('Pytania Runda 3 zosta≈Çy automatycznie w≈ÇƒÖczone!');
            return;
        }

        // Oblicz pozosta≈Çy czas
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        const display = `${hours}h ${minutes}m ${seconds}s`;
        document.getElementById('r3-questions-timer-countdown').textContent = display;
    }

    async function cancelR3QuestionsTimer() {
        const eventId = {{ event.id }};

        try {
            const response = await fetch(`/api/host/questions_r3/timer/${eventId}`, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' }
            });

            if (!response.ok) {
                throw new Error('B≈ÇƒÖd anulowania timera');
            }

            // Zatrzymaj timer
            clearInterval(r3TimerInterval);
            r3TimerInterval = null;
            r3TimerEndTime = null;

            // Ukryj elementy timera
            document.getElementById('r3-questions-timer-display').style.display = 'none';
            document.getElementById('r3-questions-timer-cancel').style.display = 'none';
            document.getElementById('r3-questions-timer-minutes').disabled = false;
            document.getElementById('r3-questions-timer-minutes').value = '';

            alert('Timer zosta≈Ç anulowany');

        } catch (error) {
            alert('B≈ÇƒÖd: ' + error.message);
        }
    }

    // Sprawd≈∫ przy ≈Çadowaniu czy sƒÖ aktywne timery
    async function checkActiveTimers() {
        const eventId = {{ event.id }};

        try {
            // Sprawd≈∫ timer rundy 2
            const r2Response = await fetch(`/api/host/questions_r2/timer/${eventId}`);
            if (r2Response.ok) {
                const r2Data = await r2Response.json();
                if (r2Data.active && r2Data.end_time) {
                    r2TimerEndTime = new Date(r2Data.end_time);
                    document.getElementById('r2-questions-timer-display').style.display = 'block';
                    document.getElementById('r2-questions-timer-cancel').style.display = 'inline-block';
                    document.getElementById('r2-questions-timer-minutes').disabled = true;
                    r2TimerInterval = setInterval(updateR2TimerDisplay, 1000);
                    updateR2TimerDisplay();
                }
            }

            // Sprawd≈∫ timer rundy 3
            const r3Response = await fetch(`/api/host/questions_r3/timer/${eventId}`);
            if (r3Response.ok) {
                const r3Data = await r3Response.json();
                if (r3Data.active && r3Data.end_time) {
                    r3TimerEndTime = new Date(r3Data.end_time);
                    document.getElementById('r3-questions-timer-display').style.display = 'block';
                    document.getElementById('r3-questions-timer-cancel').style.display = 'inline-block';
                    document.getElementById('r3-questions-timer-minutes').disabled = true;
                    r3TimerInterval = setInterval(updateR3TimerDisplay, 1000);
                    updateR3TimerDisplay();
                }
            }
        } catch (error) {
            console.error('B≈ÇƒÖd sprawdzania timer√≥w:', error);
        }
    }

    // Sprawd≈∫ timery przy za≈Çadowaniu strony
    checkActiveTimers();

});
</script>
{% endblock %}














