{% extends 'base.html' %}
{% block title %}Gracz{% endblock %}
{% block content %}
<div class="container mt-4" style="max-width: 500px;">
    <div id="main-view">
        <div id="name-input-section" class="text-center">
            <h2>Witaj w grze Saper!</h2>
            <div class="mb-3"><label for="player-name" class="form-label">Podaj swoje imiƒô lub nazwƒô dru≈ºyny:</label><input type="text" class="form-control" id="player-name" required></div>
            <button id="register-btn" class="btn btn-primary">Do≈ÇƒÖcz do Gry i Skanuj Kod</button>
        </div>
        <div id="game-view" style="display: none;">
            <div class="d-flex justify-content-between align-items-center">
                <h2>Witaj, <span id="player-name-display"></span>!</h2>
                <p class="lead mb-0">Punkty: <strong id="player-score">0</strong></p>
            </div>
            <button id="reset-player-btn" class="btn btn-sm btn-outline-danger" style="position: fixed; top: 10px; right: 10px; z-index: 100;">üîÑ Reset</button>
            <hr>
        </div>
        <div id="quiz-section" style="display: none;" class="text-center">
             <h3>Pytanie:</h3>
             <p id="question" class="lead"></p>
             <div id="answers" class="d-grid gap-2 mt-3"></div>
        </div>
        <div id="message-section" style="display: none;" class="alert"></div>

        <!-- Wyb√≥r kategorii AI -->
        <div id="ai-category-selection" style="display: none;" class="text-center">
            <h3>Wybierz kategoriƒô:</h3>
            <p class="text-muted">Pytania AI - 5 punkt√≥w za poprawnƒÖ odpowied≈∫</p>
            <div id="ai-categories-buttons" class="d-grid gap-2 mt-3"></div>
        </div>
    </div>
    
    <!-- üì∏ WIDOK APARATU DO ZDJƒòƒÜ -->
    <div id="photo-capture-view" style="display:none;" class="text-center">
        <h3>üì∏ Wyzwanie Fotograficzne!</h3>
        <p>Zr√≥b ≈õmieszne zdjƒôcie i zdobƒÖd≈∫ 15 punkt√≥w!</p>
        <video id="camera-feed" autoplay playsinline class="w-100 border rounded mb-2" style="max-height: 400px;"></video>
        <button id="capture-btn" class="btn btn-danger btn-lg mb-2">üì∑ Zr√≥b zdjƒôcie</button>
        <button id="cancel-photo-btn" class="btn btn-secondary">Anuluj</button>
        <canvas id="photo-canvas" style="display:none;"></canvas>
    </div>
    
    <!-- üéÆ WIDOK GRY TETRIS -->
    <div id="tetris-game-view" style="display:none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #607D8B; z-index: 1000;">
        <div class="d-flex flex-column" style="height: 100vh;">
            <!-- Nag≈Ç√≥wek (8%) - zmniejszony -->
            <div class="text-center py-1 bg-dark text-white" style="flex: 0 0 8%; min-height: 60px; display: flex; flex-direction: column; justify-content: center;">
                <h5 class="mb-0" style="font-size: 1.1rem;">üéÆ TETRIS</h5>
                <div class="d-flex justify-content-between align-items-center px-3">
                    <span id="tetris-player-name" style="font-size: 0.85rem;"></span>
                    <strong style="font-size: 0.9rem;">Punkty: <span id="tetris-score">0</span> / 20</strong>
                </div>
            </div>
            
            <!-- Obszar gry z przyciskami po bokach (84%) -->
            <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 2px; position: relative;">
                <!-- Sekcja Start/Back (na ≈õrodku, przed rozpoczƒôciem gry) - BIA≈ÅE T≈ÅO -->
                <div id="tetris-start-section" class="text-center" style="position: absolute; z-index: 10; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <h4 class="mb-3" style="color: #333;">üéÆ Tetris Challenge</h4>
                    <p class="mb-4" style="color: #666;">U≈Ç√≥≈º linie, aby zdobyƒá 20 punkt√≥w!</p>
                    <button id="tetris-start-btn" class="btn btn-success btn-lg mb-3" style="width: 200px; font-weight: bold;">START GRY</button>
                    <br>
                    <button id="tetris-back-btn" class="btn btn-outline-secondary">‚Üê Wr√≥ƒá do gry</button>
                </div>
                
                <!-- Przyciski po lewej stronie (65px, by≈Ço 50px) -->
                <div id="tetris-left-controls" style="display: none; position: absolute; left: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                    <div class="d-flex flex-column gap-2">
                        <button id="tetris-left-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚óÑ</button>
                        <button id="tetris-rotate-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 28px; touch-action: manipulation; border: 3px solid #333; background: white;">üîÑ</button>
                    </div>
                </div>
                
                <!-- Plansza gry (≈õrodek) -->
                <canvas id="tetris-canvas" style="border: 3px solid #333; background-color: #000; border-radius: 10px; max-width: calc(100% - 140px); max-height: calc(100% - 4px); z-index: 1;"></canvas>
                
                <!-- Przyciski po prawej stronie (65px, by≈Ço 50px) -->
                <div id="tetris-right-controls" style="display: none; position: absolute; right: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                    <div class="d-flex flex-column gap-2">
                        <button id="tetris-right-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñ∫</button>
                        <button id="tetris-down-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñº</button>
                    </div>
                </div>
            </div>
            
            <!-- Przycisk wyj≈õcia (8%) -->
            <div style="flex: 0 0 8%; display: flex; align-items: center; justify-content: center; padding: 5px;">
                <button id="tetris-exit-btn" class="btn btn-danger" style="width: 90%; max-width: 300px; height: 45px; font-weight: bold; display: none;">WYJD≈π Z GRY</button>
            </div>
        </div>
    </div>

    <!-- üéÆ WIDOK GRY ARKANOID -->
    <div id="arkanoid-game-view" style="display:none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #16213e; z-index: 1000;">
        <div class="d-flex flex-column" style="height: 100vh;">
            <!-- Nag≈Ç√≥wek (8%) -->
            <div class="text-center py-1 bg-dark text-white" style="flex: 0 0 8%; min-height: 60px; display: flex; flex-direction: column; justify-content: center;">
                <h5 class="mb-0" style="font-size: 1.1rem;">üèì ARKANOID</h5>
                <div class="d-flex justify-content-between align-items-center px-3">
                    <span id="arkanoid-player-name" style="font-size: 0.85rem;"></span>
                    <div>
                        <strong style="font-size: 0.9rem;">Punkty: <span id="arkanoid-score">0</span> / 20</strong>
                        <span style="margin-left: 15px; font-size: 1rem;" id="arkanoid-lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                    </div>
                </div>
            </div>
            
            <!-- Obszar gry z przyciskami po bokach (84%) -->
            <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 2px; position: relative;">
                <!-- Sekcja Start/Back (na ≈õrodku, przed rozpoczƒôciem gry) - BIA≈ÅE T≈ÅO -->
                <div id="arkanoid-start-section" class="text-center" style="position: absolute; z-index: 10; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <h4 class="mb-3" style="color: #333;">üèì Arkanoid Challenge</h4>
                    <p class="mb-4" style="color: #666;">Zbij ceg≈Çy i zdobƒÖd≈∫ 20 punkt√≥w!</p>
                    <div class="mb-3" style="color: #666; font-size: 0.9rem;">
                        <div>‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è Masz 3 ≈ºycia</div>
                        <div>Sterowanie: przyciski po bokach</div>
                    </div>
                    <button id="arkanoid-start-btn" class="btn btn-success btn-lg mb-3" style="width: 200px; font-weight: bold;">START GRY</button>
                    <br>
                    <button id="arkanoid-back-btn" class="btn btn-outline-secondary">‚Üê Wr√≥ƒá do gry</button>
                </div>
                
                <!-- Przyciski po lewej stronie (65px) -->
                <div id="arkanoid-left-controls" style="display: none; position: absolute; left: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                    <div class="d-flex flex-column gap-2">
                        <button id="arkanoid-left-btn" class="btn btn-light" style="width: 65px; height: 130px; font-size: 48px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚óÑ</button>
                    </div>
                </div>
                
                <!-- Plansza gry (≈õrodek) -->
                <canvas id="arkanoid-canvas" style="border: 3px solid #333; background-color: #1a1a2e; border-radius: 10px; max-width: calc(100% - 140px); max-height: calc(100% - 4px); z-index: 1;"></canvas>
                
                <!-- Przyciski po prawej stronie (65px) -->
                <div id="arkanoid-right-controls" style="display: none; position: absolute; right: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                    <div class="d-flex flex-column gap-2">
                        <button id="arkanoid-right-btn" class="btn btn-light" style="width: 65px; height: 130px; font-size: 48px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñ∫</button>
                    </div>
                </div>
            </div>
            
            <!-- Przycisk wyj≈õcia (8%) -->
            <div style="flex: 0 0 8%; display: flex; align-items: center; justify-content: center; padding: 5px;">
                <button id="arkanoid-exit-btn" class="btn btn-danger" style="width: 90%; max-width: 300px; height: 45px; font-weight: bold; display: none;">WYJD≈π Z GRY</button>
            </div>
        </div>
    </div>
</div>

<!-- üêç Snake game view -->
<div id="snake-game-view" style="display:none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #2d4a2b; z-index: 1000;">
    <div class="d-flex flex-column" style="height: 100vh;">
        <!-- Nag≈Ç√≥wek (8%) -->
        <div class="text-center py-1 bg-dark text-white" style="flex: 0 0 8%; min-height: 60px; display: flex; flex-direction: column; justify-content: center;">
            <h5 class="mb-0" style="font-size: 1.1rem;">üêç SNAKE</h5>
            <div class="d-flex justify-content-between align-items-center px-3">
                <span id="snake-player-name" style="font-size: 0.85rem;"></span>
                <strong style="font-size: 0.9rem;">Punkty: <span id="snake-score">0</span> / 20</strong>
            </div>
        </div>

        <!-- Obszar gry z przyciskami po bokach (84%) -->
        <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 2px; position: relative;">
            <!-- Sekcja Start/Back (na ≈õrodku, przed rozpoczƒôciem gry) - BIA≈ÅE T≈ÅO -->
            <div id="snake-start-section" class="text-center" style="position: absolute; z-index: 10; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <h4 class="mb-3" style="color: #333;">üêç Snake Challenge</h4>
                <p class="mb-4" style="color: #666;">Zbieraj jedzenie i zdobƒÖd≈∫ 20 punkt√≥w!</p>
                <div class="mb-3" style="color: #666; font-size: 0.9rem;">
                    <div>üéØ Unikaj ≈õcian i w≈Çasnego ogona</div>
                    <div>Sterowanie: przyciski po bokach</div>
                </div>
                <button id="snake-start-btn" class="btn btn-success btn-lg mb-3" style="width: 200px; font-weight: bold;">START GRY</button>
                <br>
                <button id="snake-back-btn" class="btn btn-outline-secondary">‚Üê Wr√≥ƒá do gry</button>
            </div>

            <!-- Przyciski po lewej stronie (65px) -->
            <div id="snake-left-controls" style="display: none; position: absolute; left: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                <div class="d-flex flex-column gap-2">
                    <button id="snake-up-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñ≤</button>
                    <button id="snake-left-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚óÑ</button>
                </div>
            </div>

            <!-- Plansza gry (≈õrodek) -->
            <canvas id="snake-canvas" style="border: 3px solid #333; background: #000; box-shadow: 0 0 15px rgba(0,0,0,0.5);"></canvas>

            <!-- Przyciski po prawej stronie (65px) -->
            <div id="snake-right-controls" style="display: none; position: absolute; right: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                <div class="d-flex flex-column gap-2">
                    <button id="snake-down-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñº</button>
                    <button id="snake-right-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñ∫</button>
                </div>
            </div>
        </div>

        <!-- Przycisk wyj≈õcia (8%) -->
        <div style="flex: 0 0 8%; display: flex; align-items: center; justify-content: center; padding: 5px;">
            <button id="snake-exit-btn" class="btn btn-danger" style="width: 90%; max-width: 300px; height: 45px; font-weight: bold; display: none;">WYJD≈π Z GRY</button>
        </div>
    </div>
</div>

<!-- ü¶ñ T-Rex game view -->
<div id="trex-game-view" style="display:none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #f7f7f7; z-index: 1000;">
    <div class="d-flex flex-column" style="height: 100vh;">
        <!-- Nag≈Ç√≥wek (8%) -->
        <div class="text-center py-1 bg-dark text-white" style="flex: 0 0 8%; min-height: 60px; display: flex; flex-direction: column; justify-content: center;">
            <h5 class="mb-0" style="font-size: 1.1rem;">ü¶ñ T-REX</h5>
            <div class="d-flex justify-content-between align-items-center px-3">
                <span id="trex-player-name" style="font-size: 0.85rem;"></span>
                <strong style="font-size: 0.9rem;">Punkty: <span id="trex-score">0</span> / 20</strong>
            </div>
        </div>

        <!-- Obszar gry (84%) -->
        <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 2px; position: relative;">
            <!-- Sekcja Start/Back (na ≈õrodku, przed rozpoczƒôciem gry) - BIA≈ÅE T≈ÅO -->
            <div id="trex-start-section" class="text-center" style="position: absolute; z-index: 10; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <h4 class="mb-3" style="color: #333;">ü¶ñ T-Rex Challenge</h4>
                <p class="mb-4" style="color: #666;">Unikaj przeszk√≥d i zdobƒÖd≈∫ 20 punkt√≥w!</p>
                <div class="mb-3" style="color: #666; font-size: 0.9rem;">
                    <div>üåµ Skacz nad kaktusami</div>
                    <div>ü¶Ö Unikaj ptak√≥w</div>
                    <div>Sterowanie: przycisk skoku</div>
                </div>
                <button id="trex-start-btn" class="btn btn-success btn-lg mb-3" style="width: 200px; font-weight: bold;">START GRY</button>
                <br>
                <button id="trex-back-btn" class="btn btn-outline-secondary">‚Üê Wr√≥ƒá do gry</button>
            </div>

            <!-- Plansza gry (≈õrodek) -->
            <canvas id="trex-canvas" style="border: 3px solid #535353; background: #f7f7f7; box-shadow: 0 0 15px rgba(0,0,0,0.2); max-width: calc(100% - 20px); max-height: calc(100% - 4px);"></canvas>

            <!-- Przycisk skoku (na dole) -->
            <div id="trex-jump-control" style="display: none; position: absolute; bottom: 20px; z-index: 5;">
                <button id="trex-jump-btn" class="btn btn-warning" style="width: 120px; height: 80px; font-size: 28px; touch-action: manipulation; border: 4px solid #333; background: #ffc107; line-height: 1; font-weight: bold;">SKOK ‚ñ≤</button>
            </div>
        </div>

        <!-- Przycisk wyj≈õcia (8%) -->
        <div style="flex: 0 0 8%; display: flex; align-items: center; justify-content: center; padding: 5px;">
            <button id="trex-exit-btn" class="btn btn-danger" style="width: 90%; max-width: 300px; height: 45px; font-weight: bold; display: none;">WYJD≈π Z GRY</button>
        </div>
    </div>
</div>

{% endblock %}
{% block scripts %}
{{ super() }}
<script src="https://cdn.socket.io/4.5.2/socket.io.min.js"></script>
<script src="{{ url_for('static', filename='tetris.js') }}"></script>
<script src="{{ url_for('static', filename='arkanoid.js') }}"></script>
<script src="{{ url_for('static', filename='snake.js') }}"></script>
<script src="{{ url_for('static', filename='trex.js') }}"></script>
<script src="{{ url_for('static', filename='js/player_main.js') }}"></script>
{% endblock %}
