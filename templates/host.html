{% extends 'base.html' %}
{% block title %}Panel Hosta - {{ event.name }}{% endblock %}

{% block styles %}
<meta charset="UTF-8">
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/host_styles.css') }}">
{% endblock %}

{% block content %}
<div class="container mt-4">
    {% if is_impersonated %}
    <div class="alert alert-warning d-flex justify-content-between align-items-center">
        <span data-translate="admin_impersonate">Jeste≈õ zalogowany jako Admin w panelu Hosta.</span>
        <a href="{{ url_for('logout_impersonate') }}" class="btn btn-sm btn-warning" data-translate="back_to_admin">Powr√≥t do panelu Admina</a>
    </div>
    {% endif %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="mb-0" data-translate="host_title">ORGANIZACJA GRY</h1>
            <h3 class="text-muted mb-0">{{ event.name }}</h3>
        </div>
        <a href="{{ url_for('display', event_id=event.id) }}" target="_blank" class="btn btn-outline-secondary" data-translate="open_display">Otw√≥rz Ekran Gry</a>
    </div>

    <ul class="nav nav-tabs mb-4" id="hostTabs">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#game" data-translate="tab_game">Gra</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#settings" data-translate="tab_settings">Ustawienia</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#timing" data-translate="tab_timing">Czas i tempo</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#players" data-translate="tab_players">Gracze</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#password" data-translate="tab_password">Has≈Ço</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#display" data-translate="tab_display">Wy≈õwietlacz</button></li>
        {% if is_superhost %}
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#qrcodes" data-translate="tab_qrcodes">Kody QR</button></li>
        {% endif %}
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#ar" data-translate="tab_ar">AR</button></li>
        <li class="nav-item"><button class="nav-link game-tab" data-bs-toggle="tab" data-bs-target="#questions" data-translate="tab_questions">Pytania runda 1</button></li>
        <li class="nav-item"><button class="nav-link game-tab" data-bs-toggle="tab" data-bs-target="#questions-r2">Pytania runda 2</button></li>
        <li class="nav-item"><button class="nav-link game-tab" data-bs-toggle="tab" data-bs-target="#questions-r3">Pytania runda 3</button></li>
        <li class="nav-item"><button class="nav-link game-tab" data-bs-toggle="tab" data-bs-target="#ai" data-translate="tab_ai">AI</button></li>
        <li class="nav-item"><button class="nav-link game-tab" data-bs-toggle="tab" data-bs-target="#fortune" data-translate="tab_fortune">Wr√≥≈ºka AI</button></li>
        <li class="nav-item"><button id="minigry-tab" class="nav-link game-tab" data-bs-toggle="tab" data-bs-target="#minigames" data-translate="tab_minigames">Minigry</button></li>
        <li class="nav-item"><button class="nav-link game-tab" data-bs-toggle="tab" data-bs-target="#photo" data-translate="tab_photo">Foto</button></li>
        <li class="nav-item"><button class="nav-link game-tab" data-bs-toggle="tab" data-bs-target="#voting" data-translate="tab_voting">G≈Çosowanie</button></li>
        <li class="nav-item"><button class="nav-link game-tab" data-bs-toggle="tab" data-bs-target="#live" data-translate="tab_live">Na ≈ºywo</button></li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="game">
            <!-- 1. INFORMACJE O GRZE (bez zmian) -->
            <div class="card mb-4">
                <div class="card-header"><h5 class="card-title mb-0" data-translate="game_info">Informacje o grze</h5></div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="player_count">Liczba graczy:</span> 
                                    <span id="info-player-count" class="badge bg-primary rounded-pill">0</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="completion_percentage">Procent uko≈Ñczenia:</span> 
                                    <span id="info-completion-percentage" class="badge bg-success rounded-pill">0%</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="language_host_label">Jƒôzyk prowadzƒÖcego:</span> 
                                    <span id="info-language" class="badge bg-secondary">Polski</span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-4">
                             <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="time_left">Czas do ko≈Ñca:</span> 
                                    <strong id="info-time-left">00:00</strong>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="time_net">Czas gry (netto):</span> 
                                    <span id="info-time-elapsed">00:00</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="time_gross">Czas gry (brutto):</span> 
                                    <span id="info-time-elapsed-pauses">00:00</span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-4">
                             <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="current_bonus">Aktualna premia:</span> 
                                    <span id="info-bonus" class="badge bg-success">Brak</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="current_speed">Aktualne tempo:</span> 
                                    <span id="info-speed" class="badge bg-info">x1</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span data-translate="game_status_label">Stan gry:</span> 
                                    <span id="info-game-status" class="status-waiting">Oczekiwanie na Start</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        
            <!-- 2. OBS≈ÅUGA GRY (nowa pozycja - pe≈Çna szeroko≈õƒá) -->
            <fieldset id="pre-game-settings">
                <div class="card mb-4">
                    <div class="card-header"><h5 class="card-title mb-0" data-translate="pre_game_settings">Obs≈Çuga gry</h5></div>
                    <div class="card-body">
                        <!-- Pierwszy rzƒÖd: g≈Ç√≥wne przyciski sterowania -->
                        <div class="row g-2 mb-3">
                            <div class="col-3">
                                <button id="start-game" class="btn btn-success w-100" data-translate="start_game">Start Gry</button>
                            </div>
                            <div class="col-3">
                                <button id="pause-btn" data-control="pause" class="btn btn-warning w-100" data-translate="pause">Pauza</button>
                            </div>
                            <div class="col-3">
                                <button id="stop-game" class="btn btn-danger w-100" data-translate="stop_game">Stop Gry</button>
                            </div>
                            <div class="col-3">
                                <button id="reset-game" class="btn btn-dark w-100" data-translate="reset_game">Reset Gry</button>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
        
            <!-- 3. POLE HAS≈ÅO (pe≈Çna szeroko≈õƒá, klikalne) -->
            <div class="card mb-4" id="password-preview-card">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="password_preview">Has≈Ço</h5>
                </div>
                <div class="card-body text-center">
                    <div id="game-password-display" 
                         class="d-flex flex-wrap gap-1 justify-content-center" 
                         style="font-size: 1.2rem; font-family: monospace;">
                        <!-- Litery bƒôdƒÖ generowane dynamicznie -->
                    </div>
                </div>
            </div>

            <!-- 3.5 POLE WY≈öWIETLACZ (pe≈Çna szeroko≈õƒá) -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="display_panel">Wy≈õwietlacz</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3" data-translate="display_panel_description">
                        Otw√≥rz ekrany gry lub przejd≈∫ do ustawie≈Ñ wy≈õwietlacza.
                    </p>
                    <div class="d-flex flex-wrap gap-2">
                        <button class="btn btn-primary" id="open-display-1-btn">
                            <i class="bi bi-display"></i> Otw√≥rz ekran gry 1
                        </button>
                        <button class="btn btn-primary" id="open-display-2-btn">
                            <i class="bi bi-display"></i> Otw√≥rz ekran gry 2
                        </button>
                        <button class="btn btn-primary" id="open-display-3-btn">
                            <i class="bi bi-display"></i> Otw√≥rz ekran gry 3
                        </button>
                        <button class="btn btn-primary" id="open-display-4-btn">
                            <i class="bi bi-display"></i> Otw√≥rz ekran gry 4
                        </button>
                        <button class="btn btn-secondary" id="open-display-settings-btn">
                            <i class="bi bi-gear"></i> <span data-translate="display_settings">Ustawienia</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 4. KOMUNIKATY NA EKRAN GRY (pe≈Çna szeroko≈õƒá) -->
            <div class="card mb-4">
                <div class="card-header"><h5 class="card-title mb-0" data-translate="host_messages">Komunikaty na ekran gry</h5></div>
                <div class="card-body">
                    <p class="text-muted small mb-3" data-translate="messages_description">
                        Wy≈õlij komunikat, kt√≥ry pojawi siƒô na g≈Ç√≥wnym ekranie gry. U≈ºyj tego, aby przekazaƒá wa≈ºne informacje wszystkim uczestnikom.
                    </p>
                    <div class="mb-3">
                        <label for="host-message-input" class="form-label" data-translate="message_label">Tre≈õƒá komunikatu (max 500 znak√≥w):</label>
                        <textarea class="form-control" id="host-message-input" rows="3" maxlength="500" placeholder="Wpisz komunikat..."></textarea>
                        <small class="text-muted">
                            <span id="message-char-count">0</span> / 500 znak√≥w
                        </small>
                    </div>
                    <button class="btn btn-primary" id="send-message-btn" data-translate="send_message">Wy≈õlij komunikat</button>
                    <div id="message-status" class="mt-2"></div>
                </div>
            </div>
                
            <!-- 5. TEMPO GRY ORAZ PUNKTACJA (pe≈Çna szeroko≈õƒá) -->
            <fieldset id="in-game-settings" disabled>
                <div class="card mb-4">
                    <div class="card-header"><h5 class="card-title mb-0" data-translate="in_game_settings">Tempo gry oraz punktacja</h5></div>
                    <div class="card-body" id="game-controls">
                        <label class="form-label" data-translate="time_speed">Tempo czasu:</label>
                        <div class="btn-group w-100 mb-3" role="group">
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="0.5">x0,5</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="1">x1</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="2">x2</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="10">x10</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="30">x30</button>
                        </div>
                        <label class="form-label" data-translate="points_bonus">Premia punktowa:</label>
                        <div class="btn-group w-100 mb-3" role="group">
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="1">x1</button>
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="2">x2</button>
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="3">x3</button>
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="10">x10</button>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>  <!-- ‚úÖ To musi mieƒá zamkniƒôcie -->

        <div class="tab-pane fade" id="settings">
            <!-- Dark Mode Toggle Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="appearance_settings">WyglƒÖd panelu</h5>
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 data-translate="appearance">Tryb wy≈õwietlania</h6>
                            <p class="text-muted small mb-0" data-translate="dark_mode_description">
                                Wybierz jasny lub ciemny tryb dla panelu hosta. Ciemny tryb wykorzystuje przyjemne dla oka barwy czarne i ciemnoszare.
                            </p>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center justify-content-end">
                                <span class="me-3 text-muted">Tryb jasny</span>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" role="switch" id="dark-mode-toggle" style="width: 4em; height: 2em;">
                                    <label class="form-check-label ms-3" for="dark-mode-toggle">
                                        <span id="dark-mode-status" class="badge bg-secondary">Wy≈ÇƒÖczony</span>
                                    </label>
                                </div>
                                <span class="ms-3 text-muted">Tryb ciemny</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Language Settings Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="language_tab">Ustawienia jƒôzyka</h5>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <h6 data-translate="player_language">Jƒôzyk graczy</h6>
                        <div class="btn-group w-100" role="group" id="lang-player-controls">
                            <button type="button" class="btn btn-outline-primary active-modifier" data-control="language_player" data-value="pl" data-translate="lang_polish">Jƒôzyk polski</button>
                            <button type="button" class="btn btn-outline-primary" data-control="language_player" data-value="en" data-translate="lang_english">Jƒôzyk angielski</button>
                            <button type="button" class="btn btn-outline-primary" data-control="language_player" data-value="de" data-translate="lang_german">Jƒôzyk niemiecki</button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <h6 data-translate="host_language">Jƒôzyk prowadzƒÖcego</h6>
                        <div class="btn-group w-100" role="group" id="lang-host-controls">
                            <button type="button" class="btn btn-outline-primary active-modifier" data-control="language_host" data-value="pl" data-translate="lang_polish">Jƒôzyk polski</button>
                            <button type="button" class="btn btn-outline-primary" data-control="language_host" data-value="en" data-translate="lang_english">Jƒôzyk angielski</button>
                            <button type="button" class="btn btn-outline-primary" data-control="language_host" data-value="de" data-translate="lang_german">Jƒôzyk niemiecki</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        {% if is_superhost %}
        <div class="tab-pane fade" id="qrcodes">
            <!-- Kod QR Gracza -->
            <div class="card mx-auto mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">üì± Kod QR Gracza</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-success">
                        <strong>‚ÑπÔ∏è Instrukcja:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Ten kod QR pozwala graczom do≈ÇƒÖczyƒá do gry</li>
                            <li>Gracz skanuje kod, wpisuje swoje imiƒô i otrzymuje dostƒôp do panelu</li>
                            <li>Wydrukuj i umie≈õƒá kod w widocznym miejscu</li>
                        </ul>
                    </div>

                    <div class="d-grid gap-2">
                        <a href="/player_qr_preview/{{ event.id }}" target="_blank" class="btn btn-success btn-lg">
                            üîç PodglƒÖd i Druk Kodu QR
                        </a>
                    </div>
                </div>
            </div>

        </div>
        {% endif %}

        <div class="tab-pane fade" id="password">
            <div class="card mb-3">
                <div class="card-header"><h5 class="card-title mb-0">1. Edycja has≈Ça</h5></div>
                <div class="card-body">
                    <p class="text-muted small">Wpisz has≈Ço, kt√≥re gracze bƒôdƒÖ ods≈Çaniaƒá podczas gry (mo≈ºliwe tylko przed startem gry).</p>
                    <div class="input-group">
                        <input type="text" class="form-control" id="password-edit-input" maxlength="50" placeholder="np. SAPEREVENT" value="SAPEREVENT">
                        <button class="btn btn-primary" id="password-edit-ok-btn">OK</button>
                    </div>
                    <small class="text-muted">Max 50 znak√≥w. Spacje sƒÖ dozwolone.</small>
                    <div id="password-edit-status" class="mt-2"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><h5 class="card-title mb-0">2. Kontrola has≈Ça</h5></div>
                <div class="card-body">
                    <p class="text-muted small">ZarzƒÖdzaj odkrywaniem liter has≈Ça. Odkrywanie rƒôczne jest zawsze dostƒôpne.</p>
                    
                    <!-- Prze≈ÇƒÖcznik automatycznego odkrywania -->
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="form-label fw-bold mb-0">Odkrywanie automatyczne:</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="password-auto-reveal-toggle"
                                       style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="password-auto-reveal-toggle">
                                    <span id="auto-reveal-status" class="badge bg-success">W≈ÇƒÖczone</span>
                                </label>
                            </div>
                        </div>

                        <!-- Ustawienie procentu odkrywania -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">Udzia≈Ç % gry do aktywacji litery:</label>
                            <div class="input-group" style="max-width: 200px;">
                                <input type="number" class="form-control" id="auto-reveal-percentage"
                                       min="1" max="100" value="50" step="1">
                                <span class="input-group-text">%</span>
                            </div>
                            <small class="text-muted d-block mt-1">
                                Gdy gracz zdobƒôdzie ten procent punkt√≥w z puli, odkryje losowƒÖ literƒô.<br>
                                Przyk≈Çad: max punkt√≥w 400, ustawienie 10% = odkrycie litery co 40 punkt√≥w.
                            </small>
                        </div>

                        <small class="text-muted d-block">
                            Gdy w≈ÇƒÖczone: litery odkrywane automatycznie wed≈Çug powy≈ºszego ustawienia (oznaczone na zielono).<br>
                            Odkrywanie rƒôczne jest zawsze dostƒôpne niezale≈ºnie od ustawienia.
                        </small>
                    </div>

                    <hr>

                    <!-- Sekcja odkrywania has≈Ça -->
                    <h6 class="mb-3">Has≈Ço do ods≈Çoniƒôcia:</h6>
                    <p class="text-muted small mb-3">
                        üü¢ Zielone - ods≈Çoniƒôte | üî¥ Czerwone - zakryte<br>
                        Kliknij na czerwonƒÖ literƒô, aby jƒÖ ods≈Çoniƒá rƒôcznie. Ka≈ºda litera jest traktowana indywidualnie.
                    </p>
                    <div id="password-letters-display" class="d-flex flex-wrap gap-2 justify-content-center mb-3" style="font-size: 1.8rem; font-family: monospace;">
                        <!-- Litery bƒôdƒÖ generowane dynamicznie -->
                    </div>
                    <button class="btn btn-success w-100" id="reveal-selected-letters-btn" disabled>
                        Potwierd≈∫ ods≈Çoniƒôcie wybranych liter
                    </button>
                    <div id="password-reveal-status" class="mt-2"></div>
                </div>
            </div>
        </div>
        
        <div class="tab-pane fade" id="players">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="players_management">ZarzƒÖdzanie graczami</h5>
                </div>
                <div class="card-body">
                    <div id="players-list"></div>
                </div>
            </div>

            <!-- Sekcja zabezpiecze≈Ñ rejestracji -->
            <div class="card mb-3 mt-3">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">üîí Zabezpieczenia Rejestracji</h5>
                    <button class="btn btn-sm btn-info" onclick="loadSecurityStats()">üîÑ Od≈õwie≈º</button>
                </div>
                <div class="card-body">
                    <!-- Ustawienia limit√≥w -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label class="form-label">
                                <strong>Limit graczy z jednego IP:</strong>
                                <small class="text-muted">(dla WiFi publicznego)</small>
                            </label>
                            <input type="number" id="limit-ip" class="form-control" min="1" max="20" value="3">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">
                                <strong>Limit graczy z jednego urzƒÖdzenia:</strong>
                                <small class="text-muted">(fingerprint)</small>
                            </label>
                            <input type="number" id="limit-device" class="form-control" min="1" max="5" value="1">
                        </div>
                    </div>

                    <button class="btn btn-primary mb-3" onclick="updateSecurityLimits()">üíæ Zapisz Limity</button>

                    <!-- Statystyki -->
                    <div id="security-stats" class="mt-3">
                        <div class="text-center text-muted">
                            <p>Kliknij "Od≈õwie≈º" aby zobaczyƒá statystyki</p>
                        </div>
                    </div>

                    <!-- Akcje czyszczenia -->
                    <div class="mt-4 border-top pt-3">
                        <h6>üßπ Czyszczenie Duplikat√≥w</h6>
                        <div class="btn-group" role="group">
                            <button class="btn btn-warning" onclick="cleanupDuplicates('fingerprint')">
                                Usu≈Ñ duplikaty urzƒÖdze≈Ñ
                            </button>
                            <button class="btn btn-warning" onclick="cleanupDuplicates('ip')">
                                Usu≈Ñ duplikaty IP
                            </button>
                            <button class="btn btn-danger" onclick="cleanupDuplicates('both')">
                                Usu≈Ñ wszystkie duplikaty
                            </button>
                        </div>
                        <small class="d-block mt-2 text-muted">
                            ‚ö†Ô∏è Pozostawi tylko graczy z najwy≈ºszym wynikiem
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="questions">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0" data-translate="questions_management">ZarzƒÖdzanie pytaniami</h5>
                    <button class="btn btn-primary" id="add-question-btn" data-translate="add_question">Dodaj pytanie</button>
                </div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="questions-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="questions-enabled">
                                    <span id="questions-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli skanowaƒá bia≈Çych kod√≥w QR do pyta≈Ñ</small>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>

                            <!-- Kody QR dla ≈Çatwych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-success mb-2">≈Åatwe pytania:</h6>
                                <button id="questions-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈Çatwych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="questions-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ</button>
                                    <button id="questions-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈Çatwych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla ≈õrednich pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-warning mb-2">≈örednie pytania:</h6>
                                <button id="questions-medium-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈õrednich pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="questions-medium-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ</button>
                                    <button id="questions-medium-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈õrednich pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla trudnych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-danger mb-2">Trudne pytania:</h6>
                                <button id="questions-hard-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla trudnych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="questions-hard-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ</button>
                                    <button id="questions-hard-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla trudnych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla mieszanych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-info mb-2">Mieszane pytania:</h6>
                                <button id="questions-mixed-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla mieszanych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="questions-mixed-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ</button>
                                    <button id="questions-mixed-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla mieszanych pyta≈Ñ</button>
                                </div>
                            </div>

                            <small class="text-muted d-block mt-2">Zapasowe kody QR mogƒÖ byƒá u≈ºyte jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia gry</h6>

                            <!-- Punkty za ≈Çatwe pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈Çatwe pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="questions-easy-points" value="5" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateQuestionsSetting('easy_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 5 punkt√≥w</small>
                            </div>

                            <!-- Punkty za ≈õrednie pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈õrednie pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="questions-medium-points" value="10" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateQuestionsSetting('medium_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 10 punkt√≥w</small>
                            </div>

                            <!-- Punkty za trudne pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na trudne pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="questions-hard-points" value="15" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateQuestionsSetting('hard_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 15 punkt√≥w</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div id="questions-list"></div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="ai">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Kategorie AI - Pytania generowane automatycznie</h5>
                    <p class="text-muted mb-0 mt-2 small">Gracze po zeskanowaniu bia≈Çego kodu QR otrzymujƒÖ pytania z wybranej kategorii. Za poprawnƒÖ odpowied≈∫: 5 punkt√≥w.</p>
                </div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="ai-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="ai-enabled">
                                    <span id="ai-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli skanowaƒá bia≈Çych kod√≥w QR do pyta≈Ñ AI</small>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>

                            <!-- Kody QR dla ≈Çatwych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-success mb-2">≈Åatwe pytania:</h6>
                                <button id="ai-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈Çatwych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="ai-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ</button>
                                    <button id="ai-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈Çatwych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla ≈õrednich pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-warning mb-2">≈örednie pytania:</h6>
                                <button id="ai-medium-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈õrednich pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="ai-medium-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ</button>
                                    <button id="ai-medium-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈õrednich pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla trudnych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-danger mb-2">Trudne pytania:</h6>
                                <button id="ai-hard-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla trudnych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="ai-hard-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ</button>
                                    <button id="ai-hard-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla trudnych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla mieszanych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-info mb-2">Mieszane pytania:</h6>
                                <button id="ai-mixed-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla mieszanych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="ai-mixed-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ</button>
                                    <button id="ai-mixed-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla mieszanych pyta≈Ñ</button>
                                </div>
                            </div>

                            <small class="text-muted d-block mt-2">Zapasowe kody QR mogƒÖ byƒá u≈ºyte jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia gry</h6>

                            <!-- Punkty za ≈Çatwe pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈Çatwe pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="ai-easy-points" value="5" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateAISetting('easy_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 5 punkt√≥w</small>
                            </div>

                            <!-- Punkty za ≈õrednie pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈õrednie pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="ai-medium-points" value="10" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateAISetting('medium_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 10 punkt√≥w</small>
                            </div>

                            <!-- Punkty za trudne pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na trudne pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="ai-hard-points" value="15" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateAISetting('hard_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 15 punkt√≥w</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <h6 class="mb-3">Dodaj kategoriƒô:</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label for="custom-category-name" class="form-label">Nazwa kategorii</label>
                            <input type="text" class="form-control" id="custom-category-name" placeholder="np. Film, Geografia, Medycyna">
                        </div>
                        <div class="col-md-4">
                            <label for="custom-category-difficulty" class="form-label">Poziom trudno≈õci</label>
                            <select class="form-select" id="custom-category-difficulty">
                                <option value="easy">≈Åatwy</option>
                                <option value="medium">≈öredni</option>
                                <option value="advanced">Zaawansowany</option>
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button class="btn btn-success w-100" id="add-custom-category-btn">Dodaj kategoriƒô</button>
                        </div>
                    </div>

                    <hr>

                    <h6 class="mb-3">Twoje kategorie:</h6>
                    <div id="ai-categories-list"></div>
                </div>
            </div>
        </div>

        <!-- Pytania Runda 2 -->
        <div class="tab-pane fade" id="questions-r2">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">ZarzƒÖdzanie pytaniami - Runda 2</h5>
                    <button class="btn btn-primary" id="r2-add-question-btn">Dodaj pytanie</button>
                </div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="r2-questions-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="r2-questions-enabled">
                                    <span id="r2-questions-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli skanowaƒá bia≈Çych kod√≥w QR do pyta≈Ñ</small>

                            <!-- Timer do automatycznego uruchomienia -->
                            <div class="mt-3">
                                <label class="form-label"><strong>Czas do uruchomienia:</strong></label>
                                <div class="input-group" style="max-width: 400px;">
                                    <input type="number" class="form-control" id="r2-questions-timer-minutes" placeholder="Minuty" min="1" max="1440">
                                    <button class="btn btn-primary" onclick="startR2QuestionsTimer()">OK</button>
                                    <button class="btn btn-danger" onclick="cancelR2QuestionsTimer()" id="r2-questions-timer-cancel" style="display: none;">Anuluj</button>
                                </div>
                                <div id="r2-questions-timer-display" class="mt-2" style="display: none;">
                                    <span class="badge bg-info">Timer aktywny: <span id="r2-questions-timer-countdown"></span></span>
                                </div>
                                <small class="text-muted">Pytania zostanƒÖ automatycznie uruchomione po okre≈õlonym czasie</small>
                            </div>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>

                            <!-- Prze≈ÇƒÖczniki -->
                            <div class="mb-3">
                                <div class="form-check form-switch mb-2">
                                    <input class="form-check-input" type="checkbox" id="r2-use-round1-qr" onchange="toggleR2Round1QR()">
                                    <label class="form-check-label" for="r2-use-round1-qr">
                                        <strong>QR z Pytania runda 1</strong>
                                    </label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="r2-disable-other-rounds" disabled onchange="toggleR2DisableOtherRounds()">
                                    <label class="form-check-label" for="r2-disable-other-rounds">
                                        <strong>Wy≈ÇƒÖcz pytania z innych rund</strong>
                                        <small class="text-muted d-block">Po zczytaniu QR gracz nie ma dostƒôpu do pyta≈Ñ z rundy 1</small>
                                    </label>
                                </div>
                            </div>

                            <!-- Kody QR dla ≈Çatwych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-success mb-2">≈Åatwe pytania:</h6>
                                <button id="r2-questions-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈Çatwych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r2-questions-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ</button>
                                    <button id="r2-questions-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈Çatwych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla ≈õrednich pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-warning mb-2">≈örednie pytania:</h6>
                                <button id="r2-questions-medium-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈õrednich pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r2-questions-medium-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ</button>
                                    <button id="r2-questions-medium-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈õrednich pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla trudnych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-danger mb-2">Trudne pytania:</h6>
                                <button id="r2-questions-hard-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla trudnych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r2-questions-hard-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ</button>
                                    <button id="r2-questions-hard-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla trudnych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla mieszanych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-info mb-2">Mieszane pytania:</h6>
                                <button id="r2-questions-mixed-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla mieszanych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r2-questions-mixed-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ</button>
                                    <button id="r2-questions-mixed-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla mieszanych pyta≈Ñ</button>
                                </div>
                            </div>

                            <small class="text-muted d-block mt-2">Zapasowe kody QR mogƒÖ byƒá u≈ºyte jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia gry</h6>

                            <!-- Punkty za ≈Çatwe pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈Çatwe pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="r2-questions-easy-points" value="5" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateR2QuestionsSetting('easy_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 5 punkt√≥w</small>
                            </div>

                            <!-- Punkty za ≈õrednie pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈õrednie pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="r2-questions-medium-points" value="10" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateR2QuestionsSetting('medium_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 10 punkt√≥w</small>
                            </div>

                            <!-- Punkty za trudne pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na trudne pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="r2-questions-hard-points" value="15" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateR2QuestionsSetting('hard_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 15 punkt√≥w</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div id="r2-questions-list"></div>
                </div>
            </div>
        </div>

        <!-- Pytania Runda 3 -->
        <div class="tab-pane fade" id="questions-r3">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">ZarzƒÖdzanie pytaniami - Runda 3</h5>
                    <button class="btn btn-primary" id="r3-add-question-btn">Dodaj pytanie</button>
                </div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="r3-questions-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="r3-questions-enabled">
                                    <span id="r3-questions-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli skanowaƒá bia≈Çych kod√≥w QR do pyta≈Ñ</small>

                            <!-- Timer do automatycznego uruchomienia -->
                            <div class="mt-3">
                                <label class="form-label"><strong>Czas do uruchomienia:</strong></label>
                                <div class="input-group" style="max-width: 400px;">
                                    <input type="number" class="form-control" id="r3-questions-timer-minutes" placeholder="Minuty" min="1" max="1440">
                                    <button class="btn btn-primary" onclick="startR3QuestionsTimer()">OK</button>
                                    <button class="btn btn-danger" onclick="cancelR3QuestionsTimer()" id="r3-questions-timer-cancel" style="display: none;">Anuluj</button>
                                </div>
                                <div id="r3-questions-timer-display" class="mt-2" style="display: none;">
                                    <span class="badge bg-info">Timer aktywny: <span id="r3-questions-timer-countdown"></span></span>
                                </div>
                                <small class="text-muted">Pytania zostanƒÖ automatycznie uruchomione po okre≈õlonym czasie</small>
                            </div>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>

                            <!-- Prze≈ÇƒÖczniki -->
                            <div class="mb-3">
                                <div class="form-check form-switch mb-2">
                                    <input class="form-check-input" type="checkbox" id="r3-use-round1-qr" onchange="toggleR3Round1QR()">
                                    <label class="form-check-label" for="r3-use-round1-qr">
                                        <strong>QR z Pytania runda 1</strong>
                                    </label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="r3-disable-other-rounds" disabled onchange="toggleR3DisableOtherRounds()">
                                    <label class="form-check-label" for="r3-disable-other-rounds">
                                        <strong>Wy≈ÇƒÖcz pytania z innych rund</strong>
                                        <small class="text-muted d-block">Po zczytaniu QR gracz nie ma dostƒôpu do pyta≈Ñ z rund 1 i 2</small>
                                    </label>
                                </div>
                            </div>

                            <!-- Kody QR dla ≈Çatwych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-success mb-2">≈Åatwe pytania:</h6>
                                <button id="r3-questions-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈Çatwych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r3-questions-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈Çatwych pyta≈Ñ</button>
                                    <button id="r3-questions-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈Çatwych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla ≈õrednich pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-warning mb-2">≈örednie pytania:</h6>
                                <button id="r3-questions-medium-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla ≈õrednich pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r3-questions-medium-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla ≈õrednich pyta≈Ñ</button>
                                    <button id="r3-questions-medium-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla ≈õrednich pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla trudnych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-danger mb-2">Trudne pytania:</h6>
                                <button id="r3-questions-hard-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla trudnych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r3-questions-hard-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla trudnych pyta≈Ñ</button>
                                    <button id="r3-questions-hard-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla trudnych pyta≈Ñ</button>
                                </div>
                            </div>

                            <!-- Kody QR dla mieszanych pyta≈Ñ -->
                            <div class="mb-3">
                                <h6 class="text-info mb-2">Mieszane pytania:</h6>
                                <button id="r3-questions-mixed-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR dla mieszanych pyta≈Ñ</button>

                                <div class="d-flex gap-2 mt-2">
                                    <button id="r3-questions-mixed-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR dla mieszanych pyta≈Ñ</button>
                                    <button id="r3-questions-mixed-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR dla mieszanych pyta≈Ñ</button>
                                </div>
                            </div>

                            <small class="text-muted d-block mt-2">Zapasowe kody QR mogƒÖ byƒá u≈ºyte jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia gry</h6>

                            <!-- Punkty za ≈Çatwe pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈Çatwe pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="r3-questions-easy-points" value="5" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateR3QuestionsSetting('easy_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 5 punkt√≥w</small>
                            </div>

                            <!-- Punkty za ≈õrednie pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na ≈õrednie pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="r3-questions-medium-points" value="10" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateR3QuestionsSetting('medium_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 10 punkt√≥w</small>
                            </div>

                            <!-- Punkty za trudne pytanie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za jednƒÖ poprawnƒÖ odpowied≈∫ na trudne pytanie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="r3-questions-hard-points" value="15" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateR3QuestionsSetting('hard_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 15 punkt√≥w</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div id="r3-questions-list"></div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="minigames">
            <div class="card">
                <div class="card-header"><h5 class="card-title mb-0">ZarzƒÖdzanie minigrami</h5></div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="minigames-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="minigames-enabled">
                                    <span id="minigames-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli skanowaƒá zielonych kod√≥w QR do minigier</small>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>
                            <button id="minigames-qr-btn" class="btn btn-primary mb-3 w-100">üì± PodglƒÖd i druk kodu QR</button>

                            <div class="d-flex gap-2 mt-3">
                                <button id="minigames-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR</button>
                                <button id="minigames-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR</button>
                            </div>
                            <small class="text-muted d-block mt-2">Zapasowy kod QR mo≈ºe byƒá u≈ºyty jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia gry</h6>

                            <!-- Punkty za przej≈õcie gry -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za przej≈õcie gry:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="minigame-completion-points" value="10" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateMinigameSetting('completion_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 10 punkt√≥w</small>
                            </div>

                            <!-- Punkty do zdobycia w grze -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w do zdobycia w grze:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="minigame-target-points" value="20" min="1" max="200">
                                    <button class="btn btn-primary" onclick="updateMinigameSetting('target_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 20 punkt√≥w (pod tƒô warto≈õƒá gry sƒÖ zoptymalizowane)</small>
                            </div>

                            <!-- Prze≈ÇƒÖcznik wyboru gry -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Wyb√≥r gry:</strong></label>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="minigame-player-choice" style="width: 3em; height: 1.5em;">
                                    <label class="form-check-label ms-2" for="minigame-player-choice">
                                        <span id="minigame-choice-status" class="badge bg-secondary">Losowa kolejno≈õƒá</span>
                                    </label>
                                </div>
                                <small class="text-muted">Gdy w≈ÇƒÖczone, gracz po zeskanowaniu kodu QR bƒôdzie m√≥g≈Ç wybraƒá grƒô. Gdy wy≈ÇƒÖczone, gry uruchamiajƒÖ siƒô w losowej kolejno≈õci.</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div class="alert alert-info" id="minigames-info-alert">
                        <strong>Informacja:</strong> Minigry aktywowane przez zielone kody QR.
                        Ka≈ºda minigra wymaga zdobycia <span id="minigame-target-display">20</span> punkt√≥w, aby otrzymaƒá nagrodƒô <span id="minigame-completion-display">10</span> punkt√≥w.
                    </div>
                    
                    <!-- TETRIS -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1">üéÆ Tetris</h5>
                                    <p class="text-muted mb-0">Cel: 20 punkt√≥w (u≈Ç√≥≈º linie)</p>
                                    <small class="text-muted">Sterowanie: strza≈Çki + obr√≥t</small>
                                </div>
                                <div class="d-flex gap-2 align-items-center">
                                    <button class="btn btn-sm btn-info" id="tetris-test-btn">Test</button>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" id="tetris-toggle"
                                               style="width: 3em; height: 1.5em;">
                                        <label class="form-check-label ms-2" for="tetris-toggle">
                                            <span id="tetris-status" class="badge bg-secondary">Nieaktywny</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
        
                    <!-- ARKANOID -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1">üèì Arkanoid</h5>
                                    <p class="text-muted mb-0">Cel: 20 punkt√≥w (zbij ceg≈Çy)</p>
                                    <small class="text-muted">3 ≈ºycia | Sterowanie: przyciski ‚óÑ ‚ñ∫</small>
                                </div>
                                <div class="d-flex gap-2 align-items-center">
                                    <button class="btn btn-sm btn-info" id="arkanoid-test-btn">Test</button>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" id="arkanoid-toggle"
                                               style="width: 3em; height: 1.5em;">
                                        <label class="form-check-label ms-2" for="arkanoid-toggle">
                                            <span id="arkanoid-status" class="badge bg-secondary">Nieaktywny</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SNAKE -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1">üêç Snake</h5>
                                    <p class="text-muted mb-0">Cel: 20 punkt√≥w (zbieraj jedzenie)</p>
                                    <small class="text-muted">Sterowanie: przyciski ‚ñ≤ ‚ñº ‚óÑ ‚ñ∫</small>
                                </div>
                                <div class="d-flex gap-2 align-items-center">
                                    <button class="btn btn-sm btn-info" id="snake-test-btn">Test</button>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" id="snake-toggle"
                                               style="width: 3em; height: 1.5em;">
                                        <label class="form-check-label ms-2" for="snake-toggle">
                                            <span id="snake-status" class="badge bg-secondary">Nieaktywny</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- T-REX -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1">ü¶ñ T-Rex</h5>
                                    <p class="text-muted mb-0">Cel: 20 punkt√≥w (unikaj przeszk√≥d)</p>
                                    <small class="text-muted">Sterowanie: przycisk skoku</small>
                                </div>
                                <div class="d-flex gap-2 align-items-center">
                                    <button class="btn btn-sm btn-info" id="trex-test-btn">Test</button>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" id="trex-toggle"
                                               style="width: 3em; height: 1.5em;">
                                        <label class="form-check-label ms-2" for="trex-toggle">
                                            <span id="trex-status" class="badge bg-secondary">Nieaktywny</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-warning mt-3" id="minigames-info" style="display: none;"></div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="photo">
            <div class="card">
                <div class="card-header"><h5 class="card-title mb-0" data-translate="photo_tab">Galeria zdjƒôƒá</h5></div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="photo-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="photo-enabled">
                                    <span id="photo-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli robiƒá i przesy≈Çaƒá zdjƒôƒá</small>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>
                            <button id="photo-qr-btn" class="btn btn-primary mb-3 w-100">üì± PodglƒÖd i druk kodu QR</button>

                            <div class="d-flex gap-2 mt-3">
                                <button id="photo-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR</button>
                                <button id="photo-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR</button>
                            </div>
                            <small class="text-muted d-block mt-2">Zapasowy kod QR mo≈ºe byƒá u≈ºyty jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia gry</h6>

                            <!-- Punkty za wykonane zdjƒôcie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za wykonane zdjƒôcie selfie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="photo-selfie-points" value="30" min="1" max="1000">
                                    <button class="btn btn-primary" onclick="updatePhotoSetting('selfie_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 30 punkt√≥w</small>
                            </div>

                            <!-- Punkty za polubienie -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za polubienie czyjego≈õ zdjƒôcia selfie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="photo-like-given-points" value="2" min="0" max="100">
                                    <button class="btn btn-primary" onclick="updatePhotoSetting('like_given_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 2 punkty</small>
                            </div>

                            <!-- Punkty za uzyskanie polubienia -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za uzyskanie polubienia (like) dla zdjƒôcia selfie:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="photo-like-received-points" value="5" min="0" max="100">
                                    <button class="btn btn-primary" onclick="updatePhotoSetting('like_received_points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 5 punkt√≥w</small>
                            </div>

                            <!-- Maksymalna liczba polubie≈Ñ -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Maksymalna liczba zdjƒôƒá selfie do polubienia:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="photo-max-likes" value="10" min="1" max="1000">
                                    <button class="btn btn-primary" onclick="updatePhotoSetting('max_likes')">OK</button>
                                </div>
                                <small class="text-muted">Ile jeden uczestnik mo≈ºe polubiƒá maksymalnie zdjƒôƒá innych graczy</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <h6>Galeria zdjƒôƒá graczy</h6>
                    <p data-translate="photo_description" class="text-muted">Poni≈ºej zdjƒôcia przes≈Çane przez graczy, posortowane wed≈Çug liczby polubie≈Ñ.</p>

                    <div id="host-photo-gallery" class="row g-3 mt-3">
                        <!-- Zdjƒôcia bƒôdƒÖ tutaj ≈Çadowane dynamicznie -->
                    </div>

                    <div id="no-photos-message" class="alert alert-info text-center mt-3" style="display: none;">
                        <p class="mb-0">Brak zdjƒôƒá. Gracze mogƒÖ przesy≈Çaƒá zdjƒôcia skanujƒÖc kod QR powy≈ºej.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="voting">
            <div class="card">
                <div class="card-header"><h5 class="card-title mb-0" data-translate="voting_tab">G≈Çosowanie</h5></div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="voting-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="voting-enabled">
                                    <span id="voting-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli g≈Çosowaƒá</small>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>

                            <!-- G≈Ç√≥wny kod QR -->
                            <button id="voting-qr-btn" class="btn btn-primary mb-2 w-100">üì± PodglƒÖd i druk kodu QR</button>

                            <div class="d-flex gap-2 mt-2 mb-3">
                                <button id="voting-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR</button>
                                <button id="voting-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR</button>
                            </div>

                            <!-- Wy≈õlij na ekran 5 -->
                            <button id="voting-send-to-screen5-btn" class="btn btn-info w-100">üì∫ Wy≈õlij kod na ekran numer 5</button>

                            <small class="text-muted d-block mt-2">Zapasowy kod QR mo≈ºe byƒá u≈ºyty jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia</h6>
                            <p class="text-muted">Tutaj bƒôdƒÖ ustawienia g≈Çosowania</p>
                        </div>
                    </div>

                    <!-- Pytania i odpowiedzi -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Pytania i odpowiedzi</h6>

                            <!-- Przycisk dodaj propozycjƒô -->
                            <button class="btn btn-success mb-3" id="voting-add-question-btn">
                                <i class="bi bi-plus-circle"></i> Dodaj propozycjƒô
                            </button>

                            <!-- Formularz dodawania pytania (ukryty domy≈õlnie) -->
                            <div id="voting-question-form" class="border rounded p-3 mb-3" style="display: none; background: white;">
                                <h6 class="mb-3">Nowe pytanie/propozycja</h6>

                                <!-- Pole pytania -->
                                <div class="mb-3">
                                    <label class="form-label"><strong>Pytanie/Propozycja:</strong></label>
                                    <input type="text" class="form-control" id="voting-question-text" placeholder="Wpisz pytanie lub propozycjƒô...">
                                </div>

                                <!-- Pola odpowiedzi -->
                                <div class="mb-3">
                                    <label class="form-label"><strong>Odpowiedzi/Wybory:</strong></label>
                                    <div id="voting-answers-container">
                                        <div class="input-group mb-2 voting-answer-item">
                                            <span class="input-group-text">1</span>
                                            <input type="text" class="form-control voting-answer-input" placeholder="Odpowied≈∫ 1">
                                            <button class="btn btn-danger voting-remove-answer-btn" type="button" style="display: none;">√ó</button>
                                        </div>
                                        <div class="input-group mb-2 voting-answer-item">
                                            <span class="input-group-text">2</span>
                                            <input type="text" class="form-control voting-answer-input" placeholder="Odpowied≈∫ 2">
                                            <button class="btn btn-danger voting-remove-answer-btn" type="button" style="display: none;">√ó</button>
                                        </div>
                                    </div>
                                    <button class="btn btn-sm btn-outline-primary" id="voting-add-answer-btn">
                                        + Dodaj nowe pole
                                    </button>
                                </div>

                                <!-- Typ wyboru -->
                                <div class="mb-3">
                                    <label class="form-label"><strong>Typ wyboru:</strong></label>
                                    <div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="voting-choice-type" id="voting-single-choice" value="single" checked>
                                            <label class="form-check-label" for="voting-single-choice">Tylko jeden wyb√≥r</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="voting-choice-type" id="voting-multiple-choice" value="multiple">
                                            <label class="form-check-label" for="voting-multiple-choice">Wielokrotny wyb√≥r</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Czas -->
                                <div class="mb-3">
                                    <label class="form-label"><strong>Czas na g≈Çosowanie:</strong></label>
                                    <div class="input-group" style="max-width: 300px;">
                                        <input type="number" class="form-control" id="voting-time-value" value="60" min="10" max="3600">
                                        <select class="form-select" id="voting-time-unit" style="max-width: 120px;">
                                            <option value="seconds">Sekundy</option>
                                            <option value="minutes">Minuty</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Wynik -->
                                <div class="mb-3">
                                    <label class="form-label"><strong>Wynik:</strong></label>
                                    <div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="voting-result-type" id="voting-result-auto" value="auto" checked>
                                            <label class="form-check-label" for="voting-result-auto">Od razu (Auto)</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="voting-result-type" id="voting-result-manual" value="manual">
                                            <label class="form-check-label" for="voting-result-manual">Na ≈ºyczenie (Manual)</label>
                                        </div>
                                    </div>
                                    <small class="text-muted">Auto: wyniki widoczne od razu po up≈Çywie czasu. Manual: wyniki widoczne po aktywacji przez hosta.</small>
                                </div>

                                <!-- Przyciski -->
                                <div class="d-flex gap-2">
                                    <button class="btn btn-primary" id="voting-submit-question-btn">
                                        <i class="bi bi-check-circle"></i> Zatwierd≈∫
                                    </button>
                                    <button class="btn btn-secondary" id="voting-cancel-question-btn">
                                        Anuluj
                                    </button>
                                </div>
                            </div>

                            <!-- Lista pyta≈Ñ -->
                            <div id="voting-questions-list">
                                <!-- Tutaj bƒôdƒÖ wy≈õwietlane dodane pytania -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="live">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="live_tab">Na ≈ºywo</h5>
                    <p class="text-muted mb-0 mt-2 small">Spontaniczna rozgrywka prowadzona przez konferansjera ze sceny. Gracze odpowiadajƒÖ na pytania w czasie rzeczywistym.</p>
                </div>
                <div class="card-body">
                    <!-- Stan gry - prze≈ÇƒÖcznik -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="live-enabled" style="width: 3em; height: 1.5em;" checked>
                                <label class="form-check-label ms-2" for="live-enabled">
                                    <span id="live-status" class="badge bg-success">Aktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, funkcja na ≈ºywo bƒôdzie nieaktywna</small>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR dla graczy</h6>
                            <p class="text-muted">Wy≈õwietl ten kod QR na ekranie, aby gracze mogli do≈ÇƒÖczyƒá do trybu live.</p>
                            <div class="text-center mb-3">
                                <div id="live-qr-code"></div>
                            </div>

                            <!-- G≈Ç√≥wny kod QR -->
                            <button class="btn btn-primary w-100 mb-2" onclick="openLiveQRPreview()">
                                üì± PodglƒÖd i druk kodu QR
                            </button>

                            <!-- Zapasowy kod QR -->
                            <div class="d-flex gap-2 mt-2 mb-3">
                                <button id="live-generate-backup-qr-btn" class="btn btn-success flex-grow-1">
                                    üîÑ Generuj zapasowy kod QR dla pyta≈Ñ na ≈ºywo
                                </button>
                                <button id="live-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>
                                    üì± PodglƒÖd i druk zapasowego kodu QR
                                </button>
                            </div>

                            <!-- Przycisk do wy≈õwietlenia ekranu 5 -->
                            <button id="live-show-screen5-btn" class="btn btn-info w-100 mb-2">
                                üì∫ Wy≈õwietl ekran numer 5
                            </button>

                            <!-- Link do ekranu 5 -->
                            <div class="alert alert-info mb-0">
                                <small><strong>Link do ekranu numer 5:</strong></small><br>
                                <small><a id="live-screen5-link" href="#" target="_blank" class="text-break"></a></small>
                            </div>

                            <small class="text-muted d-block mt-2">
                                Zapasowy kod QR jest priorytetowy na ekranie numer 5. Domy≈õlnie ekran pokazuje podstawowy kod QR.
                            </small>
                        </div>
                    </div>

                    <!-- Ustawienia -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia</h6>
                            <p class="text-muted">Liczba przycisk√≥w odpowiedzi jest dostosowywana automatycznie do liczby wype≈Çnionych p√≥l w pytaniu.</p>

                            <hr class="my-3">

                            <!-- Prze≈ÇƒÖcznik puli punkt√≥w -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Pula punkt√≥w:</strong></label>
                                <div class="d-flex align-items-center gap-3">
                                    <span class="text-muted">Obecna pula punkt√≥w</span>
                                    <div class="form-check form-switch" style="transform: scale(1.5); margin: 0 15px;">
                                        <input class="form-check-input" type="checkbox" id="live-separate-score-pool" style="cursor: pointer;">
                                    </div>
                                    <span class="text-primary"><strong>Osobna pula punkt√≥w</strong></span>
                                </div>
                                <small class="text-muted d-block mt-2">
                                    <strong>Obecna pula:</strong> Punkty z trybu Na ≈ºywo trafiajƒÖ do og√≥lnego licznika punkt√≥w gracza.<br>
                                    <strong>Osobna pula:</strong> Punkty z trybu Na ≈ºywo sƒÖ liczone oddzielnie (np. gracz ma 60 pkt. og√≥lnych + 20 pkt. z trybu Na ≈ºywo).
                                </small>
                            </div>

                            <hr class="my-3">

                            <!-- Ustawienie wyniku (Auto/Manual) -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Wynik:</strong></label>
                                <div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="live-result-mode" id="live-result-auto" value="auto" checked>
                                        <label class="form-check-label" for="live-result-auto">
                                            Od razu (Auto)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="live-result-mode" id="live-result-manual" value="manual">
                                        <label class="form-check-label" for="live-result-manual">
                                            Na ≈ºyczenie (Manual)
                                        </label>
                                    </div>
                                </div>
                                <small class="text-muted d-block mt-2">
                                    <strong>Od razu:</strong> Wyniki i punkty pojawiajƒÖ siƒô automatycznie po up≈Çyniƒôciu czasu.<br>
                                    <strong>Na ≈ºyczenie:</strong> Host musi kliknƒÖƒá "Wy≈õwietl wynik" aby gracze zobaczyli odpowied≈∫ i dostali punkty.
                                </small>
                            </div>

                            <hr class="my-3">

                            <!-- Przycisk Statystyki -->
                            <div class="mb-0">
                                <button id="live-show-statistics-btn" class="btn btn-primary w-100" disabled>
                                    üìä Wy≈õwietl statystyki na ekranie 5
                                </button>
                                <small class="text-muted d-block mt-2">
                                    Gracze zobaczƒÖ procentowe wyniki wszystkich odpowiedzi (dostƒôpne po zako≈Ñczeniu pytania)
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Nowe pytanie -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Dodaj nowe pytanie</h6>
                            <div class="mb-3">
                                <label for="live-new-question-text" class="form-label">Tre≈õƒá pytania (opcjonalnie)</label>
                                <textarea class="form-control" id="live-new-question-text" rows="2" placeholder="Mo≈ºesz zostawiƒá puste je≈õli czytasz pytanie ze sceny"></textarea>
                                <small class="text-muted">Je≈õli wype≈Çnisz, gracze zobaczƒÖ pytanie w swoich telefonach</small>
                            </div>

                            <!-- Pola odpowiedzi -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Odpowiedzi:</strong></label>
                                <div id="live-answers-container">
                                    <div class="input-group mb-2 live-answer-item">
                                        <span class="input-group-text">Odpowied≈∫ A</span>
                                        <input type="text" class="form-control live-answer-input" placeholder="Opcjonalnie">
                                        <div class="input-group-text">
                                            <input class="form-check-input live-correct-checkbox mt-0" type="checkbox" title="Poprawna odpowied≈∫">
                                            <span class="ms-2 small">Poprawna</span>
                                        </div>
                                        <button class="btn btn-danger live-remove-answer-btn" type="button" style="display: none;">√ó</button>
                                    </div>
                                    <div class="input-group mb-2 live-answer-item">
                                        <span class="input-group-text">Odpowied≈∫ B</span>
                                        <input type="text" class="form-control live-answer-input" placeholder="Opcjonalnie">
                                        <div class="input-group-text">
                                            <input class="form-check-input live-correct-checkbox mt-0" type="checkbox" title="Poprawna odpowied≈∫">
                                            <span class="ms-2 small">Poprawna</span>
                                        </div>
                                        <button class="btn btn-danger live-remove-answer-btn" type="button" style="display: none;">√ó</button>
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-outline-primary" id="live-add-answer-btn">
                                    + Dodaj nowe pole
                                </button>
                            </div>

                            <div class="mb-3">
                                <label for="live-new-time-limit" class="form-label">Limit czasu (sekundy)</label>
                                <input type="number" class="form-control" id="live-new-time-limit" value="30" min="5" max="180">
                            </div>
                            <button class="btn btn-primary w-100" onclick="createLiveQuestion()">
                                ‚ûï Dodaj pytanie
                            </button>
                        </div>
                    </div>

                    <!-- Lista pyta≈Ñ -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Pytania</h6>
                            <div id="live-questions-list">
                                <p class="text-muted text-center">Brak pyta≈Ñ. Dodaj nowe pytanie powy≈ºej.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Aktywne pytanie -->
                    <div class="card mb-3 bg-warning" id="live-active-question-card" style="display: none;">
                        <div class="card-body">
                            <h6 class="mb-3">‚ö° Aktywne pytanie</h6>
                            <div id="live-active-question-content">
                                <p class="mb-2"><strong id="live-active-q-text"></strong></p>
                                <div id="live-active-options" class="mb-3 small"></div>
                                <div id="live-active-timer" class="mb-3">
                                    <h4 class="text-danger">Czas: <span id="live-timer-display">30</span>s</h4>
                                </div>
                                <div class="mb-3">
                                    <strong>Odpowiedzi graczy: <span id="live-answers-count">0</span></strong>
                                </div>
                                <h6 class="mb-2">Ujawnij poprawnƒÖ odpowied≈∫ (mo≈ºna wybraƒá wiele):</h6>
                                <div id="live-reveal-buttons" class="d-flex flex-wrap gap-2" role="group">
                                    <!-- Przyciski generowane dynamicznie -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="ar">
            <div class="card">
                <div class="card-header"><h5 class="card-title mb-0" data-translate="ar_tab">Rozszerzona rzeczywisto≈õƒá (AR)</h5></div>
                <div class="card-body">
                    <h6>1. Zdefiniuj obiekty AR</h6>
                    <p class="text-muted">Sfotografuj przedmioty, kt√≥re bƒôdƒÖ wyzwalaƒá gry po rozpoznaniu przez graczy.</p>

                    <div class="row g-3 mb-4" id="ar-objects-container">
                        <!-- Obiekty AR bƒôdƒÖ dodawane tutaj dynamicznie -->
                    </div>

                    <button class="btn btn-success mb-4" onclick="addNewARObject()">
                        + Dodaj nowy obiekt AR
                    </button>

                    <hr>

                    <h6>2. Kod QR dla graczy (AR Scanner)</h6>
                    <p class="text-muted">Wygeneruj kod QR, kt√≥ry gracze bƒôdƒÖ skanowaƒá, aby uruchomiƒá skaner AR.</p>
                    <div class="text-center">
                        <a href="/ar_qr_preview/{{ event.id }}" target="_blank" class="btn btn-success btn-lg">
                            üîç PodglƒÖd i Druk Kodu QR AR
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="fortune">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="fortune_title">Wr√≥≈ºka AI - atrakcja wykorzystujƒÖca sztucznƒÖ inteligencjƒô</h5>
                    <p class="text-muted mb-0 mt-2 small" data-translate="fortune_description">Gracze po zeskanowaniu kodu QR otrzymujƒÖ mo≈ºliwo≈õƒá opisania ostatniego snu, by uzyskaƒá przepowiedniƒô.</p>
                </div>
                <div class="card-body">
                    <!-- Stan gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Stan gry</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="fortune-enabled" style="width: 3em; height: 1.5em;">
                                <label class="form-check-label ms-2" for="fortune-enabled">
                                    <span id="fortune-status" class="badge bg-secondary">Nieaktywna</span>
                                </label>
                            </div>
                            <small class="text-muted">Gdy wy≈ÇƒÖczona, gracze nie bƒôdƒÖ mogli korzystaƒá z wr√≥≈ºki AI</small>
                        </div>
                    </div>

                    <!-- Kod QR -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Kod QR</h6>
                            <button id="fortune-qr-btn" class="btn btn-primary mb-3 w-100">üì± PodglƒÖd i druk kodu QR</button>

                            <div class="d-flex gap-2 mt-3">
                                <button id="fortune-generate-backup-qr-btn" class="btn btn-success flex-grow-1">üîÑ Generuj zapasowy kod QR</button>
                                <button id="fortune-backup-qr-btn" class="btn btn-secondary flex-grow-1" disabled>üì± PodglƒÖd i druk zapasowego kodu QR</button>
                            </div>
                            <small class="text-muted d-block mt-2">Zapasowy kod QR mo≈ºe byƒá u≈ºyty jako alternatywa dla g≈Ç√≥wnego kodu</small>
                        </div>
                    </div>

                    <!-- Ustawienia gry -->
                    <div class="card mb-3 bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">Ustawienia gry</h6>

                            <!-- Liczba s≈Ç√≥w AI -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba s≈Ç√≥w (AI):</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="fortune-word-count" value="300" min="10" max="500">
                                    <button class="btn btn-primary" onclick="updateFortuneSetting('word_count')">OK</button>
                                </div>
                                <small class="text-muted">Zakres: 10-500 (domy≈õlnie: 300)</small>
                            </div>

                            <!-- Punkty za udzia≈Ç -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba punkt√≥w za udzia≈Ç:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="fortune-points" value="5" min="1" max="100">
                                    <button class="btn btn-primary" onclick="updateFortuneSetting('points')">OK</button>
                                </div>
                                <small class="text-muted">Domy≈õlnie: 5 punkt√≥w</small>
                            </div>

                            <!-- Liczba s≈Ç√≥w gracza -->
                            <div class="mb-3">
                                <label class="form-label"><strong>Liczba s≈Ç√≥w gracza:</strong></label>
                                <div class="input-group" style="max-width: 300px;">
                                    <input type="number" class="form-control" id="fortune-player-words" value="2" min="1" max="10">
                                    <button class="btn btn-primary" onclick="updateFortuneSetting('player_words')">OK</button>
                                </div>
                                <small class="text-muted">Zakres: 1-10 (domy≈õlnie: 2). Ile s≈Ç√≥w gracz musi wpisaƒá opisujƒÖc sen</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="timing">
            <fieldset id="timing-settings" disabled>
                <div class="card mb-4">
                    <div class="card-header"><h5 class="card-title mb-0" data-translate="timing_settings">Czas i tempo gry</h5></div>
                    <div class="card-body" id="timing-controls">
                        <div class="mb-3">
                            <label for="game-duration-input-2" class="form-label" data-translate="game_duration_label">Czas gry (minuty):</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="game-duration-input-2" value="60" min="1">
                                <button class="btn btn-primary" id="set-time-btn-2" data-translate="set_time_btn">OK</button>
                            </div>
                            <small class="text-muted" data-translate="game_duration_help">Przed grƒÖ: ustaw czas. Podczas gry: zmie≈Ñ czas (wymaga has≈Ça)</small>
                        </div>
        
                        <hr>
        
                        <label class="form-label" data-translate="time_speed">Tempo czasu:</label>
                        <div class="btn-group w-100 mb-3" role="group">
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="0.5">x0,5</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="1">x1</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="2">x2</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="10">x10</button>
                            <button type="button" class="btn btn-outline-info" data-control="speed" data-value="30">x30</button>
                        </div>
                        <label class="form-label" data-translate="points_bonus">Premia punktowa:</label>
                        <div class="btn-group w-100 mb-3" role="group">
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="1">x1</button>
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="2">x2</button>
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="3">x3</button>
                            <button type="button" class="btn btn-outline-primary" data-control="bonus" data-value="10">x10</button>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>

        <!-- ‚úÖ NOWA ZAK≈ÅADKA: WY≈öWIETLACZ -->
        <div class="tab-pane fade" id="display">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0" data-translate="display_tab">Ustawienia wy≈õwietlacza</h5>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <h6 data-translate="display_screens">Liczba ekran√≥w zewnƒôtrznych:</h6>
                        <div class="btn-group w-100" role="group" id="display-screens-controls">
                            <button type="button" class="btn btn-outline-primary" data-control="display_screens" data-value="1" data-translate="one_screen">1 Ekran</button>
                            <button type="button" class="btn btn-outline-primary active-modifier" data-control="display_screens" data-value="2" data-translate="two_screens">2 Ekrany</button>
                            <button type="button" class="btn btn-outline-primary" data-control="display_screens" data-value="3" data-translate="three_screens">3 Ekrany</button>
                            <button type="button" class="btn btn-outline-primary" data-control="display_screens" data-value="4" data-translate="four_screens">4 Ekrany</button>
                        </div>
                        <small class="text-muted d-block mt-2">
                            <strong>1 ekran:</strong> Tytu≈Ç eventu, Nazwa firmy Bomba, Has≈Ço<br>
                            <strong>2 ekrany:</strong> Ekran 1 - Tytu≈Ç eventu, Nazwa firmy Bomba, Has≈Ço | Ekran 2 - Ranking i komentarze hosta<br>
                            <strong>3 ekrany:</strong> Ekran 1 - Tytu≈Ç eventu, Nazwa firmy Bomba, Has≈Ço | Ekran 2 - Ranking i komentarze hosta | Ekran 3 - Zabawne Selfie w karuzeli<br>
                            <strong>4 ekrany:</strong> Ekran 1 - Tytu≈Ç eventu, Nazwa firmy Bomba, Has≈Ço | Ekran 2 - Ranking i komentarze hosta | Ekran 3 - Zabawne Selfie w karuzeli | Ekran 4 - Kod gracza i przedmioty AR do znalezienia
                        </small>
                    </div>

                    <div class="mt-4">
                        <h6>Linki do ekran√≥w:</h6>
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('display', event_id=event.id) }}" target="_blank" class="btn btn-secondary" id="display1-link">
                                üñ•Ô∏è Ekran 1 - G≈Ç√≥wny wy≈õwietlacz
                            </a>
                            <div class="alert alert-info mb-2">
                                <small><strong>Link do ekranu 1:</strong></small><br>
                                <small><a href="{{ url_for('display', event_id=event.id, _external=True) }}" target="_blank" class="text-break">{{ url_for('display', event_id=event.id, _external=True) }}</a></small>
                            </div>

                            <a href="{{ url_for('display2', event_id=event.id) }}" target="_blank" class="btn btn-secondary" id="display2-link">
                                üñ•Ô∏è Ekran 2 - Ranking i zdjƒôcia
                            </a>
                            <div class="alert alert-info mb-2">
                                <small><strong>Link do ekranu 2:</strong></small><br>
                                <small><a href="{{ url_for('display2', event_id=event.id, _external=True) }}" target="_blank" class="text-break">{{ url_for('display2', event_id=event.id, _external=True) }}</a></small>
                            </div>

                            <a href="{{ url_for('photo_player', event_id=event.id) }}" target="_blank" class="btn btn-secondary" id="display3-link">
                                üñ•Ô∏è Ekran 3 - Selfie
                            </a>
                            <div class="alert alert-info mb-2">
                                <small><strong>Link do ekranu 3:</strong></small><br>
                                <small><a href="{{ url_for('photo_player', event_id=event.id, _external=True) }}" target="_blank" class="text-break">{{ url_for('photo_player', event_id=event.id, _external=True) }}</a></small>
                            </div>

                            <a href="{{ url_for('display4', event_id=event.id) }}" target="_blank" class="btn btn-secondary" id="display4-link">
                                üñ•Ô∏è Ekran 4 - Przemioty do znalezienia oraz kod gracza
                            </a>
                            <div class="alert alert-info mb-2">
                                <small><strong>Link do ekranu 4:</strong></small><br>
                                <small><a href="{{ url_for('display4', event_id=event.id, _external=True) }}" target="_blank" class="text-break">{{ url_for('display4', event_id=event.id, _external=True) }}</a></small>
                            </div>

                            <a href="{{ url_for('display5', event_id=event.id) }}" target="_blank" class="btn btn-secondary" id="display5-link">
                                üñ•Ô∏è Ekran 5 - G≈Çosowanie lub Pytania na ≈ªywo
                            </a>
                            <div class="alert alert-info mb-0">
                                <small><strong>Link do ekranu 5:</strong></small><br>
                                <small><a href="{{ url_for('display5', event_id=event.id, _external=True) }}" target="_blank" class="text-break">{{ url_for('display5', event_id=event.id, _external=True) }}</a></small>
                            </div>
                        </div>
                    </div>

                    <div id="display-status" class="mt-3 alert alert-info">
                        Aktualnie uruchomione: <strong>2 ekrany</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for adding/editing question -->
<div class="modal fade" id="questionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" data-translate="question_modal_title">Dodaj pytanie</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label" data-translate="question_text">Tre≈õƒá pytania:</label>
                    <textarea class="form-control" id="modal-question-text" rows="3"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label" data-translate="answers">Odpowiedzi:</label>
                    <div class="input-group mb-2">
                        <span class="input-group-text">A)</span>
                        <input type="text" class="form-control" id="modal-answer-a">
                        <div class="input-group-text">
                            <input class="form-check-input" type="radio" name="correct-answer" value="A" id="correct-a">
                        </div>
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text">B)</span>
                        <input type="text" class="form-control" id="modal-answer-b">
                        <div class="input-group-text">
                            <input class="form-check-input" type="radio" name="correct-answer" value="B" id="correct-b">
                        </div>
                    </div>
                    <div class="input-group">
                        <span class="input-group-text">C)</span>
                        <input type="text" class="form-control" id="modal-answer-c">
                        <div class="input-group-text">
                            <input class="form-check-input" type="radio" name="correct-answer" value="C" id="correct-c">
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label" data-translate="difficulty_level">Poziom trudno≈õci:</label>
                    <div class="btn-group w-100" role="group" id="difficulty-buttons">
                        <button type="button" class="btn btn-outline-success active" data-difficulty="easy" data-translate="easy">≈Åatwy</button>
                        <button type="button" class="btn btn-outline-warning" data-difficulty="medium" data-translate="medium">≈öredni</button>
                        <button type="button" class="btn btn-outline-danger" data-difficulty="hard" data-translate="hard">Trudny</button>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label" data-translate="question_category">Kategoria pytania:</label>
                    <div class="btn-group w-100" role="group" id="category-buttons">
                        <button type="button" class="btn btn-outline-primary active" data-category="company" data-translate="category_company">Firmowe</button>
                        <button type="button" class="btn btn-outline-primary" data-category="world" data-translate="category_world">≈öwiatowe</button>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label" data-translate="letter_reveal">Litera do ods≈Çoniƒôcia:</label>
                    <input type="text" class="form-control" id="modal-letter" maxlength="1" value="X">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-translate="cancel">Anuluj</button>
                <button type="button" class="btn btn-primary" id="save-question-btn" data-translate="save">Zapisz</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Wy≈õlij wiadomo≈õƒá do gracza -->
<div class="modal fade" id="sendMessageModal" tabindex="-1" aria-labelledby="sendMessageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="sendMessageModalLabel">
                    <span id="message-modal-title"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="player-message-input" class="form-label" id="message-content-label"></label>
                    <textarea class="form-control" id="player-message-input" rows="3" maxlength="120"></textarea>
                    <small class="text-muted"><span id="message-char-count">0</span> / 120 znak√≥w</small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-translate="cancel">Anuluj</button>
                <button type="button" class="btn btn-primary" id="send-message-to-player-btn">
                    <span data-translate="send">Wy≈õlij</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Edycja gracza -->
<div class="modal fade" id="editPlayerModal" tabindex="-1" aria-labelledby="editPlayerModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editPlayerModalLabel">Edycja gracza</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="edit-player-name" class="form-label">Nazwa gracza:</label>
                    <input type="text" class="form-control" id="edit-player-name" maxlength="80">
                </div>
                <div class="mb-3">
                    <label for="edit-player-score" class="form-label">Punkty:</label>
                    <input type="number" class="form-control" id="edit-player-score" min="0">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
                <button type="button" class="btn btn-primary" id="save-player-edit-btn">OK</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Edycja pyta≈Ñ AI dla kategorii -->
<div class="modal fade" id="aiQuestionsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edycja pyta≈Ñ AI - <span id="ai-category-name"></span></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="ai-questions-list"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zamknij</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Edycja pojedynczego pytania AI -->
<div class="modal fade" id="editAIQuestionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edytuj pytanie AI</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-question-id">
                <div class="mb-3">
                    <label class="form-label">Tre≈õƒá pytania:</label>
                    <textarea class="form-control" id="edit-question-text" rows="3"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Odpowiedzi:</label>
                    <div class="input-group mb-2">
                        <span class="input-group-text">A)</span>
                        <input type="text" class="form-control" id="edit-answer-a">
                        <div class="input-group-text">
                            <input class="form-check-input" type="radio" name="edit-correct-answer" value="A" id="edit-correct-a">
                        </div>
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text">B)</span>
                        <input type="text" class="form-control" id="edit-answer-b">
                        <div class="input-group-text">
                            <input class="form-check-input" type="radio" name="edit-correct-answer" value="B" id="edit-correct-b">
                        </div>
                    </div>
                    <div class="input-group">
                        <span class="input-group-text">C)</span>
                        <input type="text" class="form-control" id="edit-answer-c">
                        <div class="input-group-text">
                            <input class="form-check-input" type="radio" name="edit-correct-answer" value="C" id="edit-correct-c">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
                <button type="button" class="btn btn-primary" id="save-ai-question-btn">Zapisz</button>
            </div>
        </div>
    </div>
</div>

<!-- üéÆ WIDOKI TESTOWE MINIGIER -->

<!-- Tetris Test View -->
<div id="tetris-test-view" style="display:none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #607D8B; z-index: 2000;">
    <div class="d-flex flex-column" style="height: 100vh;">
        <div class="text-center py-1 bg-dark text-white" style="flex: 0 0 8%; min-height: 60px; display: flex; flex-direction: column; justify-content: center;">
            <h5 class="mb-0" style="font-size: 1.1rem;">üéÆ TETRIS - Tryb Testowy</h5>
            <div class="d-flex justify-content-between align-items-center px-3">
                <span style="font-size: 0.85rem;">Tester: Host</span>
                <strong style="font-size: 0.9rem;">Punkty: <span id="tetris-test-score">0</span> / 20</strong>
            </div>
        </div>

        <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 2px; position: relative;">
            <div id="tetris-test-start-section" class="text-center" style="position: absolute; z-index: 10; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <h4 class="mb-3" style="color: #333;">üéÆ Test Tetris</h4>
                <p class="mb-4" style="color: #666;">Przetestuj grƒô przed udostƒôpnieniem graczom</p>
                <button id="tetris-test-start-btn" class="btn btn-success btn-lg mb-3" style="width: 200px; font-weight: bold;">START TESTU</button>
                <br>
                <button id="tetris-test-close-btn" class="btn btn-outline-secondary">‚Üê Wr√≥ƒá do panelu</button>
            </div>

            <div id="tetris-test-left-controls" style="display: none; position: absolute; left: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                <div class="d-flex flex-column gap-2">
                    <button id="tetris-test-left-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚óÑ</button>
                    <button id="tetris-test-rotate-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 28px; touch-action: manipulation; border: 3px solid #333; background: white;">üîÑ</button>
                </div>
            </div>

            <canvas id="tetris-test-canvas" style="border: 3px solid #333; background-color: #000; border-radius: 10px; max-width: calc(100% - 140px); max-height: calc(100% - 4px); z-index: 1;"></canvas>

            <div id="tetris-test-right-controls" style="display: none; position: absolute; right: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                <div class="d-flex flex-column gap-2">
                    <button id="tetris-test-right-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñ∫</button>
                    <button id="tetris-test-down-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñº</button>
                </div>
            </div>
        </div>

        <div style="flex: 0 0 8%; display: flex; align-items: center; justify-content: center; padding: 5px;">
            <button id="tetris-test-exit-btn" class="btn btn-danger" style="width: 90%; max-width: 300px; height: 45px; font-weight: bold; display: none;">ZAKO≈ÉCZ TEST</button>
        </div>
    </div>
</div>

<!-- Arkanoid Test View -->
<div id="arkanoid-test-view" style="display:none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #16213e; z-index: 2000;">
    <div class="d-flex flex-column" style="height: 100vh;">
        <div class="text-center py-1 bg-dark text-white" style="flex: 0 0 8%; min-height: 60px; display: flex; flex-direction: column; justify-content: center;">
            <h5 class="mb-0" style="font-size: 1.1rem;">üèì ARKANOID - Tryb Testowy</h5>
            <div class="d-flex justify-content-between align-items-center px-3">
                <span style="font-size: 0.85rem;">Tester: Host</span>
                <div>
                    <strong style="font-size: 0.9rem;">Punkty: <span id="arkanoid-test-score">0</span> / 20</strong>
                    <span style="margin-left: 15px; font-size: 1rem;" id="arkanoid-test-lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                </div>
            </div>
        </div>

        <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 2px; position: relative;">
            <div id="arkanoid-test-start-section" class="text-center" style="position: absolute; z-index: 10; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <h4 class="mb-3" style="color: #333;">üèì Test Arkanoid</h4>
                <p class="mb-4" style="color: #666;">Przetestuj grƒô przed udostƒôpnieniem graczom</p>
                <button id="arkanoid-test-start-btn" class="btn btn-success btn-lg mb-3" style="width: 200px; font-weight: bold;">START TESTU</button>
                <br>
                <button id="arkanoid-test-close-btn" class="btn btn-outline-secondary">‚Üê Wr√≥ƒá do panelu</button>
            </div>

            <div id="arkanoid-test-left-controls" style="display: none; position: absolute; left: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                <div class="d-flex flex-column gap-2">
                    <button id="arkanoid-test-left-btn" class="btn btn-light" style="width: 65px; height: 130px; font-size: 48px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚óÑ</button>
                </div>
            </div>

            <canvas id="arkanoid-test-canvas" style="border: 3px solid #333; background-color: #1a1a2e; border-radius: 10px; max-width: calc(100% - 140px); max-height: calc(100% - 4px); z-index: 1;"></canvas>

            <div id="arkanoid-test-right-controls" style="display: none; position: absolute; right: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                <div class="d-flex flex-column gap-2">
                    <button id="arkanoid-test-right-btn" class="btn btn-light" style="width: 65px; height: 130px; font-size: 48px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñ∫</button>
                </div>
            </div>
        </div>

        <div style="flex: 0 0 8%; display: flex; align-items: center; justify-content: center; padding: 5px;">
            <button id="arkanoid-test-exit-btn" class="btn btn-danger" style="width: 90%; max-width: 300px; height: 45px; font-weight: bold; display: none;">ZAKO≈ÉCZ TEST</button>
        </div>
    </div>
</div>

<!-- Snake Test View -->
<div id="snake-test-view" style="display:none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #2d4a2b; z-index: 2000;">
    <div class="d-flex flex-column" style="height: 100vh;">
        <div class="text-center py-1 bg-dark text-white" style="flex: 0 0 8%; min-height: 60px; display: flex; flex-direction: column; justify-content: center;">
            <h5 class="mb-0" style="font-size: 1.1rem;">üêç SNAKE - Tryb Testowy</h5>
            <div class="d-flex justify-content-between align-items-center px-3">
                <span style="font-size: 0.85rem;">Tester: Host</span>
                <strong style="font-size: 0.9rem;">Punkty: <span id="snake-test-score">0</span> / 20</strong>
            </div>
        </div>

        <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 2px; position: relative;">
            <div id="snake-test-start-section" class="text-center" style="position: absolute; z-index: 10; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <h4 class="mb-3" style="color: #333;">üêç Test Snake</h4>
                <p class="mb-4" style="color: #666;">Przetestuj grƒô przed udostƒôpnieniem graczom</p>
                <button id="snake-test-start-btn" class="btn btn-success btn-lg mb-3" style="width: 200px; font-weight: bold;">START TESTU</button>
                <br>
                <button id="snake-test-close-btn" class="btn btn-outline-secondary">‚Üê Wr√≥ƒá do panelu</button>
            </div>

            <div id="snake-test-left-controls" style="display: none; position: absolute; left: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                <div class="d-flex flex-column gap-2">
                    <button id="snake-test-up-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñ≤</button>
                    <button id="snake-test-left-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚óÑ</button>
                </div>
            </div>

            <canvas id="snake-test-canvas" style="border: 3px solid #333; background: #000; box-shadow: 0 0 15px rgba(0,0,0,0.5);"></canvas>

            <div id="snake-test-right-controls" style="display: none; position: absolute; right: 2px; top: 50%; transform: translateY(-50%); z-index: 5;">
                <div class="d-flex flex-column gap-2">
                    <button id="snake-test-down-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñº</button>
                    <button id="snake-test-right-btn" class="btn btn-light" style="width: 65px; height: 65px; font-size: 32px; touch-action: manipulation; border: 3px solid #333; background: white; line-height: 1;">‚ñ∫</button>
                </div>
            </div>
        </div>

        <div style="flex: 0 0 8%; display: flex; align-items: center; justify-content: center; padding: 5px;">
            <button id="snake-test-exit-btn" class="btn btn-danger" style="width: 90%; max-width: 300px; height: 45px; font-weight: bold; display: none;">ZAKO≈ÉCZ TEST</button>
        </div>
    </div>
</div>

<!-- T-Rex Test View -->
<div id="trex-test-view" style="display:none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #f7f7f7; z-index: 2000;">
    <div class="d-flex flex-column" style="height: 100vh;">
        <div class="text-center py-1 bg-dark text-white" style="flex: 0 0 8%; min-height: 60px; display: flex; flex-direction: column; justify-content: center;">
            <h5 class="mb-0" style="font-size: 1.1rem;">ü¶ñ T-REX - Tryb Testowy</h5>
            <div class="d-flex justify-content-between align-items-center px-3">
                <span style="font-size: 0.85rem;">Tester: Host</span>
                <strong style="font-size: 0.9rem;">Punkty: <span id="trex-test-score">0</span> / 20</strong>
            </div>
        </div>

        <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 2px; position: relative;">
            <div id="trex-test-start-section" class="text-center" style="position: absolute; z-index: 10; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <h4 class="mb-3" style="color: #333;">ü¶ñ Test T-Rex</h4>
                <p class="mb-4" style="color: #666;">Przetestuj grƒô przed udostƒôpnieniem graczom</p>
                <button id="trex-test-start-btn" class="btn btn-success btn-lg mb-3" style="width: 200px; font-weight: bold;">START TESTU</button>
                <br>
                <button id="trex-test-close-btn" class="btn btn-outline-secondary">‚Üê Wr√≥ƒá do panelu</button>
            </div>

            <canvas id="trex-test-canvas" style="border: 3px solid #535353; background: #f7f7f7; box-shadow: 0 0 15px rgba(0,0,0,0.2); max-width: calc(100% - 20px); max-height: calc(100% - 4px);"></canvas>

            <div id="trex-test-jump-control" style="display: none; position: absolute; bottom: 20px; z-index: 5;">
                <button id="trex-test-jump-btn" class="btn btn-warning" style="width: 120px; height: 80px; font-size: 28px; touch-action: manipulation; border: 4px solid #333; background: #ffc107; line-height: 1; font-weight: bold;">SKOK ‚ñ≤</button>
            </div>
        </div>

        <div style="flex: 0 0 8%; display: flex; align-items: center; justify-content: center; padding: 5px;">
            <button id="trex-test-exit-btn" class="btn btn-danger" style="width: 90%; max-width: 300px; height: 45px; font-weight: bold; display: none;">ZAKO≈ÉCZ TEST</button>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://cdn.socket.io/4.5.2/socket.io.min.js"></script>
<script src="{{ url_for('static', filename='tetris.js') }}"></script>
<script src="{{ url_for('static', filename='arkanoid.js') }}"></script>
<script src="{{ url_for('static', filename='snake.js') }}"></script>
<script src="{{ url_for('static', filename='trex.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="{{ url_for('static', filename='js/host_main.js') }}"></script>
{% endblock %}
